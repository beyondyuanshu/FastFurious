{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/@skpm/child_process/index.js","webpack://exports/./node_modules/@skpm/child_process/lib/exec.js","webpack://exports/./node_modules/@skpm/child_process/lib/execFile.js","webpack://exports/./node_modules/@skpm/child_process/lib/execFileSync.js","webpack://exports/./node_modules/@skpm/child_process/lib/execSync.js","webpack://exports/./node_modules/@skpm/child_process/lib/handleData.js","webpack://exports/./node_modules/@skpm/child_process/lib/normalizeSpawnArguments.js","webpack://exports/./node_modules/@skpm/child_process/lib/spawn.js","webpack://exports/./node_modules/@skpm/child_process/lib/spawnSync.js","webpack://exports/./node_modules/@skpm/dialog/lib/index.js","webpack://exports/./node_modules/@skpm/dialog/lib/message-box.js","webpack://exports/./node_modules/@skpm/dialog/lib/open-dialog.js","webpack://exports/./node_modules/@skpm/dialog/lib/save-dialog.js","webpack://exports/./node_modules/@skpm/dialog/lib/utils.js","webpack://exports/./node_modules/@skpm/fs/index.js","webpack://exports/./node_modules/@skpm/fs/utils.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/process/browser.js","webpack://exports/./node_modules/promise-polyfill/lib/index.js","webpack://exports/./node_modules/setimmediate/setImmediate.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./node_modules/timers-browserify/main.js","webpack://exports/(webpack)/buildin/global.js","webpack://exports/./resources/views/theme/dark.js","webpack://exports/./resources/views/theme/index.js","webpack://exports/./resources/views/theme/light.js","webpack://exports/./resources/webview.html","webpack://exports/./src/commandMetadata.js","webpack://exports/./src/lib/Constants.js","webpack://exports/./src/lib/CreateTableOfContents.js","webpack://exports/./src/lib/ExportMetadata.js","webpack://exports/./src/lib/TheUI.js","webpack://exports/./src/lib/Utilities.js","webpack://exports/external \"buffer\"","webpack://exports/external \"events\"","webpack://exports/external \"os\"","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\"","webpack://exports/external \"stream\""],"names":["name","text","bg","previewColor","input","background","color","border","borderActive","button","bgColor","bgActive","secondaryButton","borderColor","textColor","CTAButton","radio","selectedColor","theme","dark","light","options","identifier","title","redirectTo","width","height","theUI","TocPageName","ArtboardSortEnum","Top2BottomByLayerList","Bottom2TopByLayerList","Left2RightByArtboard","Right2LeftByArtboard","Top2BottomByArtboard","ArtbaordLayersSortEnum","Sketch","require","Page","Artboard","Group","Text","ShapePath","Settings","UI","document","getSelectedDocument","browserWindow","webContents","headingsMap","Map","noParentHeadingArtboard","invalidHeadingOverride","ContentWidth","ContentHeight","GroupSpacing","GroupTopMargin","GroupLeftAndRightMargin","GroupCounts","GroupWidth","checkArtboardSort","artboardSort","createHeading","artboard","originalX","originalY","headingLevel","headingText","pageNumber","groupHeight","serialAndContentX","serialAndContentHeight","serialAndContentFontSize","serialAndContentFontWeight","serialAndContentFontColor","serialAndContent","style","borders","fontFamily","fontSize","fontWeight","alignment","verticalAlignment","frame","x","y","separator","shapeType","ShapeType","Custom","thickness","borderOptions","dashPattern","points","point","pageNumberFontSize","page","toString","placeholder","group","parent","adjustToFit","layers","setParentHeadingOrOverrideValue","value","undefined","setLayerSettingForKey","checkHeadingSerial","lastSerial","currentSerial","hasError","length","endsWith","tempLastSerial","split","parseInt","array","newArray","secondLastNumber","serialLength","splice","lastNumber","join","checkHeadings","artboards","artboardIndex","index","type","layerSettingForKey","layer","master","overrides","override","has","console","log","executeJavaScript","JSON","stringify","affectedLayer","pattern","regex","RegExp","test","startsWith","parentHeading","selectedLayers","forEach","selected","centerOnLayer","slice","serial","set","addHeading","topBannerMaster","bottomBannerMaster","remove","contentsArtboards","contentsPageIndex","lastLevel","column","needAddNewArtboard","push","topBanner","createNewInstance","bottomBanner","currentLevel","serialText","updateContentsPage","contentsTitles","number","newHeadingMap","frontContentsPages","hasAddContents","createTableOfContents","contents","win","pageTitleMaster","find","alert","clear","getArtboardsSorted","selectedPage","size","newHeadingsMap","newContentsArtboards","close","message","fs","exec","exportDir","needParsePages","needParsePagesIndex","needParseCount","hasParseCount","resultJsons","exportLayerJsonOptions","formats","output","needCancel","needParseLayers","parsePage","json","objectID","do_objectID","rect","rotation","parseArtboard","_class","parseText","content","attributedString","string","textStyle","encodedAttributes","MSAttributedStringFontAttribute","attributes","fontColor","r","MSAttributedStringColorAttribute","red","g","green","b","blue","a","alpha","parseImage","toLowerCase","parseGroup","parseSymbol","overrideValues","overrideValuesModify","overrideValue","parse","key","values","last","pop","_ref","overrideName","symbolID","parseCommon","exportLayer","scales","overwriting","renameSync","id","cancelTask","getTargetLayers","pages","nodes","children","sketchJSON","label","closeWindow","setClosable","calcNeedParseCount","includes","setTimeout","bind","handleSketchJSON","hasParse","hasAllParse","isNaN","getLayerWithID","writeFileSync","unzipPath","existsSync","rmdirSync","recursive","exportMetadata","exportPath","mkdirSync","cmd","path","replace","handingTask","themeColor","MSTheme","sharedTheme","isDark","getTheme","winOptions","minimizable","maximizable","resizable","fullscreenable","backgroundColor","alwaysOnTop","show","BrowserWindow","once","on","e","needShowAlert","loadURL","getExportDir","dialog","showOpenDialogSync","properties","result","s","artboardInnerLayersSort","getData","getDefaultExportDir","os","hasLayers","sort","reverse","tailGetLayerPosterities","posterities","getPagePosterities","artboardLayersSort","list","concat","dir","homedir","documentName"],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,sBAAsB,mBAAO,CAAC,kEAAY;AAC1C,0BAA0B,mBAAO,CAAC,0EAAgB;AAClD,uBAAuB,mBAAO,CAAC,oEAAa;AAC5C,2BAA2B,mBAAO,CAAC,4EAAiB;AACpD,8BAA8B,mBAAO,CAAC,kFAAoB;AAC1D,0BAA0B,mBAAO,CAAC,0EAAgB;;;;;;;;;;;;ACLlD,eAAe,mBAAO,CAAC,sEAAY;;AAEnC;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtBA;AACA,YAAY,mBAAO,CAAC,gEAAS;AAC7B,iBAAiB,mBAAO,CAAC,0EAAc;;AAEvC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;AC1KA,gBAAgB,mBAAO,CAAC,wEAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,yDAAyD;AACzD;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC5DA,mBAAmB,mBAAO,CAAC,8EAAgB;;AAE3C;AACA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;AChBA,aAAa,mBAAO,CAAC,sBAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;AChBA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;;AAE5B;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpHA;AACA,aAAa,mBAAO,CAAC,sBAAQ;AAC7B,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,eAAe,mBAAO,CAAC,sBAAQ;AAC/B,eAAe,mBAAO,CAAC,sBAAQ;;AAE/B,gBAAgB,mBAAO,CAAC,wEAAa;AACrC,8BAA8B,mBAAO,CAAC,oGAA2B;;AAEjE;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;;;;;;ACxOA;AACA,iBAAiB,mBAAO,CAAC,0EAAc;AACvC,8BAA8B,mBAAO,CAAC,oGAA2B;;AAEjE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;ACnHA;AACA;;AAEA;AACA,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C;AACA;;;;;;;;;;;;ACXA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;ACnIA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;AClHA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AACA;AACA,aAAa,mBAAO,CAAC,sBAAQ;AAC7B,YAAY,mBAAO,CAAC,iDAAS;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,OAAO;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;AClbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;;AAErC;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;;;;;;;ACvLtC,oDAAa;;AAEb;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,+DAA+D;AAC/D;AACA;;AAEA;;;;;;;;;;;;;ACjRA;AACA;;AAEA;AACA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,sBAAsB,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;;;;;;;;;;;ACzLD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,yCAAyC;AACzC,uDAAuD;AACvD,6DAA6D;AAC7D,+BAA+B;AAC/B,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACzBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACxWA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,yBAAyB;AACzB;AACA,QAAQ;AACR,uDAAuD;AACvD,6CAA6C;AAC7C,0BAA0B;AAC1B,sDAAsD;AACtD;AACA;AACA,uBAAuB;AACvB;AACA;AACA,sBAAsB;AACtB;AACA;AACA,wCAAwC;AACxC,QAAQ,EAAE;AACV,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,wEAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA,+DAA+D;AAC/D;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,sBAAsB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;;AChZA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;ACrOA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA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","file":"commandMetadata.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/commandMetadata.js\");\n","module.exports.exec = require('./lib/exec')\nmodule.exports.execFile = require('./lib/execFile')\nmodule.exports.spawn = require('./lib/spawn')\nmodule.exports.spawnSync = require('./lib/spawnSync')\nmodule.exports.execFileSync = require('./lib/execFileSync')\nmodule.exports.execSync = require('./lib/execSync')\n","var execFile = require('./execFile')\n\nfunction normalizeExecArgs(command, options, callback) {\n  if (typeof options === 'function') {\n    callback = options\n    options = undefined\n  }\n\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n  options.shell = typeof options.shell === 'string' ? options.shell : true\n\n  return {\n    file: command,\n    options: options,\n    callback: callback\n  }\n}\n\nmodule.exports = function exec(command, options, callback) {\n  var opts = normalizeExecArgs(command, options, callback)\n  return execFile(opts.file, opts.options, opts.callback)\n}\n","/* globals NSMutableData, NSData */\nvar spawn = require('./spawn')\nvar handleData = require('./handleData')\n\nfunction validateTimeout(timeout) {\n  if (timeout != null && !(Number.isInteger(timeout) && timeout >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.timeout')\n  }\n}\n\nfunction validateMaxBuffer(maxBuffer) {\n  if (maxBuffer != null && !(typeof maxBuffer === 'number' && maxBuffer >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.maxBuffer')\n  }\n}\n\nfunction concatData(prev, data) {\n  prev.appendData(data)\n  return prev\n}\n\nmodule.exports = function execFile(file, args, options, callback) {\n  var defaultOptions = {\n    encoding: 'utf8',\n    timeout: 0,\n    maxBuffer: 200 * 1024,\n    killSignal: 'SIGTERM',\n    cwd: undefined,\n    env: undefined,\n    shell: false\n  }\n\n  if (typeof args === 'function') {\n    // function (file, callback)\n    callback = args\n    args = []\n    options = defaultOptions\n  } else if (typeof args === 'object' && !Array.isArray(args)) {\n    // function (file, options, callback)\n    callback = options\n    options = Object.assign(defaultOptions, args)\n    args = []\n  } else {\n    // function (file, args, options, callback)\n    options = Object.assign(defaultOptions, options)\n  }\n\n  // Validate the timeout, if present.\n  validateTimeout(options.timeout)\n\n  // Validate maxBuffer, if present.\n  validateMaxBuffer(options.maxBuffer)\n\n  var child = spawn(file, args, {\n    cwd: options.cwd,\n    env: options.env,\n    gid: options.gid,\n    uid: options.uid,\n    shell: options.shell\n  })\n\n  var encoding = options.encoding\n  var _stdout = []\n  var _stderr = []\n\n  var stdoutLen = 0\n  var stderrLen = 0\n  var killed = false\n  var exited = false\n  var timeoutId\n\n  var ex = null\n\n  var cmd = file\n\n  function exithandler(code, signal) {\n    if (exited) return\n    exited = true\n\n    if (timeoutId) {\n      clearTimeout(timeoutId)\n      timeoutId = null\n    }\n\n    if (!callback) return\n\n    // merge chunks\n    var stdout = handleData(\n      NSData.dataWithData(_stdout.reduce(concatData, NSMutableData.data())),\n      encoding\n    )\n    var stderr = handleData(\n      NSData.dataWithData(_stderr.reduce(concatData, NSMutableData.data())),\n      encoding\n    )\n\n    if (!ex && code === 0 && signal === null) {\n      callback(null, stdout, stderr)\n      return\n    }\n\n    if (args.length !== 0) {\n      cmd += ' ' + args.join(' ')\n    }\n\n    if (!ex) {\n      ex = new Error('Command failed: ' + cmd + '\\n' + stderr)\n      ex.killed = child.killed || killed\n      ex.code = code\n      ex.signal = signal\n    }\n\n    ex.cmd = cmd\n    callback(ex, stdout, stderr)\n  }\n\n  function errorhandler(e) {\n    ex = e\n\n    exithandler()\n  }\n\n  function kill() {\n    killed = true\n    try {\n      child.kill(options.killSignal)\n    } catch (e) {\n      ex = e\n      exithandler()\n    }\n  }\n\n  if (options.timeout > 0) {\n    timeoutId = setTimeout(function delayedKill() {\n      kill()\n      timeoutId = null\n    }, options.timeout)\n  }\n\n  if (child.stdout) {\n    child.stdout.setEncoding('NSData')\n    child.stdout.on('data', function onChildStdout(chunk) {\n      stdoutLen += chunk.length()\n      if (stdoutLen > options.maxBuffer) {\n        ex = new Error('ERR_CHILD_PROCESS_STDIO_MAXBUFFER stdout')\n        kill()\n      } else {\n        _stdout.push(chunk)\n      }\n    })\n  }\n\n  if (child.stderr) {\n    child.stderr.setEncoding('NSData')\n    child.stderr.on('data', function onChildStderr(chunk) {\n      stderrLen += chunk.length()\n\n      if (stderrLen > options.maxBuffer) {\n        ex = new Error('ERR_CHILD_PROCESS_STDIO_MAXBUFFER stderr')\n        kill()\n      } else {\n        _stderr.push(chunk)\n      }\n    })\n  }\n\n  child.addListener('close', exithandler)\n  child.addListener('error', errorhandler)\n\n  return child\n}\n","var spawnSync = require('./spawnSync')\n\nfunction validateTimeout(timeout) {\n  if (timeout != null && !(Number.isInteger(timeout) && timeout >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.timeout')\n  }\n}\n\nfunction validateMaxBuffer(maxBuffer) {\n  if (maxBuffer != null && !(typeof maxBuffer === 'number' && maxBuffer >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.maxBuffer')\n  }\n}\n\nmodule.exports = function execFileSync(file, args, options) {\n  var defaultOptions = {\n    encoding: 'buffer',\n    timeout: 0,\n    maxBuffer: 200 * 1024,\n    killSignal: 'SIGTERM',\n    cwd: null,\n    env: null,\n    shell: false\n  }\n\n  if (typeof args === 'object' && !Array.isArray(args)) {\n    // function (file, options)\n    options = Object.assign(defaultOptions, args)\n    args = []\n  } else {\n    // function (file)\n    options = Object.assign(defaultOptions, options || {})\n  }\n\n  // Validate the timeout, if present.\n  validateTimeout(options.timeout)\n\n  // Validate maxBuffer, if present.\n  validateMaxBuffer(options.maxBuffer)\n\n  var child = spawnSync(file, args, {\n    cwd: options.cwd,\n    env: options.env,\n    gid: options.gid,\n    uid: options.uid,\n    shell: options.shell,\n    encoding: options.encoding,\n    stdio: ['pipe', 'pipe', 'inherit']\n  })\n\n  if (child.status !== 0) {\n    var error = new Error('Failed to run: ' + String(child.stderr))\n    error.pid = child.pid\n    error.status = child.status\n    error.stdout = child.stdout\n    error.stderr = child.stderr\n    throw error\n  }\n\n  return child.stdout\n}\n","var execFileSync = require('./execFileSync')\n\nfunction normalizeExecArgs(command, options) {\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n  options.shell = typeof options.shell === 'string' ? options.shell : true\n\n  return {\n    file: command,\n    options: options\n  }\n}\n\nmodule.exports = function execSync(command, options) {\n  var opts = normalizeExecArgs(command, options)\n  return execFileSync(opts.file, opts.options)\n}\n","var Buffer = require('buffer').Buffer\n\nfunction handleBuffer(buffer, encoding) {\n  if (encoding === 'buffer') {\n    return buffer\n  }\n  if (encoding === 'NSData') {\n    return buffer.toNSData()\n  }\n  return buffer.toString(encoding)\n}\n\nmodule.exports = function handleData(data, encoding) {\n  var buffer = Buffer.from(data)\n\n  return handleBuffer(buffer, encoding)\n}\n","module.exports = function normalizeSpawnArguments(file, args, options) {\n  if (typeof file !== 'string' || file.length === 0) {\n    throw new Error('ERR_INVALID_ARG_TYPE')\n  }\n\n  if (Array.isArray(args)) {\n    args = args.slice(0)\n  } else if (\n    args !== undefined &&\n    (args === null || typeof args !== 'object')\n  ) {\n    throw new Error('ERR_INVALID_ARG_TYPE args')\n  } else {\n    options = args\n    args = []\n  }\n\n  if (options === undefined) {\n    options = {}\n  } else if (options === null || typeof options !== 'object') {\n    throw new Error('ERR_INVALID_ARG_TYPE options')\n  }\n\n  // Validate the cwd, if present.\n  if (options.cwd != null && typeof options.cwd !== 'string') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.cwd')\n  }\n\n  // Validate detached, if present.\n  if (options.detached != null && typeof options.detached !== 'boolean') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.detached')\n  }\n\n  // Validate the uid, if present.\n  if (options.uid != null && !Number.isInteger(options.uid)) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.uid')\n  }\n\n  // Validate the gid, if present.\n  if (options.gid != null && !Number.isInteger(options.gid)) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.gid')\n  }\n\n  // Validate the shell, if present.\n  if (\n    options.shell != null &&\n    typeof options.shell !== 'boolean' &&\n    typeof options.shell !== 'string'\n  ) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.shell')\n  }\n\n  // Validate argv0, if present.\n  if (options.argv0 != null && typeof options.argv0 !== 'string') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.argv0')\n  }\n\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n\n  if (options.shell) {\n    var command = [file].concat(args).join(' ')\n\n    if (typeof options.shell === 'string') {\n      file = options.shell\n    } else {\n      file = '/bin/bash'\n    }\n    args = ['-l', '-c', command]\n  }\n\n  if (typeof options.argv0 === 'string') {\n    args.unshift(options.argv0)\n  }\n\n  var stdio = ['pipe', 'pipe', 'pipe']\n\n  if (typeof options.stdio === 'string') {\n    if (options.stdio === 'inherit') {\n      stdio = [0, 1, 2]\n    } else {\n      stdio = [options.stdio, options.stdio, options.stdio]\n    }\n  } else if (Array.isArray(options.stdio)) {\n    if (options.stdio[0] || options.stdio[0] === 0) {\n      if (options.stdio[0] === 'inherit') {\n        stdio[0] = 0\n      } else {\n        stdio[0] = options.stdio[0]\n      }\n    }\n    if (options.stdio[1] || options.stdio[1] === 0) {\n      if (options.stdio[1] === 'inherit') {\n        stdio[1] = 1\n      } else {\n        stdio[1] = options.stdio[1]\n      }\n    }\n    if (options.stdio[2] || options.stdio[2] === 0) {\n      if (options.stdio[2] === 'inherit') {\n        stdio[2] = 2\n      } else {\n        stdio[2] = options.stdio[2]\n      }\n    }\n  }\n\n  var env = options.env\n\n  return {\n    file: file,\n    args: args,\n    options: options,\n    envPairs: env,\n    stdio: stdio\n  }\n}\n","/* globals NSPipe, NSTask, NSArray, NSString, coscript, __mocha__ */\nvar Buffer = require('buffer').Buffer\nvar EventEmitter = require('events')\nvar Readable = require('stream').Readable\nvar Writable = require('stream').Writable\n\nvar spawnSync = require('./spawnSync')\nvar normalizeSpawnArguments = require('./normalizeSpawnArguments')\n\nmodule.exports = function spawn(_command, _args, _options) {\n  var opts = normalizeSpawnArguments(_command, _args, _options)\n\n  var result = new EventEmitter()\n\n  if (opts.file[0] !== '.' && opts.file[0] !== '/' && opts.file[0] !== '~') {\n    // means that someone refered to an executable that might be in the path, let's find it\n    var whichChild = spawnSync(\n      '/bin/bash',\n      ['-l', '-c', 'which ' + opts.file],\n      { encoding: 'utf8' }\n    )\n    var resolvedCommand = String(whichChild.stdout || '').trim()\n    if (whichChild.err || !resolvedCommand.length) {\n      result.stderr = new EventEmitter()\n      result.stdout = new EventEmitter()\n\n      result.pid = '-1'\n\n      result.stderr.setEncoding = function setEncoding(encoding) {\n        result.stderr.encoding = encoding\n      }\n      result.stdout.setEncoding = function setEncoding(encoding) {\n        result.stdout.encoding = encoding\n      }\n      if (!resolvedCommand.length) {\n        result.emit('error', new Error(String(opts.file) + ' ENOENT'))\n      } else {\n        result.emit('error', whichChild.err)\n      }\n      return result\n    }\n    return spawn(resolvedCommand, _args, _options)\n  }\n\n  var options = opts.options\n\n  result.killed = false\n\n  var fiber = coscript.createFiber()\n\n  var task\n  var signal = null\n\n  var readingStderr = false\n  var readingStdout = false\n\n  result.stderr = new Readable({\n    read: function read() {\n      readingStderr = true\n    }\n  })\n  result.stdout = new Readable({\n    read: function read() {\n      readingStdout = true\n    }\n  })\n\n  function onStdout(data) {\n    if (data && data.length() && readingStdout) {\n      if (!result.stdout.push(Buffer.from(data))) {\n        readingStdout = false\n        task\n          .standardOutput()\n          .fileHandleForReading()\n          .setReadabilityHandler(null)\n      }\n    }\n  }\n  function onStderr(data) {\n    if (data && data.length() && readingStderr) {\n      if (!result.stderr.push(Buffer.from(data))) {\n        readingStderr = false\n        task\n          .standardError()\n          .fileHandleForReading()\n          .setReadabilityHandler(null)\n      }\n    }\n  }\n\n  result.sdtin = new Writable({\n    write: function write(chunk, encoding, callback) {\n      task\n        .standardInput()\n        .fileHandleForWriting()\n        .writeData(chunk.toNSData())\n      callback()\n    },\n    final: function finish(callback) {\n      task\n        .standardInput()\n        .fileHandleForWriting()\n        .closeFile()\n      callback()\n    }\n  })\n\n  result.sdtio = [result.sdtin, result.sdtout, result.sdterr]\n\n  try {\n    task = NSTask.alloc().init()\n\n    var inPipe = NSPipe.pipe()\n    var pipe = NSPipe.pipe()\n    var errPipe = NSPipe.pipe()\n\n    task.setStandardInput(inPipe)\n    task.setStandardOutput(pipe)\n    task.setStandardError(errPipe)\n\n    task\n      .standardOutput()\n      .fileHandleForReading()\n      .setReadabilityHandler(\n        __mocha__.createBlock_function(\n          'v16@?0@\"NSFileHandle\"8',\n          function readStdOut(fileHandle) {\n            try {\n              onStdout(fileHandle.availableData())\n            } catch (err) {\n              if (\n                typeof process !== 'undefined' &&\n                process.listenerCount &&\n                process.listenerCount('uncaughtException')\n              ) {\n                process.emit('uncaughtException', err, 'uncaughtException')\n              } else {\n                console.error(err)\n              }\n            }\n          }\n        )\n      )\n    task\n      .standardError()\n      .fileHandleForReading()\n      .setReadabilityHandler(\n        __mocha__.createBlock_function(\n          'v16@?0@\"NSFileHandle\"8',\n          function readStdOut(fileHandle) {\n            try {\n              onStderr(fileHandle.availableData())\n            } catch (err) {\n              if (\n                typeof process !== 'undefined' &&\n                process.listenerCount &&\n                process.listenerCount('uncaughtException')\n              ) {\n                process.emit('uncaughtException', err, 'uncaughtException')\n              } else {\n                console.error(err)\n              }\n            }\n          }\n        )\n      )\n\n    task.setLaunchPath(\n      NSString.stringWithString(opts.file).stringByExpandingTildeInPath()\n    )\n    task.arguments = NSArray.arrayWithArray(opts.args || [])\n    if (opts.envPairs) {\n      task.environment = opts.envPairs\n    }\n    if (options.cwd) {\n      task.setCurrentDirectoryPath(\n        NSString.stringWithString(options.cwd).stringByExpandingTildeInPath()\n      )\n    }\n\n    task.setTerminationHandler(\n      __mocha__.createBlock_function(\n        'v16@?0@\"NSTask\"8',\n        function handleTermination(_task) {\n          try {\n            _task\n              .standardError()\n              .fileHandleForReading()\n              .setReadabilityHandler(null)\n            _task\n              .standardOutput()\n              .fileHandleForReading()\n              .setReadabilityHandler(null)\n            result.stderr.emit('close')\n            result.stdout.emit('close')\n\n            result.killed = true\n\n            result.emit('close', Number(_task.terminationStatus()), signal)\n          } catch (err) {\n            if (\n              typeof process !== 'undefined' &&\n              process.listenerCount &&\n              process.listenerCount('uncaughtException')\n            ) {\n              process.emit('uncaughtException', err, 'uncaughtException')\n            } else {\n              console.error(err)\n            }\n          }\n          fiber.cleanup()\n        }\n      )\n    )\n\n    setImmediate(() => task.launch())\n  } catch (err) {\n    fiber.cleanup()\n    result.emit('error', err)\n    return result\n  }\n\n  result.kill = function kill(_signal) {\n    if (!result.killed) {\n      signal = _signal\n      task.terminate()\n    }\n  }\n\n  result.pid = String(task.processIdentifier())\n\n  return result\n}\n","/* globals NSPipe, NSTask, NSArray, NSString */\nvar handleData = require('./handleData')\nvar normalizeSpawnArguments = require('./normalizeSpawnArguments')\n\nfunction spawnSync(_command, _args, _options) {\n  var opts = normalizeSpawnArguments(_command, _args, _options)\n\n  if (opts.file[0] !== '.' && opts.file[0] !== '/' && opts.file[0] !== '~') {\n    // means that someone refered to an executable that might be in the path, let's find it\n    var whichChild = spawnSync(\n      '/bin/bash',\n      ['-l', '-c', 'which ' + opts.file],\n      { encoding: 'utf8' }\n    )\n    if (whichChild.err) {\n      return whichChild\n    }\n    var resolvedCommand = String(whichChild.stdout).trim()\n    if (!resolvedCommand.length) {\n      return {\n        err: new Error(String(opts.file) + ' ENOENT')\n      }\n    }\n    return spawnSync(resolvedCommand, _args, _options)\n  }\n\n  var options = opts.options\n\n  var pipe = NSPipe.pipe()\n  var errPipe = NSPipe.pipe()\n\n  try {\n    var task = NSTask.alloc().init()\n    task.setLaunchPath(\n      NSString.stringWithString(opts.file).stringByExpandingTildeInPath()\n    )\n    task.arguments = NSArray.arrayWithArray(opts.args || [])\n    if (opts.envPairs) {\n      task.environment = opts.envPairs\n    }\n\n    if (options.cwd) {\n      task.setCurrentDirectoryPath(\n        NSString.stringWithString(options.cwd).stringByExpandingTildeInPath()\n      )\n    }\n\n    task.setStandardOutput(pipe)\n    task.setStandardError(errPipe)\n\n    task.launch()\n    task.waitUntilExit()\n\n    var stdoutIgnored = false\n    var stderrIgnored = false\n\n    var data\n    var stdoutValue\n    var stderrValue\n\n    if (opts.stdio[1] === 'ignored') {\n      stdoutIgnored = true\n    } else if (opts.stdio[1] === 1) {\n      data = pipe.fileHandleForReading().readDataToEndOfFile()\n      stdoutValue = handleData(data, options.encoding || 'buffer')\n      console.log(stdoutValue)\n    } else if (opts.stdio[1] === 2) {\n      data = pipe.fileHandleForReading().readDataToEndOfFile()\n      stdoutValue = handleData(data, options.encoding || 'buffer')\n      console.error(stdoutValue)\n    }\n\n    if (opts.stdio[2] === 'ignored') {\n      stderrIgnored = true\n    } else if (opts.stdio[2] === 1) {\n      data = errPipe.fileHandleForReading().readDataToEndOfFile()\n      stderrValue = handleData(data, options.encoding || 'buffer')\n      console.log(stderrValue)\n    } else if (opts.stdio[2] === 2) {\n      data = errPipe.fileHandleForReading().readDataToEndOfFile()\n      stderrValue = handleData(data, options.encoding || 'buffer')\n      console.error(stderrValue)\n    }\n\n    return {\n      pid: String(task.processIdentifier()),\n      status: Number(task.terminationStatus()),\n      get stdout() {\n        if (stdoutIgnored) {\n          return null\n        }\n        if (stdoutValue) {\n          return stdoutValue\n        }\n        data = pipe.fileHandleForReading().readDataToEndOfFile()\n        return handleData(data, options.encoding || 'buffer')\n      },\n      get stderr() {\n        if (stderrIgnored) {\n          return null\n        }\n        if (stderrValue) {\n          return stdoutValue\n        }\n        data = errPipe.fileHandleForReading().readDataToEndOfFile()\n        return handleData(data, options.encoding || 'buffer')\n      }\n    }\n  } catch (err) {\n    return {\n      err: err\n    }\n  }\n}\n\nmodule.exports = spawnSync\n","/* let's try to match the API from Electron's Dialog\n(https://github.com/electron/electron/blob/master/docs/api/dialog.md) */\n\nmodule.exports = {\n  showOpenDialog: require('./open-dialog').openDialog,\n  showOpenDialogSync: require('./open-dialog').openDialogSync,\n  showSaveDialog: require('./save-dialog').saveDialog,\n  showSaveDialogSync: require('./save-dialog').saveDialogSync,\n  showMessageBox: require('./message-box').messageBox,\n  showMessageBoxSync: require('./message-box').messageBoxSync,\n  // showErrorBox: require('./error-box'),\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nvar typeMap = {\n  none: 0,\n  info: 1,\n  error: 2,\n  question: 1,\n  warning: 2,\n}\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  } else if (document.sketchObject) {\n    document = document.sketchObject\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSAlert.alloc().init()\n\n  if (options.type) {\n    dialog.alertStyle = typeMap[options.type] || 0\n  }\n\n  if (options.buttons && options.buttons.length) {\n    options.buttons.forEach(function addButton(button) {\n      dialog.addButtonWithTitle(\n        options.normalizeAccessKeys ? button.replace(/&/g, '') : button\n      )\n      // TODO: add keyboard shortcut if options.normalizeAccessKeys\n    })\n  }\n\n  if (typeof options.defaultId !== 'undefined') {\n    var buttons = dialog.buttons()\n    if (options.defaultId < buttons.length) {\n      // Focus the button at defaultId if the user opted to do so.\n      // The first button added gets set as the default selected.\n      // So remove that default, and make the requested button the default.\n      buttons[0].setKeyEquivalent('')\n      buttons[options.defaultId].setKeyEquivalent('\\r')\n    }\n  }\n\n  if (options.title) {\n    // not shown on macOS\n  }\n\n  if (options.message) {\n    dialog.messageText = options.message\n  }\n\n  if (options.detail) {\n    dialog.informativeText = options.detail\n  }\n\n  if (options.checkboxLabel) {\n    dialog.showsSuppressionButton = true\n    dialog.suppressionButton().title = options.checkboxLabel\n\n    if (typeof options.checkboxChecked !== 'undefined') {\n      dialog.suppressionButton().state = options.checkboxChecked\n        ? NSOnState\n        : NSOffState\n    }\n  }\n\n  if (options.icon) {\n    if (typeof options.icon === 'string') {\n      options.icon = NSImage.alloc().initWithContentsOfFile(options.icon)\n    }\n    dialog.icon = options.icon\n  } else if (\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle() &&\n    __command.pluginBundle().icon()\n  ) {\n    dialog.icon = __command.pluginBundle().icon()\n  } else {\n    var icon = NSImage.imageNamed('plugins')\n    if (icon) {\n      dialog.icon = icon\n    }\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowmessageboxbrowserwindow-options\nmodule.exports.messageBox = function messageBox(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return {\n        response:\n          setup.options.buttons && setup.options.buttons.length\n            ? Number(returnCode) - 1000\n            : Number(returnCode),\n        checkboxChecked: _dialog.suppressionButton().state() == NSOnState,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowmessageboxsyncbrowserwindow-options\nmodule.exports.messageBoxSync = function messageBoxSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return setup.options.buttons && setup.options.buttons.length\n        ? Number(returnCode) - 1000\n        : Number(returnCode)\n    },\n    setup.document\n  )\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSOpenPanel.openPanel()\n\n  if (options.title) {\n    dialog.title = options.title\n  }\n\n  if (options.defaultPath) {\n    dialog.setDirectoryURL(utils.getURL(options.defaultPath))\n  }\n\n  if (options.buttonLabel) {\n    dialog.prompt = options.buttonLabel\n  }\n\n  if (options.filters && options.filters.length) {\n    var exts = []\n    options.filters.forEach(function setFilter(filter) {\n      filter.extensions.forEach(function setExtension(ext) {\n        exts.push(ext)\n      })\n    })\n\n    dialog.allowedFileTypes = exts\n  }\n\n  var hasProperty =\n    Array.isArray(options.properties) && options.properties.length > 0\n  dialog.canChooseFiles =\n    hasProperty && options.properties.indexOf('openFile') !== -1\n  dialog.canChooseDirectories =\n    hasProperty && options.properties.indexOf('openDirectory') !== -1\n  dialog.allowsMultipleSelection =\n    hasProperty && options.properties.indexOf('multiSelections') !== -1\n  dialog.showsHiddenFiles =\n    hasProperty && options.properties.indexOf('showHiddenFiles') !== -1\n  dialog.canCreateDirectories =\n    hasProperty && options.properties.indexOf('createDirectory') !== -1\n  dialog.resolvesAliases =\n    !hasProperty || options.properties.indexOf('noResolveAliases') === -1\n  dialog.treatsFilePackagesAsDirectories =\n    hasProperty && options.properties.indexOf('treatPackageAsDirectory') !== -1\n\n  if (options.message) {\n    dialog.message = options.message\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowopendialogbrowserwindow-options\nmodule.exports.openDialog = function openDialog(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      if (returnCode != NSOKButton) {\n        return {\n          canceled: true,\n          filePaths: [],\n        }\n      }\n      var result = []\n      var urls = _dialog.URLs()\n      for (var k = 0; k < urls.length; k += 1) {\n        result.push(String(urls[k].path()))\n      }\n      return {\n        canceled: false,\n        filePaths: result,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowopendialogsyncbrowserwindow-options\nmodule.exports.openDialogSync = function openDialogSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      if (returnCode != NSOKButton) {\n        return []\n      }\n      var result = []\n      var urls = _dialog.URLs()\n      for (var k = 0; k < urls.length; k += 1) {\n        result.push(String(urls[k].path()))\n      }\n      return result\n    },\n    setup.document\n  )\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSSavePanel.savePanel()\n\n  if (options.title) {\n    dialog.title = options.title\n  }\n\n  if (options.defaultPath) {\n    // that's a path\n    dialog.setDirectoryURL(utils.getURL(options.defaultPath))\n\n    if (\n      options.defaultPath[0] === '.' ||\n      options.defaultPath[0] === '~' ||\n      options.defaultPath[0] === '/'\n    ) {\n      var parts = options.defaultPath.split('/')\n      if (parts.length > 1 && parts[parts.length - 1]) {\n        dialog.setNameFieldStringValue(parts[parts.length - 1])\n      }\n    } else {\n      dialog.setNameFieldStringValue(options.defaultPath)\n    }\n  }\n\n  if (options.buttonLabel) {\n    dialog.prompt = options.buttonLabel\n  }\n\n  if (options.filters && options.filters.length) {\n    var exts = []\n    options.filters.forEach(function setFilter(filter) {\n      filter.extensions.forEach(function setExtension(ext) {\n        exts.push(ext)\n      })\n    })\n\n    dialog.allowedFileTypes = exts\n  }\n\n  if (options.message) {\n    dialog.message = options.message\n  }\n\n  if (options.nameFieldLabel) {\n    dialog.nameFieldLabel = options.nameFieldLabel\n  }\n\n  if (options.showsTagField) {\n    dialog.showsTagField = options.showsTagField\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowsavedialogbrowserwindow-options\nmodule.exports.saveDialog = function saveDialog(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return {\n        canceled: returnCode != NSOKButton,\n        filePath:\n          returnCode == NSOKButton ? String(_dialog.URL().path()) : undefined,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowsavedialogsyncbrowserwindow-options\nmodule.exports.saveDialogSync = function saveDialogSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return returnCode == NSOKButton ? String(_dialog.URL().path()) : undefined\n    },\n    setup.document\n  )\n}\n","module.exports.getURL = function getURL(path) {\n  return NSURL.URLWithString(\n    String(\n      NSString.stringWithString(path).stringByExpandingTildeInPath()\n    ).replace(/ /g, '%20')\n  )\n}\n\nmodule.exports.runDialog = function runDialog(dialog, getResult, document) {\n  if (!document) {\n    var returnCode = dialog.runModal()\n    return Promise.resolve(getResult(dialog, returnCode))\n  }\n\n  var fiber = coscript.createFiber()\n\n  var window = (document.sketchObject || document).documentWindow()\n\n  return new Promise(function p(resolve, reject) {\n    dialog.beginSheetModalForWindow_completionHandler(\n      window,\n      __mocha__.createBlock_function('v16@?0q8', function onCompletion(\n        _returnCode\n      ) {\n        try {\n          resolve(getResult(dialog, _returnCode))\n        } catch (err) {\n          reject(err)\n        }\n        NSApp.endSheet(dialog)\n        if (fiber) {\n          fiber.cleanup()\n        } else {\n          coscript.shouldKeepAround = false\n        }\n      })\n    )\n  })\n}\n\nmodule.exports.runDialogSync = function runDialog(dialog, getResult, document) {\n  var returnCode\n\n  if (!document) {\n    returnCode = dialog.runModal()\n    return getResult(dialog, returnCode)\n  }\n\n  var window = (document.sketchObject || document).documentWindow()\n\n  dialog.beginSheetModalForWindow_completionHandler(\n    window,\n    __mocha__.createBlock_function('v16@?0q8', function onCompletion(\n      _returnCode\n    ) {\n      NSApp.stopModalWithCode(_returnCode)\n    })\n  )\n\n  returnCode = NSApp.runModalForWindow(window)\n  NSApp.endSheet(dialog)\n  return getResult(dialog, returnCode)\n}\n","// TODO: async. Should probably be done with NSFileHandle and some notifications\n// TODO: file descriptor. Needs to be done with NSFileHandle\nvar Buffer = require(\"buffer\").Buffer;\nvar utils = require(\"./utils\");\nvar parseStat = utils.parseStat;\nvar fsError = utils.fsError;\nvar fsErrorForPath = utils.fsErrorForPath;\nvar encodingFromOptions = utils.encodingFromOptions;\nvar NOT_IMPLEMENTED = utils.NOT_IMPLEMENTED;\n\nmodule.exports.constants = {\n  F_OK: 0,\n  R_OK: 4,\n  W_OK: 2,\n  X_OK: 1\n};\n\nmodule.exports.access = NOT_IMPLEMENTED(\"access\");\n\nmodule.exports.accessSync = function(path, mode) {\n  mode = mode | 0;\n  var fileManager = NSFileManager.defaultManager();\n\n  switch (mode) {\n    case 0:\n      canAccess = module.exports.existsSync(path);\n      break;\n    case 1:\n      canAccess = Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 2:\n      canAccess = Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 3:\n      canAccess =\n        Boolean(Number(fileManager.isExecutableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 4:\n      canAccess = Boolean(Number(fileManager.isReadableFileAtPath(path)));\n      break;\n    case 5:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 6:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 7:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n  }\n\n  if (!canAccess) {\n    throw new Error(\"Can't access \" + String(path));\n  }\n};\n\nmodule.exports.appendFile = NOT_IMPLEMENTED(\"appendFile\");\n\nmodule.exports.appendFileSync = function(file, data, options) {\n  if (!module.exports.existsSync(file)) {\n    return module.exports.writeFileSync(file, data, options);\n  }\n\n  var handle = NSFileHandle.fileHandleForWritingAtPath(file);\n  handle.seekToEndOfFile();\n\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  handle.writeData(nsdata);\n};\n\nmodule.exports.chmod = NOT_IMPLEMENTED(\"chmod\");\n\nmodule.exports.chmodSync = function(path, mode) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFilePosixPermissions: mode\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.chown = NOT_IMPLEMENTED(\"chown\");\nmodule.exports.chownSync = NOT_IMPLEMENTED(\"chownSync\");\n\nmodule.exports.close = NOT_IMPLEMENTED(\"close\");\nmodule.exports.closeSync = NOT_IMPLEMENTED(\"closeSync\");\n\nmodule.exports.copyFile = NOT_IMPLEMENTED(\"copyFile\");\n\nmodule.exports.copyFileSync = function(path, dest, flags) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.copyItemAtPath_toPath_error(path, dest, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.createReadStream = NOT_IMPLEMENTED(\"createReadStream\");\nmodule.exports.createWriteStream = NOT_IMPLEMENTED(\"createWriteStream\");\n\nmodule.exports.exists = NOT_IMPLEMENTED(\"exists\");\n\nmodule.exports.existsSync = function(path) {\n  var fileManager = NSFileManager.defaultManager();\n  return Boolean(Number(fileManager.fileExistsAtPath(path)));\n};\n\nmodule.exports.fchmod = NOT_IMPLEMENTED(\"fchmod\");\nmodule.exports.fchmodSync = NOT_IMPLEMENTED(\"fchmodSync\");\nmodule.exports.fchown = NOT_IMPLEMENTED(\"fchown\");\nmodule.exports.fchownSync = NOT_IMPLEMENTED(\"fchownSync\");\nmodule.exports.fdatasync = NOT_IMPLEMENTED(\"fdatasync\");\nmodule.exports.fdatasyncSync = NOT_IMPLEMENTED(\"fdatasyncSync\");\nmodule.exports.fstat = NOT_IMPLEMENTED(\"fstat\");\nmodule.exports.fstatSync = NOT_IMPLEMENTED(\"fstatSync\");\nmodule.exports.fsync = NOT_IMPLEMENTED(\"fsync\");\nmodule.exports.fsyncSync = NOT_IMPLEMENTED(\"fsyncSync\");\nmodule.exports.ftruncate = NOT_IMPLEMENTED(\"ftruncate\");\nmodule.exports.ftruncateSync = NOT_IMPLEMENTED(\"ftruncateSync\");\nmodule.exports.futimes = NOT_IMPLEMENTED(\"futimes\");\nmodule.exports.futimesSync = NOT_IMPLEMENTED(\"futimesSync\");\n\nmodule.exports.lchmod = NOT_IMPLEMENTED(\"lchmod\");\nmodule.exports.lchmodSync = NOT_IMPLEMENTED(\"lchmodSync\");\nmodule.exports.lchown = NOT_IMPLEMENTED(\"lchown\");\nmodule.exports.lchownSync = NOT_IMPLEMENTED(\"lchownSync\");\n\nmodule.exports.link = NOT_IMPLEMENTED(\"link\");\n\nmodule.exports.linkSync = function(existingPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.linkItemAtPath_toPath_error(existingPath, newPath, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(existingPath, undefined, err.value());\n  }\n};\n\nmodule.exports.lstat = NOT_IMPLEMENTED(\"lstat\");\n\nmodule.exports.lstatSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.attributesOfItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return parseStat(result);\n};\n\nmodule.exports.mkdir = NOT_IMPLEMENTED(\"mkdir\");\n\nmodule.exports.mkdirSync = function(path, options) {\n  var mode = 0o777;\n  var recursive = false;\n  if (options && options.mode) {\n    mode = options.mode;\n  }\n  if (options && options.recursive) {\n    recursive = options.recursive;\n  }\n  if (typeof options === \"number\") {\n    mode = options;\n  }\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(\n    path,\n    recursive,\n    {\n      NSFilePosixPermissions: mode\n    },\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.mkdtemp = NOT_IMPLEMENTED(\"mkdtemp\");\n\nmodule.exports.mkdtempSync = function(path) {\n  function makeid() {\n    var text = \"\";\n    var possible =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (var i = 0; i < 6; i++)\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n  }\n  var tempPath = path + makeid();\n  module.exports.mkdirSync(tempPath);\n  return tempPath;\n};\n\nmodule.exports.open = NOT_IMPLEMENTED(\"open\");\nmodule.exports.openSync = NOT_IMPLEMENTED(\"openSync\");\n\nmodule.exports.read = NOT_IMPLEMENTED(\"read\");\n\nmodule.exports.readdir = NOT_IMPLEMENTED(\"readdir\");\n\nmodule.exports.readdirSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n  var fileManager = NSFileManager.defaultManager();\n  var paths = fileManager.subpathsAtPath(path);\n  var arr = [];\n  for (var i = 0; i < paths.length; i++) {\n    var pathName = paths[i];\n    arr.push(encoding === \"buffer\" ? Buffer.from(pathName) : String(pathName));\n  }\n  return arr;\n};\n\nmodule.exports.readFile = NOT_IMPLEMENTED(\"readFile\");\n\nmodule.exports.readFileSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"buffer\");\n  var fileManager = NSFileManager.defaultManager();\n  var data = fileManager.contentsAtPath(path);\n  if (!data) {\n    throw fsErrorForPath(path, false);\n  }\n\n  var buffer = Buffer.from(data);\n\n  if (encoding === \"buffer\") {\n    return buffer;\n  } else if (encoding === \"NSData\") {\n    return buffer.toNSData();\n  } else {\n    return buffer.toString(encoding);\n  }\n};\n\nmodule.exports.readlink = NOT_IMPLEMENTED(\"readlink\");\n\nmodule.exports.readlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.destinationOfSymbolicLinkAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return String(result);\n};\n\nmodule.exports.readSync = NOT_IMPLEMENTED(\"readSync\");\n\nmodule.exports.realpath = NOT_IMPLEMENTED(\"realpath\");\nmodule.exports.realpath.native = NOT_IMPLEMENTED(\"realpath.native\");\n\nmodule.exports.realpathSync = function(path) {\n  return String(NSString.stringWithString(path).stringByResolvingSymlinksInPath());\n};\n\nmodule.exports.realpathSync.native = NOT_IMPLEMENTED(\"realpathSync.native\");\n\nmodule.exports.rename = NOT_IMPLEMENTED(\"rename\");\n\nmodule.exports.renameSync = function(oldPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.moveItemAtPath_toPath_error(oldPath, newPath, err);\n\n  var error = err.value();\n\n  if (error !== null) {\n    // if there is already a file, we need to overwrite it\n    if (\n      String(error.domain()) === \"NSCocoaErrorDomain\" &&\n      Number(error.code()) === 516\n    ) {\n      var err2 = MOPointer.alloc().init();\n      fileManager.replaceItemAtURL_withItemAtURL_backupItemName_options_resultingItemURL_error(\n        NSURL.fileURLWithPath(newPath),\n        NSURL.fileURLWithPath(oldPath),\n        null,\n        NSFileManagerItemReplacementUsingNewMetadataOnly,\n        null,\n        err2\n      );\n      if (err2.value() !== null) {\n        throw fsErrorForPath(oldPath, undefined, err2.value());\n      }\n    } else {\n      throw fsErrorForPath(oldPath, undefined, error);\n    }\n  }\n};\n\nmodule.exports.rmdir = NOT_IMPLEMENTED(\"rmdir\");\n\nmodule.exports.rmdirSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (!isDirectory) {\n    throw fsError(\"ENOTDIR\", {\n      path: path,\n      syscall: \"rmdir\"\n    });\n  }\n  fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, true, err.value(), \"rmdir\");\n  }\n};\n\nmodule.exports.stat = NOT_IMPLEMENTED(\"stat\");\n\n// the only difference with lstat is that we resolve symlinks\n//\n// > lstat() is identical to stat(), except that if pathname is a symbolic\n// > link, then it returns information about the link itself, not the file\n// > that it refers to.\n// http://man7.org/linux/man-pages/man2/lstat.2.html\nmodule.exports.statSync = function(path) {\n  return module.exports.lstatSync(module.exports.realpathSync(path));\n};\n\nmodule.exports.symlink = NOT_IMPLEMENTED(\"symlink\");\n\nmodule.exports.symlinkSync = function(target, path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.createSymbolicLinkAtPath_withDestinationPath_error(\n    path,\n    target,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.truncate = NOT_IMPLEMENTED(\"truncate\");\n\nmodule.exports.truncateSync = function(path, len) {\n  var hFile = NSFileHandle.fileHandleForUpdatingAtPath(sFilePath);\n  hFile.truncateFileAtOffset(len || 0);\n  hFile.closeFile();\n};\n\nmodule.exports.unlink = NOT_IMPLEMENTED(\"unlink\");\n\nmodule.exports.unlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (isDirectory) {\n    throw fsError(\"EPERM\", {\n      path: path,\n      syscall: \"unlink\"\n    });\n  }\n  var result = fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.unwatchFile = NOT_IMPLEMENTED(\"unwatchFile\");\n\nmodule.exports.utimes = NOT_IMPLEMENTED(\"utimes\");\n\nmodule.exports.utimesSync = function(path, aTime, mTime) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFileModificationDate: aTime\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.watch = NOT_IMPLEMENTED(\"watch\");\nmodule.exports.watchFile = NOT_IMPLEMENTED(\"watchFile\");\n\nmodule.exports.write = NOT_IMPLEMENTED(\"write\");\n\nmodule.exports.writeFile = NOT_IMPLEMENTED(\"writeFile\");\n\nmodule.exports.writeFileSync = function(path, data, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  nsdata.writeToFile_atomically(path, true);\n};\n\nmodule.exports.writeSync = NOT_IMPLEMENTED(\"writeSync\");\n","module.exports.parseStat = function parseStat(result) {\n  return {\n    dev: String(result.NSFileDeviceIdentifier),\n    // ino: 48064969, The file system specific \"Inode\" number for the file.\n    mode: result.NSFileType | result.NSFilePosixPermissions,\n    nlink: Number(result.NSFileReferenceCount),\n    uid: String(result.NSFileOwnerAccountID),\n    gid: String(result.NSFileGroupOwnerAccountID),\n    // rdev: 0, A numeric device identifier if the file is considered \"special\".\n    size: Number(result.NSFileSize),\n    // blksize: 4096, The file system block size for i/o operations.\n    // blocks: 8, The number of blocks allocated for this file.\n    atimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    mtimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    ctimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    birthtimeMs:\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000,\n    atime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ), // the 0.5 comes from the node source. Not sure why it's added but in doubt...\n    mtime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    ctime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    birthtime: new Date(\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    isBlockDevice: function() {\n      return result.NSFileType === NSFileTypeBlockSpecial;\n    },\n    isCharacterDevice: function() {\n      return result.NSFileType === NSFileTypeCharacterSpecial;\n    },\n    isDirectory: function() {\n      return result.NSFileType === NSFileTypeDirectory;\n    },\n    isFIFO: function() {\n      return false;\n    },\n    isFile: function() {\n      return result.NSFileType === NSFileTypeRegular;\n    },\n    isSocket: function() {\n      return result.NSFileType === NSFileTypeSocket;\n    },\n    isSymbolicLink: function() {\n      return result.NSFileType === NSFileTypeSymbolicLink;\n    }\n  };\n};\n\nvar ERRORS = {\n  EPERM: {\n    message: \"operation not permitted\",\n    errno: -1\n  },\n  ENOENT: {\n    message: \"no such file or directory\",\n    errno: -2\n  },\n  EACCES: {\n    message: \"permission denied\",\n    errno: -13\n  },\n  ENOTDIR: {\n    message: \"not a directory\",\n    errno: -20\n  },\n  EISDIR: {\n    message: \"illegal operation on a directory\",\n    errno: -21\n  }\n};\n\nfunction fsError(code, options) {\n  var error = new Error(\n    code +\n      \": \" +\n      ERRORS[code].message +\n      \", \" +\n      (options.syscall || \"\") +\n      (options.path ? \" '\" + options.path + \"'\" : \"\")\n  );\n\n  Object.keys(options).forEach(function(k) {\n    error[k] = options[k];\n  });\n\n  error.code = code;\n  error.errno = ERRORS[code].errno;\n\n  return error;\n}\n\nmodule.exports.fsError = fsError;\n\nmodule.exports.fsErrorForPath = function fsErrorForPath(\n  path,\n  shouldBeDir,\n  err,\n  syscall\n) {\n  var fileManager = NSFileManager.defaultManager();\n  var doesExist = fileManager.fileExistsAtPath(path);\n  if (!doesExist) {\n    return fsError(\"ENOENT\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  var isReadable = fileManager.isReadableFileAtPath(path);\n  if (!isReadable) {\n    return fsError(\"EACCES\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  if (typeof shouldBeDir !== \"undefined\") {\n    var isDirectory = module.exports.lstatSync(path).isDirectory();\n    if (isDirectory && !shouldBeDir) {\n      return fsError(\"EISDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    } else if (!isDirectory && shouldBeDir) {\n      return fsError(\"ENOTDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    }\n  }\n  return new Error(err || \"Unknown error while manipulating \" + path);\n};\n\nmodule.exports.encodingFromOptions = function encodingFromOptions(\n  options,\n  defaultValue\n) {\n  return options && options.encoding\n    ? String(options.encoding)\n    : options\n    ? String(options)\n    : defaultValue;\n};\n\nmodule.exports.NOT_IMPLEMENTED = function NOT_IMPLEMENTED(name) {\n  return function() {\n    throw new Error(\n      \"fs.\" +\n        name +\n        \" is not implemented yet. If you feel like implementing it, any contribution will be gladly accepted on https://github.com/skpm/fs\"\n    );\n  };\n};\n","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","'use strict';\n\n/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = finallyConstructor;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nmodule.exports = Promise;\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16)\n  var g = parseInt(hex.slice(2, 4), 16)\n  var b = parseInt(hex.slice(4, 6), 16)\n  var a = parseInt(hex.slice(6, 8), 16)\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function(browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function() {\n    return panel.close()\n  }\n\n  browserWindow.close = function() {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function() {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function() {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function() {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function() {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function() {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function() {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function() {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function() {\n    return false\n  }\n\n  browserWindow.maximize = function() {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function() {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function() {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function() {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function() {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function() {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function(fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function() {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function(aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function(bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function() {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens()\n      .firstObject()\n      .frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function(bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function() {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function() {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function(width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function() {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function(width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function() {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function(resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function() {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function(movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function() {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function(minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function() {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function(maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function() {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function(fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function(closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function() {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function(top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function() {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function() {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function(x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function(title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function() {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function(flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function() {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function() {\n    return webview\n  }\n\n  browserWindow.loadURL = function(url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' +\n          __command\n            .pluginBundle()\n            .urlForResourceNamed(url)\n            .path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function() {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function(hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function() {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function(opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function() {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function(visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function(ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function(enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function(autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function(type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function(colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function() {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function(button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  JS_BRIDGE_RESULT_SUCCESS: '__skpm_sketchBridge_success',\n  JS_BRIDGE_RESULT_ERROR: '__skpm_sketchBridge_error',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function(webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && el.tagName === \"SELECT\") {' + // select needs special handling\n    '  var event = document.createEvent(\"MouseEvents\");' +\n    '  event.initMouseEvent(\"mousedown\", true, true, window);' +\n    '  el.dispatchEvent(event);' +\n    '} else if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function(resolve, reject) {\n        browserWindow.once('ready-to-show', function() {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function(resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function(res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function(err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function(script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || NSUUID.UUID().UUIDString()\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  let title = options.title\n  if (options.frame === false) {\n    title = undefined\n  } else if (\n    typeof title === 'undefined' &&\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle()\n  ) {\n    title = __command.pluginBundle().name()\n  }\n\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function(event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function() {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    var observer = threadDictionary[identifier + '.themeObserver']\n    if (observer) {\n      NSApplication.sharedApplication().removeObserver_forKeyPath(\n        observer,\n        'effectiveAppearance'\n      )\n      threadDictionary.removeObjectForKey(identifier + '.themeObserver')\n    }\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function() {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function(identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function(panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    '  if (!actionName) {' +\n    \"    throw new Error('missing action name')\" +\n    '  }' +\n    '  var id = String(Math.random()).replace(\".\", \"\");' +\n    '    var args = [].slice.call(arguments);' +\n    '    args.unshift(id);' +\n    '  return new Promise(function (resolve, reject) {' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n    '\" + id] = resolve;' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n    '\" + id] = reject;' +\n    '    window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(JSON.stringify(args));' +\n    '  });' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n\nmodule.exports.setupHandler = function(browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function() {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function(webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\nvar ThemeObserverClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function(browserWindow, panel, webview, options) {\n  if (!ThemeObserverClass) {\n    ThemeObserverClass = new ObjCClass({\n      utils: null,\n\n      'observeValueForKeyPath:ofObject:change:context:': function() {\n        this.utils.executeJavaScript(\n          \"document.body.classList.remove('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'light'\n              : 'dark') +\n            \"'); document.body.classList.add('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'dark'\n              : 'light') +\n            \"')\"\n        )\n      },\n    })\n  }\n\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function() {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function() {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function() {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function() {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function() {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function() {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function() {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function() {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function() {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function() {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function() {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function(webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function() {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function() {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function(\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function() {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web view’s web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function() {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function(_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var themeObserver = ThemeObserverClass.new({\n    utils: {\n      executeJavaScript(script) {\n        webview.evaluateJavaScript_completionHandler(script, null)\n      },\n    },\n  })\n\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    \"document.addEventListener('DOMContentLoaded', function() { document.body.classList.add('__skpm-\" +\n      (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n        ? 'dark'\n        : 'light') +\n      \"') }, false)\",\n    0,\n    true\n  )\n  webview\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n\n  NSApplication.sharedApplication().addObserver_forKeyPath_options_context(\n    themeObserver,\n    'effectiveAppearance',\n    NSKeyValueChangeNewKey,\n    null\n  )\n\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n  threadDictionary[browserWindow.id + '.themeObserver'] = themeObserver\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit(id, type) {\n        if (!type) {\n          webview.evaluateJavaScript_completionHandler(\n            CONSTANTS.JS_BRIDGE_RESULT_SUCCESS + id + '()',\n            null\n          )\n          return\n        }\n\n        var args = []\n        for (var i = 2; i < arguments.length; i += 1) args.push(arguments[i])\n\n        var listeners = browserWindow.webContents.listeners(type)\n\n        Promise.all(\n          listeners.map(function(l) {\n            return Promise.resolve().then(function() {\n              return l.apply(l, args)\n            })\n          })\n        )\n          .then(function(res) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n                id +\n                '(' +\n                JSON.stringify(res) +\n                ')',\n              null\n            )\n          })\n          .catch(function(err) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n                id +\n                '(' +\n                JSON.stringify(err) +\n                ')',\n              null\n            )\n          })\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function() {\n    return String(webview.url())\n  }\n\n  webContents.getTitle = function() {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function() {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function() {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function() {\n    return !webview.loading()\n  }\n\n  webContents.stop = function() {\n    webview.stopLoading()\n  }\n  webContents.reload = function() {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function() {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function() {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function() {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function(offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function() {\n    webview.goBack()\n  }\n  webContents.goForward = function() {\n    webview.goForward()\n  }\n  webContents.goToIndex = function(index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function(offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function(/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function() {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function(css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.insertJS = function(source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function(/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function(factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function(callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function(level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function(callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function() {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function() {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","export default {\n  name: \"dark\",\n  text: \"#E6E4EB\",\n  bg: \"#2D2D2D\",\n  previewColor: \"#F3F2F5\",\n\n  input: {\n    background: \"#373737\",\n    color: \"#F3F2F5\",\n    border: \"#454545\",\n    borderActive: \"#1384FF\"\n  },\n\n  button: {\n    color: \"#F3F2F5\",\n    bgColor: \"rgba(255,255,255,0.25)\",\n    border: \"#636363\",\n    bgActive: \"rgba(255,255,255,0.10)\"\n  },\n\n  secondaryButton: {\n    borderColor: \"#636363\",\n    textColor: \"#F3F2F5\"\n  },\n\n  CTAButton: {\n    bgColor: \"#1384FF\",\n    textColor: \"#fff\",\n    bgActive: \"#0F72DB\"\n  },\n\n  radio: {\n    selectedColor: \"#1384FF\",\n    border: \"#1384FF\"\n  }\n}\n","import dark from \"./dark\"\nimport light from \"./light\"\n\nexport default theme => {\n  if (theme === \"dark\") {\n    return dark\n  }\n  return light\n}\n","export default {\n  name: \"light\",\n  text: \"#747474\",\n  bg: \"#F7F7F7\",\n  previewColor: \"#242424\",\n\n  input: {\n    background: \"#FBFBFB\",\n    color: \"#505050\",\n    border: \"#E4E4E4\",\n    borderActive: \"#1384FF\"\n  },\n\n  button: {\n    color: \"#505050\",\n    bgColor: \"#FBFBFB\",\n    border: \"#E4E4E4\",\n    bgActive: \"#F3F2F5\"\n  },\n\n  secondaryButton: {\n    borderColor: \"#B2AEBD\",\n    textColor: \"#817B8F\"\n  },\n\n  CTAButton: {\n    bgColor: \"#1384FF\",\n    textColor: \"#fff\",\n    bgActive: \"#0F72DB\"\n  },\n\n  radio: {\n    selectedColor: \"#969696\",\n    border: \"#969696\"\n  }\n}\n","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/fedcb36887af924ae92824d43f90ed04.html\";","import theUI from './lib/TheUI'\n\nexport default function() {\n\tconst options = {\n\t\tidentifier: 'exportMetadata.ui',\n\t\ttitle: 'Export Metadata',\n\t\tredirectTo: '/export_metadata',\n\t\twidth: 600,\n\t\theight: 310,\n\t}\n\n\ttheUI(options)\n}\n","export const TocPageName = \"Table of Contents\"\n\nexport const ArtboardSortEnum = {\n  Top2BottomByLayerList: 1,\n  Bottom2TopByLayerList: 2,\n  Left2RightByArtboard: 3,\n  Right2LeftByArtboard: 4,\n  Top2BottomByArtboard: 5,\n}\nexport const ArtbaordLayersSortEnum = {\n  Top2BottomByLayerList: 1,\n  Top2BottomByLayerList: 2,\n}\n","import { getArtboardsSorted } from './Utilities';\nimport { ArtboardSortEnum } from './Constants';\n\nlet Sketch = require('sketch');\nlet Page = require('sketch/dom').Page;\nlet Artboard = require('sketch/dom').Artboard;\nlet Group = require('sketch/dom').Group;\nlet Text = require('sketch/dom').Text;\nlet ShapePath = require('sketch/dom').ShapePath;\nlet Settings = require('sketch/settings');\nlet UI = require('sketch/ui');\n\nlet document = require('sketch/dom').getSelectedDocument();\n\nlet browserWindow = null;\nlet webContents = null;\n\nlet headingsMap = new Map();\nlet noParentHeadingArtboard;\nlet invalidHeadingOverride;\n\nlet ContentWidth = 7000;\nlet ContentHeight = 4949;\nlet GroupSpacing = 700;\nlet GroupTopMargin = 500;\nlet GroupLeftAndRightMargin = 200;\nlet GroupCounts = 3;\nlet GroupWidth = (ContentWidth - GroupLeftAndRightMargin * 2 - GroupSpacing * 2) / GroupCounts;\n\nfunction checkArtboardSort(artboardSort) {\n\tif (artboardSort === 'Top to Bottom') {\n\t\treturn ArtboardSortEnum.Top2BottomByLayerList;\n\t} else if (artboardSort === 'Bottom to Top') {\n\t\treturn ArtboardSortEnum.Bottom2TopByLayerList;\n\t} else if (artboardSort === 'Left to Right') {\n\t\treturn ArtboardSortEnum.Left2RightByArtboard;\n\t} else if (artboardSort === 'Right to Left') {\n\t\treturn ArtboardSortEnum.Right2LeftByArtboard;\n\t} else if (artboardSort === 'Top to Bottom 1') {\n\t\treturn ArtboardSortEnum.Top2BottomByArtboard;\n\t}\n}\n\nfunction createHeading(artboard, originalX, originalY, headingLevel, headingText, pageNumber) {\n\tlet groupHeight;\n\n\t// 序号及标题\n\tlet serialAndContentX;\n\tlet serialAndContentHeight;\n\tlet serialAndContentFontSize;\n\tlet serialAndContentFontWeight;\n\tlet serialAndContentFontColor;\n\tif (headingLevel === 1) {\n\t\tserialAndContentX = 0;\n\t\tserialAndContentHeight = 90;\n\t\tserialAndContentFontSize = 64;\n\t\tserialAndContentFontWeight = 6; // Medium\n\t\tserialAndContentFontColor = '#333333';\n\t\tgroupHeight = serialAndContentHeight;\n\t} else if (headingLevel === 2) {\n\t\tserialAndContentX = 80;\n\t\tserialAndContentHeight = 78;\n\t\tserialAndContentFontSize = 56;\n\t\tserialAndContentFontWeight = 4; // Regular\n\t\tserialAndContentFontColor = '#333333';\n\t\tgroupHeight = serialAndContentHeight;\n\t} else {\n\t\tserialAndContentX = 160;\n\t\tserialAndContentHeight = 67;\n\t\tserialAndContentFontSize = 48;\n\t\tserialAndContentFontWeight = 4; // Regular\n\t\tserialAndContentFontColor = '#666666';\n\t\tgroupHeight = serialAndContentHeight;\n\t}\n\tlet serialAndContent = new Text({\n\t\ttext: headingText, // NOTE: list text first! text maybe change the name\n\t\tname: 'serialAndContent',\n\t\tstyle: {\n\t\t\tborders: [],\n\t\t\tfontFamily: 'PingFang SC',\n\t\t\tfontSize: serialAndContentFontSize,\n\t\t\tfontWeight: serialAndContentFontWeight,\n\t\t\ttextColor: serialAndContentFontColor,\n\t\t\talignment: 'left',\n\t\t\tverticalAlignment: 'center',\n\t\t},\n\t\tframe: {\n\t\t\tx: serialAndContentX,\n\t\t\ty: (groupHeight - serialAndContentHeight) / 2, // 无法固定高度，用此方法代替\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\t// 连接线\n\tlet separator = new ShapePath({\n\t\tname: 'separator',\n\t\tshapeType: ShapePath.ShapeType.Custom,\n\t\tstyle: {\n\t\t\tborders: [\n\t\t\t\t{\n\t\t\t\t\tthickness: 3,\n\t\t\t\t},\n\t\t\t],\n\t\t\tborderOptions: {\n\t\t\t\tdashPattern: [20, 5, 20, 5],\n\t\t\t},\n\t\t},\n\t\tframe: {\n\t\t\tx: serialAndContent.frame.x + serialAndContent.frame.width + 100,\n\t\t\ty: 0,\n\t\t\twidth: GroupWidth - (serialAndContent.frame.x + serialAndContent.frame.width + 100) - 100,\n\t\t\theight: groupHeight,\n\t\t},\n\t\tpoints: [\n\t\t\t{\n\t\t\t\tpoint: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0.5,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tpoint: {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: 0.5,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t});\n\n\t// 页码\n\tlet pageNumberFontSize;\n\tif (headingLevel === 1) {\n\t\tpageNumberFontSize = 56;\n\t} else if (headingLevel === 2) {\n\t\tpageNumberFontSize = 56;\n\t} else if (headingLevel === 3) {\n\t\tpageNumberFontSize = 56;\n\t}\n\tlet page = new Text({\n\t\ttext: pageNumber.toString(),\n\t\tname: 'pageNumber',\n\t\tstyle: {\n\t\t\tborders: [],\n\t\t\tfontFamily: 'PingFang SC',\n\t\t\tfontSize: pageNumberFontSize,\n\t\t\tfontWeight: 4, // Regular\n\t\t\ttextColor: '#333333',\n\t\t\talignment: 'right',\n\t\t\tverticalAlignment: 'center',\n\t\t},\n\t\tframe: {\n\t\t\tx: GroupWidth - 100,\n\t\t\ty: (groupHeight - 78) / 2,\n\t\t\twidth: 100,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\t// 占位，用于设定 Group 的高度\n\tlet placeholder = new ShapePath({\n\t\tname: 'placeholder',\n\t\tshapeType: ShapePath.ShapeType.Custom,\n\t\tframe: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\tlet group = new Group({\n\t\tparent: artboard,\n\t\tname: headingText,\n\t\tframe: {\n\t\t\tx: originalX,\n\t\t\ty: originalY,\n\t\t\twidth: GroupWidth,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\tgroup.adjustToFit();\n\tgroup.layers = [placeholder, serialAndContent, separator, page];\n\treturn group;\n}\n\nexport function setParentHeadingOrOverrideValue(value) {\n\tif (invalidHeadingOverride) {\n\t\tinvalidHeadingOverride.value = value;\n\t\tinvalidHeadingOverride = undefined;\n\t}\n\tif (noParentHeadingArtboard) {\n\t\tSettings.setLayerSettingForKey(noParentHeadingArtboard, 'parentHeading', value);\n\t\tnoParentHeadingArtboard = undefined;\n\t}\n}\n\nfunction checkHeadingSerial(lastSerial, currentSerial) {\n\tlet hasError = false;\n\tif (lastSerial.length === 0) {\n\t\tif (currentSerial !== '1.') {\n\t\t\thasError = true;\n\t\t}\n\t} else if (lastSerial.endsWith('.')) {\n\t\tlet tempLastSerial = lastSerial;\n\t\tif (lastSerial.split('.')[0] === '1' && currentSerial.split('.')[0] === '3') {\n\t\t\ttempLastSerial = '2.';\n\t\t}\n\t\tif (currentSerial !== tempLastSerial + '1' && currentSerial !== parseInt(tempLastSerial) + 1 + '.') {\n\t\t\thasError = true;\n\t\t}\n\t} else {\n\t\tlet array = lastSerial.split('.');\n\n\t\tlet newArray;\n\t\tlet secondLastNumber;\n\t\tlet serialLength = array.length;\n\t\tif (serialLength > 2) {\n\t\t\tnewArray = array;\n\t\t\tsecondLastNumber = newArray[newArray.length - 2];\n\t\t\tnewArray.splice(newArray.length - 1, 2);\n\t\t}\n\n\t\tlet lastNumber = array[array.length - 1];\n\t\tarray.splice(array.length - 1, 1);\n\t\tif (\n\t\t\tcurrentSerial !== lastSerial + '.1' &&\n\t\t\tcurrentSerial !== array.join('.') + (parseInt(lastNumber) + 1) &&\n\t\t\t(serialLength > 2 && currentSerial !== newArray.join('.') + (parseInt(secondLastNumber) + 1))\n\t\t) {\n\t\t\thasError = true;\n\t\t}\n\t}\n\n\treturn !hasError;\n}\n\nfunction checkHeadings(artboards) {\n\tlet artboardIndex = 0;\n\tlet lastSerial = '';\n\n\t// 遍历所有画板，找出所有标题\n\tfor (let index = 0; index < artboards.length; index++) {\n\t\t++artboardIndex;\n\n\t\tconst artboard = artboards[index];\n\t\tlet type = Settings.layerSettingForKey(artboard, 'layerType');\n\t\tif (type === 'TOC') {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// 遍历画板所有层，找出标题层\n\t\tfor (let index = 0; index < artboard.layers.length; index++) {\n\t\t\tconst layer = artboard.layers[index];\n\t\t\tif (layer.type === 'SymbolInstance' && layer.master.name === 'PageTitle') {\n\t\t\t\t// 遍历标题所有层，找出标题内容\n\t\t\t\tfor (let index = 0; index < layer.overrides.length; index++) {\n\t\t\t\t\tconst override = layer.overrides[index];\n\n\t\t\t\t\t// 检查是否有重复\n\t\t\t\t\tif (headingsMap.has(override.value)) {\n\t\t\t\t\t\t// 标题格式不正确，提示用户修正\n\t\t\t\t\t\tconsole.log('have the same heading:', override.value);\n\t\t\t\t\t\tinvalidHeadingOverride = override;\n\t\t\t\t\t\twebContents.executeJavaScript(\n\t\t\t\t\t\t\t`showCreateTocHint('标题有重复', ${JSON.stringify(override.value)})`\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (override.affectedLayer.name === 'title') {\n\t\t\t\t\t\t// 匹配六级标题：（1.）（1.1）（1.1.1）...\n\t\t\t\t\t\tlet pattern = /(^[1-9][0-9]{0,}\\. )|(^[1-9][0-9]{0,}((\\.[1-9][0-9]{0,}){1,5}) )/;\n\t\t\t\t\t\tlet regex = new RegExp(pattern);\n\t\t\t\t\t\tif (override.value.length && !regex.test(override.value)) {\n\t\t\t\t\t\t\t// 标题格式不正确，提示用户修正\n\t\t\t\t\t\t\tconsole.log('invalid format heading:', override.value);\n\t\t\t\t\t\t\tinvalidHeadingOverride = override;\n\t\t\t\t\t\t\twebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t`showCreateTocHint('无效的标题，正确格式示例:【1. XXX】 或者 【1.1 XXX】', ${JSON.stringify(\n\t\t\t\t\t\t\t\t\toverride.value\n\t\t\t\t\t\t\t\t)})`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 标题格式正确，判断是否需要提示指定父级标题\n\t\t\t\t\t\t\tlet currentSerial = override.value.split(' ')[0];\n\t\t\t\t\t\t\tif (currentSerial.endsWith('1') && !currentSerial.startsWith(lastSerial)) {\n\t\t\t\t\t\t\t\tlet parentHeading = Settings.layerSettingForKey(artboard, 'parentHeading');\n\t\t\t\t\t\t\t\tconsole.log(currentSerial, parentHeading);\n\t\t\t\t\t\t\t\tif (!parentHeading) {\n\t\t\t\t\t\t\t\t\tconsole.log('should add parent heading for this layer:', artboard.name);\n\t\t\t\t\t\t\t\t\tdocument.selectedLayers.forEach(layer => {\n\t\t\t\t\t\t\t\t\t\tlayer.selected = false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tartboard.parent.selected = true;\n\t\t\t\t\t\t\t\t\tartboard.selected = true;\n\t\t\t\t\t\t\t\t\tdocument.centerOnLayer(artboard);\n\n\t\t\t\t\t\t\t\t\tnoParentHeadingArtboard = artboard;\n\t\t\t\t\t\t\t\t\twebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t\t\t`showCreateTocHint('需要添加当前标题的父标题，当前标题为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\toverride.value\n\t\t\t\t\t\t\t\t\t\t)})`\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} else if (!parentHeading.startsWith(currentSerial.slice(0, -2))) {\n\t\t\t\t\t\t\t\t\tlet serial = parentHeading.split(' ')[0];\n\t\t\t\t\t\t\t\t\tif (!checkHeadingSerial(lastSerial, serial) || currentSerial !== serial + '.1') {\n\t\t\t\t\t\t\t\t\t\tdocument.selectedLayers.forEach(layer => {\n\t\t\t\t\t\t\t\t\t\t\tlayer.selected = false;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tartboard.parent.selected = true;\n\t\t\t\t\t\t\t\t\t\tartboard.selected = true;\n\t\t\t\t\t\t\t\t\t\tdocument.centerOnLayer(artboard);\n\n\t\t\t\t\t\t\t\t\t\tnoParentHeadingArtboard = artboard;\n\t\t\t\t\t\t\t\t\t\twebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t\t\t\t`showCreateTocHint('父级标题序号不正确，请更正。上一标题序号为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t\tlastSerial\n\t\t\t\t\t\t\t\t\t\t\t)}, ${JSON.stringify(parentHeading)})`\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlastSerial = parentHeading.split(' ')[0];\n\t\t\t\t\t\t\t\t\theadingsMap.set(parentHeading, artboardIndex);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// 检查标题序号\n\t\t\t\t\t\t\tif (!checkHeadingSerial(lastSerial, currentSerial)) {\n\t\t\t\t\t\t\t\tdocument.selectedLayers.forEach(layer => {\n\t\t\t\t\t\t\t\t\tlayer.selected = false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tartboard.parent.selected = true;\n\t\t\t\t\t\t\t\tartboard.selected = true;\n\t\t\t\t\t\t\t\tdocument.centerOnLayer(artboard);\n\n\t\t\t\t\t\t\t\tinvalidHeadingOverride = override;\n\t\t\t\t\t\t\t\twebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t\t`showCreateTocHint('当前标题序号不正确，请更正。上一标题序号为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\t\t\tlastSerial\n\t\t\t\t\t\t\t\t\t)}, ${JSON.stringify(override.value)})`\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\theadingsMap.set(override.value, artboardIndex);\n\t\t\t\t\t\t\tlastSerial = currentSerial;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction addHeading(page, headingsMap, topBannerMaster, bottomBannerMaster) {\n\t// delete contents artboard\n\tpage.layers.forEach(artboard => {\n\t\tif (Settings.layerSettingForKey(artboard, 'layerType') === 'TOC') {\n\t\t\tartboard.remove();\n\t\t}\n\t});\n\n\tlet artboard;\n\tlet contentsArtboards = [];\n\tlet contentsPageIndex = 0;\n\tlet lastLevel = 1;\n\tlet column = 0;\n\tlet originalY = GroupTopMargin;\n\tlet needAddNewArtboard = true;\n\tfor (let [headingText, pageNumber] of headingsMap) {\n\t\t// create artboard\n\t\tif (needAddNewArtboard) {\n\t\t\tartboard = new Artboard({\n\t\t\t\tparent: page,\n\t\t\t\tname: 'Contents ' + (contentsPageIndex + 1).toString(),\n\t\t\t\tframe: {\n\t\t\t\t\tx: 0 + (ContentWidth + 50) * contentsPageIndex,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: ContentWidth,\n\t\t\t\t\theight: ContentHeight,\n\t\t\t\t},\n\t\t\t});\n\t\t\tSettings.setLayerSettingForKey(artboard, 'layerType', 'TOC');\n\t\t\tcontentsArtboards.push(artboard);\n\n\t\t\tlet topBanner = topBannerMaster[0].createNewInstance();\n\t\t\tlet bottomBanner = bottomBannerMaster[0].createNewInstance();\n\t\t\tbottomBanner.frame.y = ContentHeight - bottomBanner.frame.height;\n\t\t\ttopBanner.parent = artboard;\n\t\t\tbottomBanner.parent = artboard;\n\n\t\t\tcontentsPageIndex += 1;\n\t\t}\n\n\t\t// check level\n\t\tlet currentLevel;\n\t\tlet serialText = headingText.split(' ')[0];\n\t\tif (serialText.endsWith('.')) {\n\t\t\tcurrentLevel = 1;\n\t\t} else {\n\t\t\tcurrentLevel = serialText.split('.').length;\n\t\t}\n\n\t\t// create headings\n\t\tlet originalX = GroupLeftAndRightMargin + GroupWidth * column + GroupSpacing * column;\n\t\tif (!needAddNewArtboard) {\n\t\t\tif (lastLevel === 1 && currentLevel === 1) {\n\t\t\t\toriginalY += 100;\n\t\t\t} else {\n\t\t\t\toriginalY += 46;\n\t\t\t}\n\t\t}\n\t\tlastLevel = currentLevel;\n\t\tlet group = createHeading(artboard, originalX, originalY, currentLevel, headingText, pageNumber);\n\n\t\tif (group.frame.y > 4000) {\n\t\t\tcolumn += 1;\n\t\t\toriginalY = GroupTopMargin;\n\t\t} else {\n\t\t\toriginalY += group.frame.height;\n\t\t}\n\n\t\tif (column > 2) {\n\t\t\tneedAddNewArtboard = true;\n\t\t\tcolumn = 0;\n\t\t} else {\n\t\t\tneedAddNewArtboard = false;\n\t\t}\n\t}\n\n\treturn contentsArtboards;\n}\n\nfunction updateContentsPage(contentsArtboards, headingsMap) {\n\t// set contents page title\n\tlet contentsTitles = [];\n\tfor (let index = 0; index < contentsArtboards.length; index++) {\n\t\tconst artboard = contentsArtboards[index];\n\t\tlet override = artboard.layers[0].overrides[1];\n\t\tlet value;\n\t\tif (index === 0) {\n\t\t\tif (contentsArtboards.length === 1) {\n\t\t\t\tvalue = '2. 目录';\n\t\t\t} else {\n\t\t\t\tvalue = '2. 目录01';\n\t\t\t}\n\t\t} else {\n\t\t\tlet number;\n\t\t\tif (index < 10) {\n\t\t\t\tnumber = '0' + index;\n\t\t\t} else {\n\t\t\t\tnumber = index;\n\t\t\t}\n\t\t\tvalue = '2.' + index.toString() + ' 目录' + number;\n\t\t}\n\t\toverride.value = value; // Fix: 改完不会立马生效？\n\t\tcontentsTitles.push(value);\n\t}\n\n\t// insert contents page in TOC\n\tlet newHeadingMap = new Map();\n\tlet frontContentsPages = 0;\n\tlet hasAddContents = false;\n\theadingsMap.forEach((pageNumber, headingText) => {\n\t\tif (!hasAddContents && parseInt(headingText.split('.')[0]) > 2) {\n\t\t\thasAddContents = true;\n\t\t\tfor (let index = 0; index < contentsTitles.length; index++) {\n\t\t\t\tconst title = contentsTitles[index];\n\t\t\t\tnewHeadingMap.set(title, frontContentsPages + index + 1);\n\t\t\t}\n\t\t}\n\n\t\tfrontContentsPages += pageNumber;\n\t\tnewHeadingMap.set(headingText, pageNumber);\n\t});\n\n\t// reset TOC page number\n\tnewHeadingMap.forEach((pageNumber, headingText) => {\n\t\tif (parseInt(headingText.split('.')[0]) > 2) {\n\t\t\tnewHeadingMap.set(headingText, pageNumber + contentsArtboards.length);\n\t\t}\n\t});\n\n\treturn newHeadingMap;\n}\n\nexport function createTableOfContents(artboardSort, contents, win) {\n\tbrowserWindow = win;\n\twebContents = contents;\n\n\t// add banner\n\tlet pageTitleMaster = Sketch.find('SymbolMaster, [name=\"PageTitle\"]');\n\tlet topBannerMaster = Sketch.find('SymbolMaster, [name=\"TocTopBanner\"]');\n\tlet bottomBannerMaster = Sketch.find('SymbolMaster, [name=\"TocBottomBanner\"]');\n\tif (!pageTitleMaster.length || !topBannerMaster.length || !bottomBannerMaster.length) {\n\t\tconsole.log('can not found the banner');\n\t\tUI.alert('Error', '请添加生成目录所需要模板: PageTitle、TocTopBanner 、TocBottomBanner');\n\t\twebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\treturn;\n\t}\n\n\t// get artboards\n\theadingsMap.clear();\n\tlet artboards = getArtboardsSorted(document.selectedPage, checkArtboardSort(artboardSort));\n\tif (artboards.length === 0) {\n\t\tconsole.log('no artboards');\n\t\tUI.alert('Error', '当前文档为空，无需要生成目录');\n\t\twebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\treturn;\n\t}\n\n\tif (!checkHeadings(artboards)) {\n\t\tconsole.log('check headings error');\n\t\treturn;\n\t}\n\tif (headingsMap.size === 0) {\n\t\tconsole.log('no headings');\n\t\tUI.alert('Error', '找不到目录页，请检查标题设置是否正确');\n\t\twebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\treturn;\n\t}\n\n\t// add headings\n\tlet contentsArtboards = addHeading(document.selectedPage, headingsMap, topBannerMaster, bottomBannerMaster);\n\tlet newHeadingsMap = updateContentsPage(contentsArtboards, headingsMap);\n\n\t// add headings again\n\tlet newContentsArtboards = addHeading(document.selectedPage, newHeadingsMap, topBannerMaster, bottomBannerMaster);\n\tnewHeadingsMap = updateContentsPage(newContentsArtboards, newHeadingsMap);\n\n\tif (contentsArtboards.length !== newContentsArtboards.length) {\n\t\tconsole.log(\"new content artboards'size greater than the old one.\");\n\t\tnewContentsArtboards = addHeading(document.selectedPage, newHeadingsMap, topBannerMaster, bottomBannerMaster);\n\t\tnewHeadingsMap = updateContentsPage(newContentsArtboards, newHeadingsMap);\n\t}\n\n\tif (newContentsArtboards.length > 0) {\n\t\tdocument.selectedLayers.forEach(layer => {\n\t\t\tlayer.selected = false;\n\t\t});\n\t\tnewContentsArtboards[0].selected = true;\n\t\tdocument.centerOnLayer(newContentsArtboards[0]);\n\t}\n\n\twin.close();\n\tSketch.UI.message('Create Successfully! 🙌');\n}\n","const Sketch = require('sketch');\nconst fs = require('@skpm/fs');\nconst { exec } = require('@skpm/child_process');\n// const TheUI = require('./TheUI');\n\nlet document = require('sketch/dom').getSelectedDocument();\n\nlet exportDir = '';\nlet browserWindow = null;\nlet webContents = null;\n\nlet needParsePages = [];\nlet needParsePagesIndex = 0;\nlet needParseCount = 0;\nlet hasParseCount = 0;\nlet resultJsons = [];\n\nconst exportLayerJsonOptions = { formats: 'json', output: false };\n\nlet needCancel = false;\nlet needParseLayers = [\n\t'',\n\t'artboard',\n\t'text',\n\t'bitmap',\n\t'group',\n\t'shapeGroup',\n\t'symbolInstance',\n\t'rectangle',\n\t'oval',\n\t'shapePath',\n\t'triangle',\n\t'star',\n\t'polygon',\n\t'slice',\n\t'MSImmutableHotspotLayer',\n];\n\nfunction parsePage(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: 'page',\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseArtboard(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseText(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tcontent: json.attributedString.string,\n\t\tfontFamily: json.style.textStyle.encodedAttributes.MSAttributedStringFontAttribute.attributes.name,\n\t\tfontSize: json.style.textStyle.encodedAttributes.MSAttributedStringFontAttribute.attributes.size,\n\t\tfontColor: {\n\t\t\tr: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.red,\n\t\t\tg: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.green,\n\t\t\tb: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.blue,\n\t\t\ta: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.alpha,\n\t\t},\n\t};\n}\n\nfunction parseImage(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t};\n}\n\nfunction parseGroup(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseSymbol(json) {\n\tlet overrideValues = json.overrideValues;\n\tlet overrideValuesModify = [];\n\toverrideValues.forEach(overrideValue => {\n\t\tlet type;\n\t\tlet json = JSON.parse(JSON.stringify(overrideValue), function(key, value) {\n\t\t\tif (key === '_class') {\n\t\t\t\treturn undefined;\n\t\t\t} else if (key === 'overrideName') {\n\t\t\t\tlet values = value.split('_');\n\t\t\t\tlet last = values.pop();\n\t\t\t\ttype = last;\n\t\t\t\treturn values.join();\n\t\t\t} else if (key === 'value') {\n\t\t\t\tif (typeof value === 'object') {\n\t\t\t\t\treturn value._ref;\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tif (type === 'image') {\n\t\t\t// if (!fs.existsSync(dir + '/' + json.value))\n\t\t\t// \tfs.renameSync(dir + '/unzip/' + json.value, dir + '/' + json.value);\n\t\t} else if (type === 'symbolID') {\n\t\t\t// TODO: how to handle ?\n\t\t\t// letlayer = document.getLayerWithID(json.value)\n\t\t\t// if (layer) {\n\t\t\t// \tconsole.log(layer.name)\n\t\t\t// }\n\t\t\t// letsymbolMaster = document.getSymbolMasterWithID(json.value)\n\t\t\t// console.log(json.value)\n\t\t\t// if (symbolMaster) {\n\t\t\t// \tconsole.log(symbolMaster.name)\n\t\t\t// }\n\t\t}\n\n\t\toverrideValuesModify.push({\n\t\t\ttype: type,\n\t\t\tname: json.overrideName,\n\t\t\tvalue: json.value,\n\t\t});\n\t});\n\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\tsymbolID: json.symbolID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t\toverrideValues: overrideValuesModify,\n\t};\n}\n\nfunction parseCommon(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t};\n}\n\nfunction exportLayer(layer) {\n\tconst options = {\n\t\tscales: '1',\n\t\tformats: 'png',\n\t\toutput: exportDir + '/images',\n\t\t'use-id-for-name': true,\n\t\toverwriting: true,\n\t};\n\tSketch.export(layer, options);\n\tfs.renameSync(exportDir + '/images/' + layer.id + '.png', exportDir + '/images/' + layer.id.toLowerCase() + '.png');\n}\n\nexport function cancelTask() {\n\tneedCancel = true;\n}\n\nexport function getTargetLayers() {\n\tlet pages = document.pages;\n\tlet nodes = [];\n\tpages.forEach(page => {\n\t\tlet children = [];\n\t\tconst sketchJSON = Sketch.export(page, exportLayerJsonOptions);\n\t\tJSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\t\tif (value._class === 'artboard') {\n\t\t\t\tchildren.push({ value: value.do_objectID, label: value.name });\n\t\t\t}\n\t\t\treturn value;\n\t\t});\n\t\tnodes.push({ value: page.id, label: page.name, children: children });\n\t});\n\tconsole.log(nodes);\n\treturn nodes;\n}\n\nfunction closeWindow() {\n\tbrowserWindow.setClosable(true);\n\tbrowserWindow.close();\n}\n\nfunction calcNeedParseCount(page) {\n\tif (needCancel) {\n\t\tcloseWindow();\n\t\treturn;\n\t}\n\n\tconst sketchJSON = Sketch.export(page, exportLayerJsonOptions);\n\tJSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\tif (needParseLayers.includes(value._class)) needParseCount += 1;\n\t\treturn value;\n\t});\n\n\tneedParsePagesIndex += 1;\n\tif (needParsePagesIndex < needParsePages.length) {\n\t\tsetTimeout(calcNeedParseCount.bind(null, needParsePages[needParsePagesIndex]), 5);\n\t} else {\n\t\tneedParsePagesIndex = 0;\n\t\twebContents.executeJavaScript(`exportProgress(0)`);\n\t\twebContents.executeJavaScript(`exportMessage('Exporting ${needParsePages[0].name}')`);\n\t\tconst sketchJSON = Sketch.export(needParsePages[0], exportLayerJsonOptions);\n\t\tsetTimeout(handleSketchJSON.bind(null, sketchJSON), 5);\n\t}\n}\n\nfunction handleSketchJSON(sketchJSON) {\n\tif (needCancel) {\n\t\tcloseWindow();\n\t\treturn;\n\t}\n\n\t// parse\n\tlet hasParse = false;\n\tlet hasAllParse = false;\n\tlet json = JSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\tif (!hasParse) {\n\t\t\t// empty key means page layer, number key means layers, handle this two parts only\n\t\t\tif (key === '') {\n\t\t\t\thasParse = true;\n\t\t\t\thasAllParse = true;\n\t\t\t\treturn parsePage(value);\n\t\t\t} else if (!isNaN(key)) {\n\t\t\t\tif (value._class === 'artboard') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseArtboard(value);\n\t\t\t\t} else if (value._class === 'text') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseText(value);\n\t\t\t\t} else if (value._class === 'bitmap') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseImage(value);\n\t\t\t\t} else if (value._class === 'group' || value._class === 'shapeGroup') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseGroup(value);\n\t\t\t\t} else if (value._class === 'symbolInstance') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseSymbol(value);\n\t\t\t\t} else if (\n\t\t\t\t\tvalue._class === 'rectangle' ||\n\t\t\t\t\tvalue._class === 'oval' ||\n\t\t\t\t\tvalue._class === 'shapePath' ||\n\t\t\t\t\tvalue._class === 'triangle' ||\n\t\t\t\t\tvalue._class === 'star' ||\n\t\t\t\t\tvalue._class === 'polygon' ||\n\t\t\t\t\tvalue._class === 'slice' ||\n\t\t\t\t\tvalue._class === 'MSImmutableHotspotLayer'\n\t\t\t\t) {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseCommon(value);\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t} else {\n\t\t\treturn value;\n\t\t}\n\t});\n\n\tif (hasAllParse) {\n\t\tresultJsons.push(json);\n\n\t\tneedParsePagesIndex += 1;\n\t\tif (needParsePagesIndex < needParsePages.length) {\n\t\t\twebContents.executeJavaScript(`exportMessage('Exporting ${needParsePages[needParsePagesIndex].name}')`);\n\t\t\tconst sketchJSON = Sketch.export(needParsePages[needParsePagesIndex], exportLayerJsonOptions);\n\t\t\thandleSketchJSON(sketchJSON);\n\t\t} else {\n\t\t\t// output metadata file\n\t\t\twebContents.executeJavaScript(`exportMessage('Creating metadata file)`);\n\t\t\tfs.writeFileSync(\n\t\t\t\texportDir + '/metadata.json',\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tpages: resultJsons,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\t// clear unzip\n\t\t\tlet unzipPath = exportDir + '/unzip';\n\t\t\tif (fs.existsSync(unzipPath)) {\n\t\t\t\tfs.rmdirSync(unzipPath, { recursive: true });\n\t\t\t}\n\n\t\t\tSketch.UI.message('Export Successfully! 🙌');\n\t\t\tcloseWindow();\n\t\t}\n\t} else {\n\t\thasParseCount += 1;\n\t\twebContents.executeJavaScript(`exportProgress(${JSON.stringify((hasParseCount * 100) / needParseCount)})`);\n\t\tsetTimeout(handleSketchJSON.bind(null, json), 5);\n\t}\n}\n\nexport function exportMetadata(exportPath, contents, win) {\n\texportDir = exportPath;\n\tbrowserWindow = win;\n\twebContents = contents;\n\n\t// clear output first\n\tif (fs.existsSync(exportDir)) {\n\t\twebContents.executeJavaScript(`exportMessage('Clearing output')`);\n\t\tfs.rmdirSync(exportDir, { recursive: true });\n\t}\n\n\t// handle export dir\n\tif (!fs.existsSync(exportDir)) {\n\t\twebContents.executeJavaScript(`exportMessage('Creating output directory')`);\n\t\tfs.mkdirSync(exportDir);\n\t}\n\n\t// unzip sketch file\n\tlet cmd = '/usr/bin/unzip -o \"' + document.path.replace(/%20/g, ' ') + '\" -d \"' + exportDir + '/unzip\"';\n\twebContents.executeJavaScript(`exportMessage('Unzip sketch file...')`);\n\texec(cmd, () => {\n\t\tlet pages = document.pages;\n\t\tpages.forEach(page => {\n\t\t\tif (page.name !== 'Symbols') {\n\t\t\t\tneedParsePages.push(page);\n\t\t\t}\n\t\t});\n\n\t\tif (needParsePages.length > 0) {\n\t\t\twebContents.executeJavaScript(`exportMessage('Counting target layers')`);\n\t\t\tcalcNeedParseCount(needParsePages[0]);\n\t\t}\n\t});\n}\n","import BrowserWindow from 'sketch-module-web-view';\nimport { createTableOfContents, setParentHeadingOrOverrideValue } from '../lib/CreateTableOfContents';\nimport { exportMetadata, cancelTask, getTargetLayers } from '../lib/ExportMetadata';\nimport getTheme from '../../resources/views/theme/index';\nimport { getDefaultExportDir, getExportDir } from './Utilities';\nimport dialog from '@skpm/dialog';\n\nlet handingTask = false;\n\nconst theUI = options => {\n\tconst themeColor = typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark() ? 'dark' : 'light';\n\tconst theme = getTheme(themeColor);\n\n\tconst winOptions = {\n\t\tidentifier: options.identifier,\n\t\ttitle: options.title,\n\t\twidth: options.width,\n\t\theight: options.height,\n\t\tminimizable: false,\n\t\tmaximizable: false,\n\t\tresizable: false,\n\t\tfullscreenable: false,\n\t\tbackgroundColor: theme.bg,\n\t\talwaysOnTop: true,\n\t\tshow: false,\n\t};\n\n\tlet artboardSort = '';\n\n\tlet win = new BrowserWindow(winOptions);\n\tconst contents = win.webContents;\n\n\twin.once('ready-to-show', () => {\n\t\twin.show();\n\t});\n\n\t// Sending a message to the plugin from the WebView\n\twin.on('closed', e => {\n\t\twin = null;\n\t});\n\n\tcontents.on('cancel', (needShowAlert = true) => {\n\t\tif (needShowAlert) {\n\t\t\tcontents.executeJavaScript(`showExportAlert()`);\n\t\t} else {\n\t\t\tif (handingTask) {\n\t\t\t\tcancelTask();\n\t\t\t} else {\n\t\t\t\twin.setClosable(true);\n\t\t\t\twin.close();\n\t\t\t}\n\t\t}\n\t});\n\n\twin.loadURL(require('../../resources/webview.html'));\n\n\tcontents.on('createTableOfContent', () => {\n\t\tcreateTableOfContents(artboardSort, contents, win);\n\t});\n\n\tcontents.on('createContinue', value => {\n\t\tsetParentHeadingOrOverrideValue(value);\n\t\tcreateTableOfContents(artboardSort, contents, win);\n\t});\n\n\tcontents.on('exportMetadata', path => {\n\t\thandingTask = true;\n\t\twin.setClosable(false);\n\t\texportMetadata(path + '/' + getExportDir(), contents, win);\n\t\t// handingTask = false;\n\t});\n\n\tcontents.on('openFolder', () => {\n\t\tlet array = dialog.showOpenDialogSync({\n\t\t\tproperties: ['openDirectory'],\n\t\t});\n\t\tif (array && array.length) {\n\t\t\tlet result = array[0];\n\t\t\tcontents.executeJavaScript(`setExportDir(${JSON.stringify(result)})`);\n\t\t}\n\t});\n\n\tcontents.on('artboardSort', function(s) {\n\t\tartboardSort = s;\n\t});\n\n\tcontents.on('artboardInnerLayersSort', function(s) {\n\t\tartboardInnerLayersSort = s;\n\t});\n\n\tcontents.on('nativeLog', function(s) {\n\t\tconsole.log('nativeLog: ', s);\n\t});\n\n\tconst getData = () => {\n\t\t// Sending a message to the WebView from your plugin command\n\t\tcontents.executeJavaScript(`setTheme(${JSON.stringify(themeColor)})`);\n\t\tcontents.executeJavaScript(`setRedirectTo(${JSON.stringify(options.redirectTo)})`);\n\n\t\tif (options.redirectTo === '/export_metadata') {\n\t\t\tcontents.executeJavaScript(`setExportDir(${JSON.stringify(getDefaultExportDir())})`);\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tcontents.executeJavaScript(`setExportNodes(${JSON.stringify(getTargetLayers())})`);\n\t\t\t}, 1000);\n\t\t}\n\t};\n\tcontents.on('did-start-loading', () => getData());\n\tcontents.on('getData', () => getData());\n};\n\nexport default theUI;\n","import { ArtboardSortEnum, ArtbaordLayersSortEnum } from './Constants';\nconst os = require('os');\n\nlet document = require('sketch/dom').getSelectedDocument();\n\nfunction hasLayers(layer) {\n\treturn typeof layer.layers !== 'undefined' && layer.layers.length !== 0;\n}\n\nexport function getArtboardsSorted(page, sort = ArtboardSortEnum.Left2RightByArtboard) {\n\tlet artboards = [];\n\tpage.layers.slice().forEach(layer => {\n\t\tif (layer.type === 'Artboard') artboards.push(layer);\n\t});\n\n\tif (sort === ArtboardSortEnum.Top2BottomByLayerList) {\n\t\treturn artboards.reverse();\n\t} else if (sort === ArtboardSortEnum.Bottom2TopByLayerList) {\n\t\treturn artboards;\n\t} else if (sort === ArtboardSortEnum.Left2RightByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.y < b.frame.y) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.y > b.frame.y) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.frame.x < b.frame.x) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.x > b.frame.x) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t} else if (sort === ArtboardSortEnum.Right2LeftByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.y < b.frame.y) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.y > b.frame.y) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.frame.x > b.frame.x) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.x < b.frame.x) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t} else if (sort === ArtboardSortEnum.Top2BottomByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.x < b.frame.x) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.x > b.frame.x) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.frame.y < b.frame.y) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.frame.y > b.frame.y) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t} else {\n\t\treturn undefined;\n\t}\n}\n\nfunction tailGetLayerPosterities(layer, posterities) {\n\t// sort from top to bottom by left layer list\n\tif (!hasLayers(layer)) {\n\t\treturn posterities;\n\t}\n\n\tlet reverse = layer.layers.slice().reverse();\n\tfor (let layer of reverse) {\n\t\tposterities.push(layer);\n\t\ttailGetLayerPosterities(layer, posterities);\n\t}\n}\n\nexport function getPagePosterities(\n\tpage,\n\tartboardSort = ArtboardSortEnum.Left2RightByArtboard,\n\tartboardLayersSort = ArtbaordLayersSortEnum.Bottom2TopByLayerList\n) {\n\tlet posterities = [];\n\n\t// get artboards\n\tlet artboards = getArtboardsSorted(page, artboardSort);\n\n\t// get artboards's layers\n\tfor (let artboard of artboards) {\n\t\tposterities.push(artboard);\n\t\tlet list = [];\n\t\ttailGetLayerPosterities(artboard, list);\n\t\tif (artboardLayersSort === ArtbaordLayersSortEnum.Top2BottomByLayerList) {\n\t\t\tposterities = posterities.concat(list);\n\t\t} else if (artboardLayersSort === ArtbaordLayersSortEnum.Bottom2TopByLayerList) {\n\t\t\tposterities = posterities.concat(list.reverse());\n\t\t}\n\t}\n\n\treturn posterities;\n}\n\nexport function getDefaultExportDir() {\n\tlet dir = os.homedir() + '/Desktop';\n\treturn dir;\n}\n\nexport function getExportDir() {\n\tlet documentName = document.path\n\t\t.replace(/^.*[\\\\\\/]/, '')\n\t\t.replace('.sketch', '')\n\t\t.replace(/%20/g, ' ');\n\treturn documentName + '_output';\n}\n","module.exports = require(\"buffer\");","module.exports = require(\"events\");","module.exports = require(\"os\");","module.exports = require(\"sketch\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");","module.exports = require(\"stream\");"],"sourceRoot":""}