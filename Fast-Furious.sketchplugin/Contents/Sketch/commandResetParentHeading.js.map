{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/@skpm/child_process/index.js","webpack://exports/./node_modules/@skpm/child_process/lib/exec.js","webpack://exports/./node_modules/@skpm/child_process/lib/execFile.js","webpack://exports/./node_modules/@skpm/child_process/lib/execFileSync.js","webpack://exports/./node_modules/@skpm/child_process/lib/execSync.js","webpack://exports/./node_modules/@skpm/child_process/lib/handleData.js","webpack://exports/./node_modules/@skpm/child_process/lib/normalizeSpawnArguments.js","webpack://exports/./node_modules/@skpm/child_process/lib/spawn.js","webpack://exports/./node_modules/@skpm/child_process/lib/spawnSync.js","webpack://exports/./node_modules/@skpm/dialog/lib/index.js","webpack://exports/./node_modules/@skpm/dialog/lib/message-box.js","webpack://exports/./node_modules/@skpm/dialog/lib/open-dialog.js","webpack://exports/./node_modules/@skpm/dialog/lib/save-dialog.js","webpack://exports/./node_modules/@skpm/dialog/lib/utils.js","webpack://exports/./node_modules/@skpm/fs/index.js","webpack://exports/./node_modules/@skpm/fs/utils.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/process/browser.js","webpack://exports/./node_modules/promise-polyfill/lib/index.js","webpack://exports/./node_modules/setimmediate/setImmediate.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./node_modules/timers-browserify/main.js","webpack://exports/(webpack)/buildin/global.js","webpack://exports/./resources/views/theme/dark.js","webpack://exports/./resources/views/theme/index.js","webpack://exports/./resources/views/theme/light.js","webpack://exports/./resources/webview.html","webpack://exports/./src/commandResetParentHeading.js","webpack://exports/./src/lib/AddPageNumber.js","webpack://exports/./src/lib/Constants.js","webpack://exports/./src/lib/CreateTableOfContents.js","webpack://exports/./src/lib/ExportMetadata.js","webpack://exports/./src/lib/ResetParentHeading.js","webpack://exports/./src/lib/TheUI.js","webpack://exports/./src/lib/Utilities.js","webpack://exports/external \"buffer\"","webpack://exports/external \"events\"","webpack://exports/external \"os\"","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\"","webpack://exports/external \"stream\""],"names":["name","text","bg","previewColor","input","background","color","border","borderActive","button","bgColor","bgActive","secondaryButton","borderColor","textColor","CTAButton","radio","selectedColor","theme","dark","light","Settings","require","SelectedDocument","getSelectedDocument","checkSelectedParentHeading","win","BrowserWindow","fromId","selection","selectedLayers","selectionLayers","layers","length","type","artboard","index","layer","master","override","overrides","parentHeading","layerSettingForKey","webContents","executeJavaScript","JSON","stringify","onSelectedChanged","context","showUI","options","identifier","title","redirectTo","width","height","theUI","setTimeout","bind","Sketch","Text","UI","WebContents","Artboards","ArtboardIndex","ArtboardSort","handleArtboard","instances","find","instance","titleOverride","pageNumber","parent","style","borders","fontFamily","fontSize","fontWeight","alignment","verticalAlignment","frame","x","y","toString","setLayerSettingForKey","close","message","removePageNumber","selectedPage","forEach","remove","getArtboardsSorted","clearOldPageNumber","addPageNumber","artboardSort","contents","TocPageName","ArtboardSortEnum","Top2BottomByLayerList","Bottom2TopByLayerList","Left2RightByArtboard","Right2LeftByArtboard","Top2BottomByArtboard","ArtbaordLayersSortEnum","Artboard","Group","ShapePath","NoParentHeadingArtboard","InvalidHeadingOverride","ContentWidth","ContentHeight","GroupSpacing","GroupTopMargin","GroupLeftAndRightMargin","GroupCounts","GroupWidth","HeadingsMap","Map","PageTitleMaster","BottomBannerMaster","LastHeadingSerial","addPgaeNumber","value","addPageNumbers","contentsArtboards","get","selected","centerOnLayer","createHeading","originalX","originalY","headingLevel","headingText","groupHeight","serialAndContentX","serialAndContentHeight","serialAndContentFontSize","serialAndContentFontWeight","serialAndContentFontColor","serialAndContent","trim","separator","shapeType","ShapeType","Custom","thickness","borderOptions","dashPattern","points","point","pageNumberFontSize","page","placeholder","group","adjustToFit","checkHeadingSerial","lastSerial","currentSerial","hasError","endsWith","tempLastSerial","split","parseInt","array","newArray","secondLastNumber","serialLength","splice","firstNumber","lastNumber","join","focusArtboard","updateContentsPage","headingsMap","contentsTitles","number","push","newHeadingMap","frontContentsPages","hasAddContents","set","addHeading","contentsPageIndex","lastLevel","column","needAddNewArtboard","enabled","topBanner","createNewInstance","bottomBanner","currentLevel","serialText","checkHeading","replace","has","console","log","pattern","regex","RegExp","test","startsWith","slice","serial","size","alert","newHeadingsMap","newContentsArtboards","checkMasters","checkSelectedPage","isSymbolsPage","createTableOfContents","isContinue","clear","setParentHeadingOrOverrideValue","undefined","fs","exec","document","exportDir","browserWindow","needParsePages","needParsePagesIndex","needParseCount","hasParseCount","resultJsons","exportLayerJsonOptions","formats","output","needCancel","needParseLayers","parsePage","json","objectID","do_objectID","rect","rotation","parseArtboard","_class","parseText","content","attributedString","string","textStyle","encodedAttributes","MSAttributedStringFontAttribute","attributes","fontColor","r","MSAttributedStringColorAttribute","red","g","green","b","blue","a","alpha","parseImage","toLowerCase","parseGroup","parseSymbol","overrideValues","overrideValuesModify","overrideValue","parse","key","values","last","pop","_ref","overrideName","symbolID","parseCommon","exportLayer","scales","overwriting","renameSync","id","cancelTask","getTargetLayers","pages","nodes","children","sketchJSON","label","closeWindow","setClosable","calcNeedParseCount","includes","handleSketchJSON","hasParse","hasAllParse","isNaN","getLayerWithID","writeFileSync","unzipPath","existsSync","rmdirSync","recursive","exportMetadata","exportPath","mkdirSync","cmd","path","resetParentHeading","heading","handingTask","themeColor","MSTheme","sharedTheme","isDark","getTheme","winOptions","minimizable","maximizable","resizable","fullscreenable","backgroundColor","alwaysOnTop","show","once","on","e","needShowAlert","loadURL","getExportDir","dialog","showOpenDialogSync","properties","result","s","artboardInnerLayersSort","getData","getDefaultExportDir","os","hasLayers","checkArtboardSort","sort","artboards","reverse","tailGetLayerPosterities","posterities","getPagePosterities","artboardLayersSort","list","concat","dir","homedir","documentName"],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,sBAAsB,mBAAO,CAAC,kEAAY;AAC1C,0BAA0B,mBAAO,CAAC,0EAAgB;AAClD,uBAAuB,mBAAO,CAAC,oEAAa;AAC5C,2BAA2B,mBAAO,CAAC,4EAAiB;AACpD,8BAA8B,mBAAO,CAAC,kFAAoB;AAC1D,0BAA0B,mBAAO,CAAC,0EAAgB;;;;;;;;;;;;ACLlD,eAAe,mBAAO,CAAC,sEAAY;;AAEnC;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtBA;AACA,YAAY,mBAAO,CAAC,gEAAS;AAC7B,iBAAiB,mBAAO,CAAC,0EAAc;;AAEvC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;AC1KA,gBAAgB,mBAAO,CAAC,wEAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,yDAAyD;AACzD;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC5DA,mBAAmB,mBAAO,CAAC,8EAAgB;;AAE3C;AACA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;AChBA,aAAa,mBAAO,CAAC,sBAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;AChBA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;;AAE5B;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpHA;AACA,aAAa,mBAAO,CAAC,sBAAQ;AAC7B,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,eAAe,mBAAO,CAAC,sBAAQ;AAC/B,eAAe,mBAAO,CAAC,sBAAQ;;AAE/B,gBAAgB,mBAAO,CAAC,wEAAa;AACrC,8BAA8B,mBAAO,CAAC,oGAA2B;;AAEjE;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;;;;;;ACxOA;AACA,iBAAiB,mBAAO,CAAC,0EAAc;AACvC,8BAA8B,mBAAO,CAAC,oGAA2B;;AAEjE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;ACnHA;AACA;;AAEA;AACA,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C,kBAAkB,mBAAO,CAAC,qEAAe;AACzC,sBAAsB,mBAAO,CAAC,qEAAe;AAC7C;AACA;;;;;;;;;;;;ACXA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;ACnIA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;AClHA;AACA,YAAY,mBAAO,CAAC,yDAAS;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;;;;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AACA;AACA,aAAa,mBAAO,CAAC,sBAAQ;AAC7B,YAAY,mBAAO,CAAC,iDAAS;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,OAAO;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;AClbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;;AAErC;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;;;;;;;ACvLtC,oDAAa;;AAEb;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,+DAA+D;AAC/D;AACA;;AAEA;;;;;;;;;;;;;ACjRA;AACA;;AAEA;AACA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,sBAAsB,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;;;;;;;;;;;ACzLD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,yCAAyC;AACzC,uDAAuD;AACvD,6DAA6D;AAC7D,+BAA+B;AAC/B,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACzBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACxWA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,yBAAyB;AACzB;AACA,QAAQ;AACR,uDAAuD;AACvD,6CAA6C;AAC7C,0BAA0B;AAC1B,sDAAsD;AACtD;AACA;AACA,uBAAuB;AACvB;AACA;AACA,sBAAsB;AACtB;AACA;AACA,wCAAwC;AACxC,QAAQ,EAAE;AACV,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,wEAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA,+DAA+D;AAC/D;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,sBAAsB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;;AChZA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;ACrOA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA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","file":"commandResetParentHeading.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/commandResetParentHeading.js\");\n","module.exports.exec = require('./lib/exec')\nmodule.exports.execFile = require('./lib/execFile')\nmodule.exports.spawn = require('./lib/spawn')\nmodule.exports.spawnSync = require('./lib/spawnSync')\nmodule.exports.execFileSync = require('./lib/execFileSync')\nmodule.exports.execSync = require('./lib/execSync')\n","var execFile = require('./execFile')\n\nfunction normalizeExecArgs(command, options, callback) {\n  if (typeof options === 'function') {\n    callback = options\n    options = undefined\n  }\n\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n  options.shell = typeof options.shell === 'string' ? options.shell : true\n\n  return {\n    file: command,\n    options: options,\n    callback: callback\n  }\n}\n\nmodule.exports = function exec(command, options, callback) {\n  var opts = normalizeExecArgs(command, options, callback)\n  return execFile(opts.file, opts.options, opts.callback)\n}\n","/* globals NSMutableData, NSData */\nvar spawn = require('./spawn')\nvar handleData = require('./handleData')\n\nfunction validateTimeout(timeout) {\n  if (timeout != null && !(Number.isInteger(timeout) && timeout >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.timeout')\n  }\n}\n\nfunction validateMaxBuffer(maxBuffer) {\n  if (maxBuffer != null && !(typeof maxBuffer === 'number' && maxBuffer >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.maxBuffer')\n  }\n}\n\nfunction concatData(prev, data) {\n  prev.appendData(data)\n  return prev\n}\n\nmodule.exports = function execFile(file, args, options, callback) {\n  var defaultOptions = {\n    encoding: 'utf8',\n    timeout: 0,\n    maxBuffer: 200 * 1024,\n    killSignal: 'SIGTERM',\n    cwd: undefined,\n    env: undefined,\n    shell: false\n  }\n\n  if (typeof args === 'function') {\n    // function (file, callback)\n    callback = args\n    args = []\n    options = defaultOptions\n  } else if (typeof args === 'object' && !Array.isArray(args)) {\n    // function (file, options, callback)\n    callback = options\n    options = Object.assign(defaultOptions, args)\n    args = []\n  } else {\n    // function (file, args, options, callback)\n    options = Object.assign(defaultOptions, options)\n  }\n\n  // Validate the timeout, if present.\n  validateTimeout(options.timeout)\n\n  // Validate maxBuffer, if present.\n  validateMaxBuffer(options.maxBuffer)\n\n  var child = spawn(file, args, {\n    cwd: options.cwd,\n    env: options.env,\n    gid: options.gid,\n    uid: options.uid,\n    shell: options.shell\n  })\n\n  var encoding = options.encoding\n  var _stdout = []\n  var _stderr = []\n\n  var stdoutLen = 0\n  var stderrLen = 0\n  var killed = false\n  var exited = false\n  var timeoutId\n\n  var ex = null\n\n  var cmd = file\n\n  function exithandler(code, signal) {\n    if (exited) return\n    exited = true\n\n    if (timeoutId) {\n      clearTimeout(timeoutId)\n      timeoutId = null\n    }\n\n    if (!callback) return\n\n    // merge chunks\n    var stdout = handleData(\n      NSData.dataWithData(_stdout.reduce(concatData, NSMutableData.data())),\n      encoding\n    )\n    var stderr = handleData(\n      NSData.dataWithData(_stderr.reduce(concatData, NSMutableData.data())),\n      encoding\n    )\n\n    if (!ex && code === 0 && signal === null) {\n      callback(null, stdout, stderr)\n      return\n    }\n\n    if (args.length !== 0) {\n      cmd += ' ' + args.join(' ')\n    }\n\n    if (!ex) {\n      ex = new Error('Command failed: ' + cmd + '\\n' + stderr)\n      ex.killed = child.killed || killed\n      ex.code = code\n      ex.signal = signal\n    }\n\n    ex.cmd = cmd\n    callback(ex, stdout, stderr)\n  }\n\n  function errorhandler(e) {\n    ex = e\n\n    exithandler()\n  }\n\n  function kill() {\n    killed = true\n    try {\n      child.kill(options.killSignal)\n    } catch (e) {\n      ex = e\n      exithandler()\n    }\n  }\n\n  if (options.timeout > 0) {\n    timeoutId = setTimeout(function delayedKill() {\n      kill()\n      timeoutId = null\n    }, options.timeout)\n  }\n\n  if (child.stdout) {\n    child.stdout.setEncoding('NSData')\n    child.stdout.on('data', function onChildStdout(chunk) {\n      stdoutLen += chunk.length()\n      if (stdoutLen > options.maxBuffer) {\n        ex = new Error('ERR_CHILD_PROCESS_STDIO_MAXBUFFER stdout')\n        kill()\n      } else {\n        _stdout.push(chunk)\n      }\n    })\n  }\n\n  if (child.stderr) {\n    child.stderr.setEncoding('NSData')\n    child.stderr.on('data', function onChildStderr(chunk) {\n      stderrLen += chunk.length()\n\n      if (stderrLen > options.maxBuffer) {\n        ex = new Error('ERR_CHILD_PROCESS_STDIO_MAXBUFFER stderr')\n        kill()\n      } else {\n        _stderr.push(chunk)\n      }\n    })\n  }\n\n  child.addListener('close', exithandler)\n  child.addListener('error', errorhandler)\n\n  return child\n}\n","var spawnSync = require('./spawnSync')\n\nfunction validateTimeout(timeout) {\n  if (timeout != null && !(Number.isInteger(timeout) && timeout >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.timeout')\n  }\n}\n\nfunction validateMaxBuffer(maxBuffer) {\n  if (maxBuffer != null && !(typeof maxBuffer === 'number' && maxBuffer >= 0)) {\n    throw new Error('ERR_OUT_OF_RANGE options.maxBuffer')\n  }\n}\n\nmodule.exports = function execFileSync(file, args, options) {\n  var defaultOptions = {\n    encoding: 'buffer',\n    timeout: 0,\n    maxBuffer: 200 * 1024,\n    killSignal: 'SIGTERM',\n    cwd: null,\n    env: null,\n    shell: false\n  }\n\n  if (typeof args === 'object' && !Array.isArray(args)) {\n    // function (file, options)\n    options = Object.assign(defaultOptions, args)\n    args = []\n  } else {\n    // function (file)\n    options = Object.assign(defaultOptions, options || {})\n  }\n\n  // Validate the timeout, if present.\n  validateTimeout(options.timeout)\n\n  // Validate maxBuffer, if present.\n  validateMaxBuffer(options.maxBuffer)\n\n  var child = spawnSync(file, args, {\n    cwd: options.cwd,\n    env: options.env,\n    gid: options.gid,\n    uid: options.uid,\n    shell: options.shell,\n    encoding: options.encoding,\n    stdio: ['pipe', 'pipe', 'inherit']\n  })\n\n  if (child.status !== 0) {\n    var error = new Error('Failed to run: ' + String(child.stderr))\n    error.pid = child.pid\n    error.status = child.status\n    error.stdout = child.stdout\n    error.stderr = child.stderr\n    throw error\n  }\n\n  return child.stdout\n}\n","var execFileSync = require('./execFileSync')\n\nfunction normalizeExecArgs(command, options) {\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n  options.shell = typeof options.shell === 'string' ? options.shell : true\n\n  return {\n    file: command,\n    options: options\n  }\n}\n\nmodule.exports = function execSync(command, options) {\n  var opts = normalizeExecArgs(command, options)\n  return execFileSync(opts.file, opts.options)\n}\n","var Buffer = require('buffer').Buffer\n\nfunction handleBuffer(buffer, encoding) {\n  if (encoding === 'buffer') {\n    return buffer\n  }\n  if (encoding === 'NSData') {\n    return buffer.toNSData()\n  }\n  return buffer.toString(encoding)\n}\n\nmodule.exports = function handleData(data, encoding) {\n  var buffer = Buffer.from(data)\n\n  return handleBuffer(buffer, encoding)\n}\n","module.exports = function normalizeSpawnArguments(file, args, options) {\n  if (typeof file !== 'string' || file.length === 0) {\n    throw new Error('ERR_INVALID_ARG_TYPE')\n  }\n\n  if (Array.isArray(args)) {\n    args = args.slice(0)\n  } else if (\n    args !== undefined &&\n    (args === null || typeof args !== 'object')\n  ) {\n    throw new Error('ERR_INVALID_ARG_TYPE args')\n  } else {\n    options = args\n    args = []\n  }\n\n  if (options === undefined) {\n    options = {}\n  } else if (options === null || typeof options !== 'object') {\n    throw new Error('ERR_INVALID_ARG_TYPE options')\n  }\n\n  // Validate the cwd, if present.\n  if (options.cwd != null && typeof options.cwd !== 'string') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.cwd')\n  }\n\n  // Validate detached, if present.\n  if (options.detached != null && typeof options.detached !== 'boolean') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.detached')\n  }\n\n  // Validate the uid, if present.\n  if (options.uid != null && !Number.isInteger(options.uid)) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.uid')\n  }\n\n  // Validate the gid, if present.\n  if (options.gid != null && !Number.isInteger(options.gid)) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.gid')\n  }\n\n  // Validate the shell, if present.\n  if (\n    options.shell != null &&\n    typeof options.shell !== 'boolean' &&\n    typeof options.shell !== 'string'\n  ) {\n    throw new Error('ERR_INVALID_ARG_TYPE options.shell')\n  }\n\n  // Validate argv0, if present.\n  if (options.argv0 != null && typeof options.argv0 !== 'string') {\n    throw new Error('ERR_INVALID_ARG_TYPE options.argv0')\n  }\n\n  // Make a shallow copy so we don't clobber the user's options object.\n  options = Object.assign({}, options)\n\n  if (options.shell) {\n    var command = [file].concat(args).join(' ')\n\n    if (typeof options.shell === 'string') {\n      file = options.shell\n    } else {\n      file = '/bin/bash'\n    }\n    args = ['-l', '-c', command]\n  }\n\n  if (typeof options.argv0 === 'string') {\n    args.unshift(options.argv0)\n  }\n\n  var stdio = ['pipe', 'pipe', 'pipe']\n\n  if (typeof options.stdio === 'string') {\n    if (options.stdio === 'inherit') {\n      stdio = [0, 1, 2]\n    } else {\n      stdio = [options.stdio, options.stdio, options.stdio]\n    }\n  } else if (Array.isArray(options.stdio)) {\n    if (options.stdio[0] || options.stdio[0] === 0) {\n      if (options.stdio[0] === 'inherit') {\n        stdio[0] = 0\n      } else {\n        stdio[0] = options.stdio[0]\n      }\n    }\n    if (options.stdio[1] || options.stdio[1] === 0) {\n      if (options.stdio[1] === 'inherit') {\n        stdio[1] = 1\n      } else {\n        stdio[1] = options.stdio[1]\n      }\n    }\n    if (options.stdio[2] || options.stdio[2] === 0) {\n      if (options.stdio[2] === 'inherit') {\n        stdio[2] = 2\n      } else {\n        stdio[2] = options.stdio[2]\n      }\n    }\n  }\n\n  var env = options.env\n\n  return {\n    file: file,\n    args: args,\n    options: options,\n    envPairs: env,\n    stdio: stdio\n  }\n}\n","/* globals NSPipe, NSTask, NSArray, NSString, coscript, __mocha__ */\nvar Buffer = require('buffer').Buffer\nvar EventEmitter = require('events')\nvar Readable = require('stream').Readable\nvar Writable = require('stream').Writable\n\nvar spawnSync = require('./spawnSync')\nvar normalizeSpawnArguments = require('./normalizeSpawnArguments')\n\nmodule.exports = function spawn(_command, _args, _options) {\n  var opts = normalizeSpawnArguments(_command, _args, _options)\n\n  var result = new EventEmitter()\n\n  if (opts.file[0] !== '.' && opts.file[0] !== '/' && opts.file[0] !== '~') {\n    // means that someone refered to an executable that might be in the path, let's find it\n    var whichChild = spawnSync(\n      '/bin/bash',\n      ['-l', '-c', 'which ' + opts.file],\n      { encoding: 'utf8' }\n    )\n    var resolvedCommand = String(whichChild.stdout || '').trim()\n    if (whichChild.err || !resolvedCommand.length) {\n      result.stderr = new EventEmitter()\n      result.stdout = new EventEmitter()\n\n      result.pid = '-1'\n\n      result.stderr.setEncoding = function setEncoding(encoding) {\n        result.stderr.encoding = encoding\n      }\n      result.stdout.setEncoding = function setEncoding(encoding) {\n        result.stdout.encoding = encoding\n      }\n      if (!resolvedCommand.length) {\n        result.emit('error', new Error(String(opts.file) + ' ENOENT'))\n      } else {\n        result.emit('error', whichChild.err)\n      }\n      return result\n    }\n    return spawn(resolvedCommand, _args, _options)\n  }\n\n  var options = opts.options\n\n  result.killed = false\n\n  var fiber = coscript.createFiber()\n\n  var task\n  var signal = null\n\n  var readingStderr = false\n  var readingStdout = false\n\n  result.stderr = new Readable({\n    read: function read() {\n      readingStderr = true\n    }\n  })\n  result.stdout = new Readable({\n    read: function read() {\n      readingStdout = true\n    }\n  })\n\n  function onStdout(data) {\n    if (data && data.length() && readingStdout) {\n      if (!result.stdout.push(Buffer.from(data))) {\n        readingStdout = false\n        task\n          .standardOutput()\n          .fileHandleForReading()\n          .setReadabilityHandler(null)\n      }\n    }\n  }\n  function onStderr(data) {\n    if (data && data.length() && readingStderr) {\n      if (!result.stderr.push(Buffer.from(data))) {\n        readingStderr = false\n        task\n          .standardError()\n          .fileHandleForReading()\n          .setReadabilityHandler(null)\n      }\n    }\n  }\n\n  result.sdtin = new Writable({\n    write: function write(chunk, encoding, callback) {\n      task\n        .standardInput()\n        .fileHandleForWriting()\n        .writeData(chunk.toNSData())\n      callback()\n    },\n    final: function finish(callback) {\n      task\n        .standardInput()\n        .fileHandleForWriting()\n        .closeFile()\n      callback()\n    }\n  })\n\n  result.sdtio = [result.sdtin, result.sdtout, result.sdterr]\n\n  try {\n    task = NSTask.alloc().init()\n\n    var inPipe = NSPipe.pipe()\n    var pipe = NSPipe.pipe()\n    var errPipe = NSPipe.pipe()\n\n    task.setStandardInput(inPipe)\n    task.setStandardOutput(pipe)\n    task.setStandardError(errPipe)\n\n    task\n      .standardOutput()\n      .fileHandleForReading()\n      .setReadabilityHandler(\n        __mocha__.createBlock_function(\n          'v16@?0@\"NSFileHandle\"8',\n          function readStdOut(fileHandle) {\n            try {\n              onStdout(fileHandle.availableData())\n            } catch (err) {\n              if (\n                typeof process !== 'undefined' &&\n                process.listenerCount &&\n                process.listenerCount('uncaughtException')\n              ) {\n                process.emit('uncaughtException', err, 'uncaughtException')\n              } else {\n                console.error(err)\n              }\n            }\n          }\n        )\n      )\n    task\n      .standardError()\n      .fileHandleForReading()\n      .setReadabilityHandler(\n        __mocha__.createBlock_function(\n          'v16@?0@\"NSFileHandle\"8',\n          function readStdOut(fileHandle) {\n            try {\n              onStderr(fileHandle.availableData())\n            } catch (err) {\n              if (\n                typeof process !== 'undefined' &&\n                process.listenerCount &&\n                process.listenerCount('uncaughtException')\n              ) {\n                process.emit('uncaughtException', err, 'uncaughtException')\n              } else {\n                console.error(err)\n              }\n            }\n          }\n        )\n      )\n\n    task.setLaunchPath(\n      NSString.stringWithString(opts.file).stringByExpandingTildeInPath()\n    )\n    task.arguments = NSArray.arrayWithArray(opts.args || [])\n    if (opts.envPairs) {\n      task.environment = opts.envPairs\n    }\n    if (options.cwd) {\n      task.setCurrentDirectoryPath(\n        NSString.stringWithString(options.cwd).stringByExpandingTildeInPath()\n      )\n    }\n\n    task.setTerminationHandler(\n      __mocha__.createBlock_function(\n        'v16@?0@\"NSTask\"8',\n        function handleTermination(_task) {\n          try {\n            _task\n              .standardError()\n              .fileHandleForReading()\n              .setReadabilityHandler(null)\n            _task\n              .standardOutput()\n              .fileHandleForReading()\n              .setReadabilityHandler(null)\n            result.stderr.emit('close')\n            result.stdout.emit('close')\n\n            result.killed = true\n\n            result.emit('close', Number(_task.terminationStatus()), signal)\n          } catch (err) {\n            if (\n              typeof process !== 'undefined' &&\n              process.listenerCount &&\n              process.listenerCount('uncaughtException')\n            ) {\n              process.emit('uncaughtException', err, 'uncaughtException')\n            } else {\n              console.error(err)\n            }\n          }\n          fiber.cleanup()\n        }\n      )\n    )\n\n    setImmediate(() => task.launch())\n  } catch (err) {\n    fiber.cleanup()\n    result.emit('error', err)\n    return result\n  }\n\n  result.kill = function kill(_signal) {\n    if (!result.killed) {\n      signal = _signal\n      task.terminate()\n    }\n  }\n\n  result.pid = String(task.processIdentifier())\n\n  return result\n}\n","/* globals NSPipe, NSTask, NSArray, NSString */\nvar handleData = require('./handleData')\nvar normalizeSpawnArguments = require('./normalizeSpawnArguments')\n\nfunction spawnSync(_command, _args, _options) {\n  var opts = normalizeSpawnArguments(_command, _args, _options)\n\n  if (opts.file[0] !== '.' && opts.file[0] !== '/' && opts.file[0] !== '~') {\n    // means that someone refered to an executable that might be in the path, let's find it\n    var whichChild = spawnSync(\n      '/bin/bash',\n      ['-l', '-c', 'which ' + opts.file],\n      { encoding: 'utf8' }\n    )\n    if (whichChild.err) {\n      return whichChild\n    }\n    var resolvedCommand = String(whichChild.stdout).trim()\n    if (!resolvedCommand.length) {\n      return {\n        err: new Error(String(opts.file) + ' ENOENT')\n      }\n    }\n    return spawnSync(resolvedCommand, _args, _options)\n  }\n\n  var options = opts.options\n\n  var pipe = NSPipe.pipe()\n  var errPipe = NSPipe.pipe()\n\n  try {\n    var task = NSTask.alloc().init()\n    task.setLaunchPath(\n      NSString.stringWithString(opts.file).stringByExpandingTildeInPath()\n    )\n    task.arguments = NSArray.arrayWithArray(opts.args || [])\n    if (opts.envPairs) {\n      task.environment = opts.envPairs\n    }\n\n    if (options.cwd) {\n      task.setCurrentDirectoryPath(\n        NSString.stringWithString(options.cwd).stringByExpandingTildeInPath()\n      )\n    }\n\n    task.setStandardOutput(pipe)\n    task.setStandardError(errPipe)\n\n    task.launch()\n    task.waitUntilExit()\n\n    var stdoutIgnored = false\n    var stderrIgnored = false\n\n    var data\n    var stdoutValue\n    var stderrValue\n\n    if (opts.stdio[1] === 'ignored') {\n      stdoutIgnored = true\n    } else if (opts.stdio[1] === 1) {\n      data = pipe.fileHandleForReading().readDataToEndOfFile()\n      stdoutValue = handleData(data, options.encoding || 'buffer')\n      console.log(stdoutValue)\n    } else if (opts.stdio[1] === 2) {\n      data = pipe.fileHandleForReading().readDataToEndOfFile()\n      stdoutValue = handleData(data, options.encoding || 'buffer')\n      console.error(stdoutValue)\n    }\n\n    if (opts.stdio[2] === 'ignored') {\n      stderrIgnored = true\n    } else if (opts.stdio[2] === 1) {\n      data = errPipe.fileHandleForReading().readDataToEndOfFile()\n      stderrValue = handleData(data, options.encoding || 'buffer')\n      console.log(stderrValue)\n    } else if (opts.stdio[2] === 2) {\n      data = errPipe.fileHandleForReading().readDataToEndOfFile()\n      stderrValue = handleData(data, options.encoding || 'buffer')\n      console.error(stderrValue)\n    }\n\n    return {\n      pid: String(task.processIdentifier()),\n      status: Number(task.terminationStatus()),\n      get stdout() {\n        if (stdoutIgnored) {\n          return null\n        }\n        if (stdoutValue) {\n          return stdoutValue\n        }\n        data = pipe.fileHandleForReading().readDataToEndOfFile()\n        return handleData(data, options.encoding || 'buffer')\n      },\n      get stderr() {\n        if (stderrIgnored) {\n          return null\n        }\n        if (stderrValue) {\n          return stdoutValue\n        }\n        data = errPipe.fileHandleForReading().readDataToEndOfFile()\n        return handleData(data, options.encoding || 'buffer')\n      }\n    }\n  } catch (err) {\n    return {\n      err: err\n    }\n  }\n}\n\nmodule.exports = spawnSync\n","/* let's try to match the API from Electron's Dialog\n(https://github.com/electron/electron/blob/master/docs/api/dialog.md) */\n\nmodule.exports = {\n  showOpenDialog: require('./open-dialog').openDialog,\n  showOpenDialogSync: require('./open-dialog').openDialogSync,\n  showSaveDialog: require('./save-dialog').saveDialog,\n  showSaveDialogSync: require('./save-dialog').saveDialogSync,\n  showMessageBox: require('./message-box').messageBox,\n  showMessageBoxSync: require('./message-box').messageBoxSync,\n  // showErrorBox: require('./error-box'),\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nvar typeMap = {\n  none: 0,\n  info: 1,\n  error: 2,\n  question: 1,\n  warning: 2,\n}\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  } else if (document.sketchObject) {\n    document = document.sketchObject\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSAlert.alloc().init()\n\n  if (options.type) {\n    dialog.alertStyle = typeMap[options.type] || 0\n  }\n\n  if (options.buttons && options.buttons.length) {\n    options.buttons.forEach(function addButton(button) {\n      dialog.addButtonWithTitle(\n        options.normalizeAccessKeys ? button.replace(/&/g, '') : button\n      )\n      // TODO: add keyboard shortcut if options.normalizeAccessKeys\n    })\n  }\n\n  if (typeof options.defaultId !== 'undefined') {\n    var buttons = dialog.buttons()\n    if (options.defaultId < buttons.length) {\n      // Focus the button at defaultId if the user opted to do so.\n      // The first button added gets set as the default selected.\n      // So remove that default, and make the requested button the default.\n      buttons[0].setKeyEquivalent('')\n      buttons[options.defaultId].setKeyEquivalent('\\r')\n    }\n  }\n\n  if (options.title) {\n    // not shown on macOS\n  }\n\n  if (options.message) {\n    dialog.messageText = options.message\n  }\n\n  if (options.detail) {\n    dialog.informativeText = options.detail\n  }\n\n  if (options.checkboxLabel) {\n    dialog.showsSuppressionButton = true\n    dialog.suppressionButton().title = options.checkboxLabel\n\n    if (typeof options.checkboxChecked !== 'undefined') {\n      dialog.suppressionButton().state = options.checkboxChecked\n        ? NSOnState\n        : NSOffState\n    }\n  }\n\n  if (options.icon) {\n    if (typeof options.icon === 'string') {\n      options.icon = NSImage.alloc().initWithContentsOfFile(options.icon)\n    }\n    dialog.icon = options.icon\n  } else if (\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle() &&\n    __command.pluginBundle().icon()\n  ) {\n    dialog.icon = __command.pluginBundle().icon()\n  } else {\n    var icon = NSImage.imageNamed('plugins')\n    if (icon) {\n      dialog.icon = icon\n    }\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowmessageboxbrowserwindow-options\nmodule.exports.messageBox = function messageBox(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return {\n        response:\n          setup.options.buttons && setup.options.buttons.length\n            ? Number(returnCode) - 1000\n            : Number(returnCode),\n        checkboxChecked: _dialog.suppressionButton().state() == NSOnState,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowmessageboxsyncbrowserwindow-options\nmodule.exports.messageBoxSync = function messageBoxSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return setup.options.buttons && setup.options.buttons.length\n        ? Number(returnCode) - 1000\n        : Number(returnCode)\n    },\n    setup.document\n  )\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSOpenPanel.openPanel()\n\n  if (options.title) {\n    dialog.title = options.title\n  }\n\n  if (options.defaultPath) {\n    dialog.setDirectoryURL(utils.getURL(options.defaultPath))\n  }\n\n  if (options.buttonLabel) {\n    dialog.prompt = options.buttonLabel\n  }\n\n  if (options.filters && options.filters.length) {\n    var exts = []\n    options.filters.forEach(function setFilter(filter) {\n      filter.extensions.forEach(function setExtension(ext) {\n        exts.push(ext)\n      })\n    })\n\n    dialog.allowedFileTypes = exts\n  }\n\n  var hasProperty =\n    Array.isArray(options.properties) && options.properties.length > 0\n  dialog.canChooseFiles =\n    hasProperty && options.properties.indexOf('openFile') !== -1\n  dialog.canChooseDirectories =\n    hasProperty && options.properties.indexOf('openDirectory') !== -1\n  dialog.allowsMultipleSelection =\n    hasProperty && options.properties.indexOf('multiSelections') !== -1\n  dialog.showsHiddenFiles =\n    hasProperty && options.properties.indexOf('showHiddenFiles') !== -1\n  dialog.canCreateDirectories =\n    hasProperty && options.properties.indexOf('createDirectory') !== -1\n  dialog.resolvesAliases =\n    !hasProperty || options.properties.indexOf('noResolveAliases') === -1\n  dialog.treatsFilePackagesAsDirectories =\n    hasProperty && options.properties.indexOf('treatPackageAsDirectory') !== -1\n\n  if (options.message) {\n    dialog.message = options.message\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowopendialogbrowserwindow-options\nmodule.exports.openDialog = function openDialog(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      if (returnCode != NSOKButton) {\n        return {\n          canceled: true,\n          filePaths: [],\n        }\n      }\n      var result = []\n      var urls = _dialog.URLs()\n      for (var k = 0; k < urls.length; k += 1) {\n        result.push(String(urls[k].path()))\n      }\n      return {\n        canceled: false,\n        filePaths: result,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowopendialogsyncbrowserwindow-options\nmodule.exports.openDialogSync = function openDialogSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      if (returnCode != NSOKButton) {\n        return []\n      }\n      var result = []\n      var urls = _dialog.URLs()\n      for (var k = 0; k < urls.length; k += 1) {\n        result.push(String(urls[k].path()))\n      }\n      return result\n    },\n    setup.document\n  )\n}\n","/* eslint-disable no-not-accumulator-reassign/no-not-accumulator-reassign */\nvar utils = require('./utils')\n\nfunction setupOptions(document, options) {\n  if (\n    !document ||\n    (typeof document.isKindOfClass !== 'function' && !document.sketchObject)\n  ) {\n    options = document\n    document = undefined\n  }\n  if (!options) {\n    options = {}\n  }\n\n  var dialog = NSSavePanel.savePanel()\n\n  if (options.title) {\n    dialog.title = options.title\n  }\n\n  if (options.defaultPath) {\n    // that's a path\n    dialog.setDirectoryURL(utils.getURL(options.defaultPath))\n\n    if (\n      options.defaultPath[0] === '.' ||\n      options.defaultPath[0] === '~' ||\n      options.defaultPath[0] === '/'\n    ) {\n      var parts = options.defaultPath.split('/')\n      if (parts.length > 1 && parts[parts.length - 1]) {\n        dialog.setNameFieldStringValue(parts[parts.length - 1])\n      }\n    } else {\n      dialog.setNameFieldStringValue(options.defaultPath)\n    }\n  }\n\n  if (options.buttonLabel) {\n    dialog.prompt = options.buttonLabel\n  }\n\n  if (options.filters && options.filters.length) {\n    var exts = []\n    options.filters.forEach(function setFilter(filter) {\n      filter.extensions.forEach(function setExtension(ext) {\n        exts.push(ext)\n      })\n    })\n\n    dialog.allowedFileTypes = exts\n  }\n\n  if (options.message) {\n    dialog.message = options.message\n  }\n\n  if (options.nameFieldLabel) {\n    dialog.nameFieldLabel = options.nameFieldLabel\n  }\n\n  if (options.showsTagField) {\n    dialog.showsTagField = options.showsTagField\n  }\n\n  return {\n    document: document,\n    options: options,\n    dialog: dialog,\n  }\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowsavedialogbrowserwindow-options\nmodule.exports.saveDialog = function saveDialog(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialog(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return {\n        canceled: returnCode != NSOKButton,\n        filePath:\n          returnCode == NSOKButton ? String(_dialog.URL().path()) : undefined,\n      }\n    },\n    setup.document\n  )\n}\n\n// https://github.com/electron/electron/blob/master/docs/api/dialog.md#dialogshowsavedialogsyncbrowserwindow-options\nmodule.exports.saveDialogSync = function saveDialogSync(document, options) {\n  var setup = setupOptions(document, options)\n\n  return utils.runDialogSync(\n    setup.dialog,\n    function getResult(_dialog, returnCode) {\n      return returnCode == NSOKButton ? String(_dialog.URL().path()) : undefined\n    },\n    setup.document\n  )\n}\n","module.exports.getURL = function getURL(path) {\n  return NSURL.URLWithString(\n    String(\n      NSString.stringWithString(path).stringByExpandingTildeInPath()\n    ).replace(/ /g, '%20')\n  )\n}\n\nmodule.exports.runDialog = function runDialog(dialog, getResult, document) {\n  if (!document) {\n    var returnCode = dialog.runModal()\n    return Promise.resolve(getResult(dialog, returnCode))\n  }\n\n  var fiber = coscript.createFiber()\n\n  var window = (document.sketchObject || document).documentWindow()\n\n  return new Promise(function p(resolve, reject) {\n    dialog.beginSheetModalForWindow_completionHandler(\n      window,\n      __mocha__.createBlock_function('v16@?0q8', function onCompletion(\n        _returnCode\n      ) {\n        try {\n          resolve(getResult(dialog, _returnCode))\n        } catch (err) {\n          reject(err)\n        }\n        NSApp.endSheet(dialog)\n        if (fiber) {\n          fiber.cleanup()\n        } else {\n          coscript.shouldKeepAround = false\n        }\n      })\n    )\n  })\n}\n\nmodule.exports.runDialogSync = function runDialog(dialog, getResult, document) {\n  var returnCode\n\n  if (!document) {\n    returnCode = dialog.runModal()\n    return getResult(dialog, returnCode)\n  }\n\n  var window = (document.sketchObject || document).documentWindow()\n\n  dialog.beginSheetModalForWindow_completionHandler(\n    window,\n    __mocha__.createBlock_function('v16@?0q8', function onCompletion(\n      _returnCode\n    ) {\n      NSApp.stopModalWithCode(_returnCode)\n    })\n  )\n\n  returnCode = NSApp.runModalForWindow(window)\n  NSApp.endSheet(dialog)\n  return getResult(dialog, returnCode)\n}\n","// TODO: async. Should probably be done with NSFileHandle and some notifications\n// TODO: file descriptor. Needs to be done with NSFileHandle\nvar Buffer = require(\"buffer\").Buffer;\nvar utils = require(\"./utils\");\nvar parseStat = utils.parseStat;\nvar fsError = utils.fsError;\nvar fsErrorForPath = utils.fsErrorForPath;\nvar encodingFromOptions = utils.encodingFromOptions;\nvar NOT_IMPLEMENTED = utils.NOT_IMPLEMENTED;\n\nmodule.exports.constants = {\n  F_OK: 0,\n  R_OK: 4,\n  W_OK: 2,\n  X_OK: 1\n};\n\nmodule.exports.access = NOT_IMPLEMENTED(\"access\");\n\nmodule.exports.accessSync = function(path, mode) {\n  mode = mode | 0;\n  var fileManager = NSFileManager.defaultManager();\n\n  switch (mode) {\n    case 0:\n      canAccess = module.exports.existsSync(path);\n      break;\n    case 1:\n      canAccess = Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 2:\n      canAccess = Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 3:\n      canAccess =\n        Boolean(Number(fileManager.isExecutableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 4:\n      canAccess = Boolean(Number(fileManager.isReadableFileAtPath(path)));\n      break;\n    case 5:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 6:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 7:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n  }\n\n  if (!canAccess) {\n    throw new Error(\"Can't access \" + String(path));\n  }\n};\n\nmodule.exports.appendFile = NOT_IMPLEMENTED(\"appendFile\");\n\nmodule.exports.appendFileSync = function(file, data, options) {\n  if (!module.exports.existsSync(file)) {\n    return module.exports.writeFileSync(file, data, options);\n  }\n\n  var handle = NSFileHandle.fileHandleForWritingAtPath(file);\n  handle.seekToEndOfFile();\n\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  handle.writeData(nsdata);\n};\n\nmodule.exports.chmod = NOT_IMPLEMENTED(\"chmod\");\n\nmodule.exports.chmodSync = function(path, mode) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFilePosixPermissions: mode\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.chown = NOT_IMPLEMENTED(\"chown\");\nmodule.exports.chownSync = NOT_IMPLEMENTED(\"chownSync\");\n\nmodule.exports.close = NOT_IMPLEMENTED(\"close\");\nmodule.exports.closeSync = NOT_IMPLEMENTED(\"closeSync\");\n\nmodule.exports.copyFile = NOT_IMPLEMENTED(\"copyFile\");\n\nmodule.exports.copyFileSync = function(path, dest, flags) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.copyItemAtPath_toPath_error(path, dest, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.createReadStream = NOT_IMPLEMENTED(\"createReadStream\");\nmodule.exports.createWriteStream = NOT_IMPLEMENTED(\"createWriteStream\");\n\nmodule.exports.exists = NOT_IMPLEMENTED(\"exists\");\n\nmodule.exports.existsSync = function(path) {\n  var fileManager = NSFileManager.defaultManager();\n  return Boolean(Number(fileManager.fileExistsAtPath(path)));\n};\n\nmodule.exports.fchmod = NOT_IMPLEMENTED(\"fchmod\");\nmodule.exports.fchmodSync = NOT_IMPLEMENTED(\"fchmodSync\");\nmodule.exports.fchown = NOT_IMPLEMENTED(\"fchown\");\nmodule.exports.fchownSync = NOT_IMPLEMENTED(\"fchownSync\");\nmodule.exports.fdatasync = NOT_IMPLEMENTED(\"fdatasync\");\nmodule.exports.fdatasyncSync = NOT_IMPLEMENTED(\"fdatasyncSync\");\nmodule.exports.fstat = NOT_IMPLEMENTED(\"fstat\");\nmodule.exports.fstatSync = NOT_IMPLEMENTED(\"fstatSync\");\nmodule.exports.fsync = NOT_IMPLEMENTED(\"fsync\");\nmodule.exports.fsyncSync = NOT_IMPLEMENTED(\"fsyncSync\");\nmodule.exports.ftruncate = NOT_IMPLEMENTED(\"ftruncate\");\nmodule.exports.ftruncateSync = NOT_IMPLEMENTED(\"ftruncateSync\");\nmodule.exports.futimes = NOT_IMPLEMENTED(\"futimes\");\nmodule.exports.futimesSync = NOT_IMPLEMENTED(\"futimesSync\");\n\nmodule.exports.lchmod = NOT_IMPLEMENTED(\"lchmod\");\nmodule.exports.lchmodSync = NOT_IMPLEMENTED(\"lchmodSync\");\nmodule.exports.lchown = NOT_IMPLEMENTED(\"lchown\");\nmodule.exports.lchownSync = NOT_IMPLEMENTED(\"lchownSync\");\n\nmodule.exports.link = NOT_IMPLEMENTED(\"link\");\n\nmodule.exports.linkSync = function(existingPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.linkItemAtPath_toPath_error(existingPath, newPath, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(existingPath, undefined, err.value());\n  }\n};\n\nmodule.exports.lstat = NOT_IMPLEMENTED(\"lstat\");\n\nmodule.exports.lstatSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.attributesOfItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return parseStat(result);\n};\n\nmodule.exports.mkdir = NOT_IMPLEMENTED(\"mkdir\");\n\nmodule.exports.mkdirSync = function(path, options) {\n  var mode = 0o777;\n  var recursive = false;\n  if (options && options.mode) {\n    mode = options.mode;\n  }\n  if (options && options.recursive) {\n    recursive = options.recursive;\n  }\n  if (typeof options === \"number\") {\n    mode = options;\n  }\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(\n    path,\n    recursive,\n    {\n      NSFilePosixPermissions: mode\n    },\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.mkdtemp = NOT_IMPLEMENTED(\"mkdtemp\");\n\nmodule.exports.mkdtempSync = function(path) {\n  function makeid() {\n    var text = \"\";\n    var possible =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (var i = 0; i < 6; i++)\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n  }\n  var tempPath = path + makeid();\n  module.exports.mkdirSync(tempPath);\n  return tempPath;\n};\n\nmodule.exports.open = NOT_IMPLEMENTED(\"open\");\nmodule.exports.openSync = NOT_IMPLEMENTED(\"openSync\");\n\nmodule.exports.read = NOT_IMPLEMENTED(\"read\");\n\nmodule.exports.readdir = NOT_IMPLEMENTED(\"readdir\");\n\nmodule.exports.readdirSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n  var fileManager = NSFileManager.defaultManager();\n  var paths = fileManager.subpathsAtPath(path);\n  var arr = [];\n  for (var i = 0; i < paths.length; i++) {\n    var pathName = paths[i];\n    arr.push(encoding === \"buffer\" ? Buffer.from(pathName) : String(pathName));\n  }\n  return arr;\n};\n\nmodule.exports.readFile = NOT_IMPLEMENTED(\"readFile\");\n\nmodule.exports.readFileSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"buffer\");\n  var fileManager = NSFileManager.defaultManager();\n  var data = fileManager.contentsAtPath(path);\n  if (!data) {\n    throw fsErrorForPath(path, false);\n  }\n\n  var buffer = Buffer.from(data);\n\n  if (encoding === \"buffer\") {\n    return buffer;\n  } else if (encoding === \"NSData\") {\n    return buffer.toNSData();\n  } else {\n    return buffer.toString(encoding);\n  }\n};\n\nmodule.exports.readlink = NOT_IMPLEMENTED(\"readlink\");\n\nmodule.exports.readlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.destinationOfSymbolicLinkAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return String(result);\n};\n\nmodule.exports.readSync = NOT_IMPLEMENTED(\"readSync\");\n\nmodule.exports.realpath = NOT_IMPLEMENTED(\"realpath\");\nmodule.exports.realpath.native = NOT_IMPLEMENTED(\"realpath.native\");\n\nmodule.exports.realpathSync = function(path) {\n  return String(NSString.stringWithString(path).stringByResolvingSymlinksInPath());\n};\n\nmodule.exports.realpathSync.native = NOT_IMPLEMENTED(\"realpathSync.native\");\n\nmodule.exports.rename = NOT_IMPLEMENTED(\"rename\");\n\nmodule.exports.renameSync = function(oldPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.moveItemAtPath_toPath_error(oldPath, newPath, err);\n\n  var error = err.value();\n\n  if (error !== null) {\n    // if there is already a file, we need to overwrite it\n    if (\n      String(error.domain()) === \"NSCocoaErrorDomain\" &&\n      Number(error.code()) === 516\n    ) {\n      var err2 = MOPointer.alloc().init();\n      fileManager.replaceItemAtURL_withItemAtURL_backupItemName_options_resultingItemURL_error(\n        NSURL.fileURLWithPath(newPath),\n        NSURL.fileURLWithPath(oldPath),\n        null,\n        NSFileManagerItemReplacementUsingNewMetadataOnly,\n        null,\n        err2\n      );\n      if (err2.value() !== null) {\n        throw fsErrorForPath(oldPath, undefined, err2.value());\n      }\n    } else {\n      throw fsErrorForPath(oldPath, undefined, error);\n    }\n  }\n};\n\nmodule.exports.rmdir = NOT_IMPLEMENTED(\"rmdir\");\n\nmodule.exports.rmdirSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (!isDirectory) {\n    throw fsError(\"ENOTDIR\", {\n      path: path,\n      syscall: \"rmdir\"\n    });\n  }\n  fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, true, err.value(), \"rmdir\");\n  }\n};\n\nmodule.exports.stat = NOT_IMPLEMENTED(\"stat\");\n\n// the only difference with lstat is that we resolve symlinks\n//\n// > lstat() is identical to stat(), except that if pathname is a symbolic\n// > link, then it returns information about the link itself, not the file\n// > that it refers to.\n// http://man7.org/linux/man-pages/man2/lstat.2.html\nmodule.exports.statSync = function(path) {\n  return module.exports.lstatSync(module.exports.realpathSync(path));\n};\n\nmodule.exports.symlink = NOT_IMPLEMENTED(\"symlink\");\n\nmodule.exports.symlinkSync = function(target, path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.createSymbolicLinkAtPath_withDestinationPath_error(\n    path,\n    target,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.truncate = NOT_IMPLEMENTED(\"truncate\");\n\nmodule.exports.truncateSync = function(path, len) {\n  var hFile = NSFileHandle.fileHandleForUpdatingAtPath(sFilePath);\n  hFile.truncateFileAtOffset(len || 0);\n  hFile.closeFile();\n};\n\nmodule.exports.unlink = NOT_IMPLEMENTED(\"unlink\");\n\nmodule.exports.unlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (isDirectory) {\n    throw fsError(\"EPERM\", {\n      path: path,\n      syscall: \"unlink\"\n    });\n  }\n  var result = fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.unwatchFile = NOT_IMPLEMENTED(\"unwatchFile\");\n\nmodule.exports.utimes = NOT_IMPLEMENTED(\"utimes\");\n\nmodule.exports.utimesSync = function(path, aTime, mTime) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFileModificationDate: aTime\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.watch = NOT_IMPLEMENTED(\"watch\");\nmodule.exports.watchFile = NOT_IMPLEMENTED(\"watchFile\");\n\nmodule.exports.write = NOT_IMPLEMENTED(\"write\");\n\nmodule.exports.writeFile = NOT_IMPLEMENTED(\"writeFile\");\n\nmodule.exports.writeFileSync = function(path, data, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  nsdata.writeToFile_atomically(path, true);\n};\n\nmodule.exports.writeSync = NOT_IMPLEMENTED(\"writeSync\");\n","module.exports.parseStat = function parseStat(result) {\n  return {\n    dev: String(result.NSFileDeviceIdentifier),\n    // ino: 48064969, The file system specific \"Inode\" number for the file.\n    mode: result.NSFileType | result.NSFilePosixPermissions,\n    nlink: Number(result.NSFileReferenceCount),\n    uid: String(result.NSFileOwnerAccountID),\n    gid: String(result.NSFileGroupOwnerAccountID),\n    // rdev: 0, A numeric device identifier if the file is considered \"special\".\n    size: Number(result.NSFileSize),\n    // blksize: 4096, The file system block size for i/o operations.\n    // blocks: 8, The number of blocks allocated for this file.\n    atimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    mtimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    ctimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    birthtimeMs:\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000,\n    atime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ), // the 0.5 comes from the node source. Not sure why it's added but in doubt...\n    mtime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    ctime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    birthtime: new Date(\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    isBlockDevice: function() {\n      return result.NSFileType === NSFileTypeBlockSpecial;\n    },\n    isCharacterDevice: function() {\n      return result.NSFileType === NSFileTypeCharacterSpecial;\n    },\n    isDirectory: function() {\n      return result.NSFileType === NSFileTypeDirectory;\n    },\n    isFIFO: function() {\n      return false;\n    },\n    isFile: function() {\n      return result.NSFileType === NSFileTypeRegular;\n    },\n    isSocket: function() {\n      return result.NSFileType === NSFileTypeSocket;\n    },\n    isSymbolicLink: function() {\n      return result.NSFileType === NSFileTypeSymbolicLink;\n    }\n  };\n};\n\nvar ERRORS = {\n  EPERM: {\n    message: \"operation not permitted\",\n    errno: -1\n  },\n  ENOENT: {\n    message: \"no such file or directory\",\n    errno: -2\n  },\n  EACCES: {\n    message: \"permission denied\",\n    errno: -13\n  },\n  ENOTDIR: {\n    message: \"not a directory\",\n    errno: -20\n  },\n  EISDIR: {\n    message: \"illegal operation on a directory\",\n    errno: -21\n  }\n};\n\nfunction fsError(code, options) {\n  var error = new Error(\n    code +\n      \": \" +\n      ERRORS[code].message +\n      \", \" +\n      (options.syscall || \"\") +\n      (options.path ? \" '\" + options.path + \"'\" : \"\")\n  );\n\n  Object.keys(options).forEach(function(k) {\n    error[k] = options[k];\n  });\n\n  error.code = code;\n  error.errno = ERRORS[code].errno;\n\n  return error;\n}\n\nmodule.exports.fsError = fsError;\n\nmodule.exports.fsErrorForPath = function fsErrorForPath(\n  path,\n  shouldBeDir,\n  err,\n  syscall\n) {\n  var fileManager = NSFileManager.defaultManager();\n  var doesExist = fileManager.fileExistsAtPath(path);\n  if (!doesExist) {\n    return fsError(\"ENOENT\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  var isReadable = fileManager.isReadableFileAtPath(path);\n  if (!isReadable) {\n    return fsError(\"EACCES\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  if (typeof shouldBeDir !== \"undefined\") {\n    var isDirectory = module.exports.lstatSync(path).isDirectory();\n    if (isDirectory && !shouldBeDir) {\n      return fsError(\"EISDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    } else if (!isDirectory && shouldBeDir) {\n      return fsError(\"ENOTDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    }\n  }\n  return new Error(err || \"Unknown error while manipulating \" + path);\n};\n\nmodule.exports.encodingFromOptions = function encodingFromOptions(\n  options,\n  defaultValue\n) {\n  return options && options.encoding\n    ? String(options.encoding)\n    : options\n    ? String(options)\n    : defaultValue;\n};\n\nmodule.exports.NOT_IMPLEMENTED = function NOT_IMPLEMENTED(name) {\n  return function() {\n    throw new Error(\n      \"fs.\" +\n        name +\n        \" is not implemented yet. If you feel like implementing it, any contribution will be gladly accepted on https://github.com/skpm/fs\"\n    );\n  };\n};\n","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","'use strict';\n\n/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = finallyConstructor;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nmodule.exports = Promise;\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16)\n  var g = parseInt(hex.slice(2, 4), 16)\n  var b = parseInt(hex.slice(4, 6), 16)\n  var a = parseInt(hex.slice(6, 8), 16)\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function(browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function() {\n    return panel.close()\n  }\n\n  browserWindow.close = function() {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function() {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function() {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function() {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function() {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function() {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function() {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function() {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function() {\n    return false\n  }\n\n  browserWindow.maximize = function() {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function() {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function() {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function() {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function() {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function() {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function(fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function() {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function(aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function(bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function() {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens()\n      .firstObject()\n      .frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function(bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function() {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function() {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function(width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function() {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function(width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function() {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function(resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function() {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function(movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function() {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function(minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function() {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function(maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function() {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function(fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function(closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function() {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function(top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function() {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function() {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function(x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function(title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function() {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function(flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function() {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function() {\n    return webview\n  }\n\n  browserWindow.loadURL = function(url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' +\n          __command\n            .pluginBundle()\n            .urlForResourceNamed(url)\n            .path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function() {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function(hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function() {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function(opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function() {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function(visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function(ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function(enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function(autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function(type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function(colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function() {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function(button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  JS_BRIDGE_RESULT_SUCCESS: '__skpm_sketchBridge_success',\n  JS_BRIDGE_RESULT_ERROR: '__skpm_sketchBridge_error',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function(webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && el.tagName === \"SELECT\") {' + // select needs special handling\n    '  var event = document.createEvent(\"MouseEvents\");' +\n    '  event.initMouseEvent(\"mousedown\", true, true, window);' +\n    '  el.dispatchEvent(event);' +\n    '} else if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function(resolve, reject) {\n        browserWindow.once('ready-to-show', function() {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function(resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function(res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function(err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function(script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || NSUUID.UUID().UUIDString()\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  let title = options.title\n  if (options.frame === false) {\n    title = undefined\n  } else if (\n    typeof title === 'undefined' &&\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle()\n  ) {\n    title = __command.pluginBundle().name()\n  }\n\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function(event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function() {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    var observer = threadDictionary[identifier + '.themeObserver']\n    if (observer) {\n      NSApplication.sharedApplication().removeObserver_forKeyPath(\n        observer,\n        'effectiveAppearance'\n      )\n      threadDictionary.removeObjectForKey(identifier + '.themeObserver')\n    }\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function() {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function(identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function(panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    '  if (!actionName) {' +\n    \"    throw new Error('missing action name')\" +\n    '  }' +\n    '  var id = String(Math.random()).replace(\".\", \"\");' +\n    '    var args = [].slice.call(arguments);' +\n    '    args.unshift(id);' +\n    '  return new Promise(function (resolve, reject) {' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n    '\" + id] = resolve;' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n    '\" + id] = reject;' +\n    '    window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(JSON.stringify(args));' +\n    '  });' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n\nmodule.exports.setupHandler = function(browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function() {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function(webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\nvar ThemeObserverClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function(browserWindow, panel, webview, options) {\n  if (!ThemeObserverClass) {\n    ThemeObserverClass = new ObjCClass({\n      utils: null,\n\n      'observeValueForKeyPath:ofObject:change:context:': function() {\n        this.utils.executeJavaScript(\n          \"document.body.classList.remove('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'light'\n              : 'dark') +\n            \"'); document.body.classList.add('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'dark'\n              : 'light') +\n            \"')\"\n        )\n      },\n    })\n  }\n\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function() {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function() {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function() {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function() {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function() {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function() {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function() {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function() {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function() {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function() {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function() {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function(webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function() {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function() {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function(\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function() {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web view’s web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function() {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function(_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var themeObserver = ThemeObserverClass.new({\n    utils: {\n      executeJavaScript(script) {\n        webview.evaluateJavaScript_completionHandler(script, null)\n      },\n    },\n  })\n\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    \"document.addEventListener('DOMContentLoaded', function() { document.body.classList.add('__skpm-\" +\n      (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n        ? 'dark'\n        : 'light') +\n      \"') }, false)\",\n    0,\n    true\n  )\n  webview\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n\n  NSApplication.sharedApplication().addObserver_forKeyPath_options_context(\n    themeObserver,\n    'effectiveAppearance',\n    NSKeyValueChangeNewKey,\n    null\n  )\n\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n  threadDictionary[browserWindow.id + '.themeObserver'] = themeObserver\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit(id, type) {\n        if (!type) {\n          webview.evaluateJavaScript_completionHandler(\n            CONSTANTS.JS_BRIDGE_RESULT_SUCCESS + id + '()',\n            null\n          )\n          return\n        }\n\n        var args = []\n        for (var i = 2; i < arguments.length; i += 1) args.push(arguments[i])\n\n        var listeners = browserWindow.webContents.listeners(type)\n\n        Promise.all(\n          listeners.map(function(l) {\n            return Promise.resolve().then(function() {\n              return l.apply(l, args)\n            })\n          })\n        )\n          .then(function(res) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n                id +\n                '(' +\n                JSON.stringify(res) +\n                ')',\n              null\n            )\n          })\n          .catch(function(err) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n                id +\n                '(' +\n                JSON.stringify(err) +\n                ')',\n              null\n            )\n          })\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function() {\n    return String(webview.url())\n  }\n\n  webContents.getTitle = function() {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function() {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function() {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function() {\n    return !webview.loading()\n  }\n\n  webContents.stop = function() {\n    webview.stopLoading()\n  }\n  webContents.reload = function() {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function() {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function() {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function() {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function(offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function() {\n    webview.goBack()\n  }\n  webContents.goForward = function() {\n    webview.goForward()\n  }\n  webContents.goToIndex = function(index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function(offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function(/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function() {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function(css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.insertJS = function(source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function(/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function(factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function(callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function(level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function(callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function() {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function() {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","export default {\n  name: \"dark\",\n  text: \"#E6E4EB\",\n  bg: \"#2D2D2D\",\n  previewColor: \"#F3F2F5\",\n\n  input: {\n    background: \"#373737\",\n    color: \"#F3F2F5\",\n    border: \"#454545\",\n    borderActive: \"#1384FF\"\n  },\n\n  button: {\n    color: \"#F3F2F5\",\n    bgColor: \"rgba(255,255,255,0.25)\",\n    border: \"#636363\",\n    bgActive: \"rgba(255,255,255,0.10)\"\n  },\n\n  secondaryButton: {\n    borderColor: \"#636363\",\n    textColor: \"#F3F2F5\"\n  },\n\n  CTAButton: {\n    bgColor: \"#1384FF\",\n    textColor: \"#fff\",\n    bgActive: \"#0F72DB\"\n  },\n\n  radio: {\n    selectedColor: \"#1384FF\",\n    border: \"#1384FF\"\n  }\n}\n","import dark from \"./dark\"\nimport light from \"./light\"\n\nexport default theme => {\n  if (theme === \"dark\") {\n    return dark\n  }\n  return light\n}\n","export default {\n  name: \"light\",\n  text: \"#747474\",\n  bg: \"#F7F7F7\",\n  previewColor: \"#242424\",\n\n  input: {\n    background: \"#FBFBFB\",\n    color: \"#505050\",\n    border: \"#E4E4E4\",\n    borderActive: \"#1384FF\"\n  },\n\n  button: {\n    color: \"#505050\",\n    bgColor: \"#FBFBFB\",\n    border: \"#E4E4E4\",\n    bgActive: \"#F3F2F5\"\n  },\n\n  secondaryButton: {\n    borderColor: \"#B2AEBD\",\n    textColor: \"#817B8F\"\n  },\n\n  CTAButton: {\n    bgColor: \"#1384FF\",\n    textColor: \"#fff\",\n    bgActive: \"#0F72DB\"\n  },\n\n  radio: {\n    selectedColor: \"#969696\",\n    border: \"#969696\"\n  }\n}\n","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/fedcb36887af924ae92824d43f90ed04.html\";","import theUI from './lib/TheUI';\nlet Settings = require('sketch/settings');\nimport BrowserWindow from 'sketch-module-web-view';\n\nlet SelectedDocument = require('sketch/dom').getSelectedDocument();\n\nexport function checkSelectedParentHeading() {\n\tlet win = BrowserWindow.fromId('resetParentHeading.ui');\n\tif (!win) {\n\t\treturn;\n\t}\n\n\tlet selection = SelectedDocument.selectedLayers;\n\tlet selectionLayers = selection.layers;\n\tif (selectionLayers.length === 1 && selectionLayers[0].type === 'Artboard') {\n\t\tlet artboard = selectionLayers[0];\n\t\tlet layers = artboard.layers;\n\t\tfor (let index = 0; index < layers.length; index++) {\n\t\t\tconst layer = layers[index];\n\n\t\t\tif (layer.type !== 'SymbolInstance') continue;\n\n\t\t\tif (layer.master.name === 'Title') {\n\t\t\t\tlet override = layer.overrides[0];\n\t\t\t\tif (override) {\n\t\t\t\t\tlet parentHeading = Settings.layerSettingForKey(artboard, 'parentHeading');\n\t\t\t\t\tif (!parentHeading) {\n\t\t\t\t\t\tparentHeading = '';\n\t\t\t\t\t}\n\t\t\t\t\twin.webContents.executeJavaScript(`resetParentHeading(1, ${JSON.stringify(parentHeading)})`);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\twin.webContents.executeJavaScript(`resetParentHeading(0, ${JSON.stringify('')})`);\n\treturn false;\n}\n\nexport function onSelectedChanged(context) {\n\t// var path = context.plugin.urlForResourceNamed('handlepdf.py').path();\n\t// console.log('path:', path);\n\tcheckSelectedParentHeading();\n}\n\nexport function showUI() {\n\tconst options = {\n\t\tidentifier: 'resetParentHeading.ui',\n\t\ttitle: '设置父级标题',\n\t\tredirectTo: '/reset_parentHeading',\n\t\twidth: 600,\n\t\theight: 310,\n\t};\n\n\ttheUI(options);\n\n\tsetTimeout(checkSelectedParentHeading.bind(null), 1000);\n\tsetTimeout(checkSelectedParentHeading.bind(null), 2000);\n\tsetTimeout(checkSelectedParentHeading.bind(null), 3000);\n}\n","let Sketch = require('sketch');\nlet Settings = require('sketch/settings');\nlet Text = require('sketch/dom').Text;\nlet UI = require('sketch/ui');\n\nimport { getArtboardsSorted } from './Utilities';\n\nlet SelectedDocument = require('sketch/dom').getSelectedDocument();\n\nlet BrowserWindow = null;\nlet WebContents = null;\n\nlet Artboards = [];\nlet ArtboardIndex = 0;\nlet ArtboardSort = '';\n\nfunction handleArtboard(artboard) {\n\tlet instances = Sketch.find('SymbolInstance', artboard);\n\tfor (let index = 0; index < instances.length; index++) {\n\t\tconst instance = instances[index];\n\t\tif (instance.master.name === 'Title') {\n\t\t\tlet titleOverride = instance.overrides[0];\n\t\t\tif (titleOverride) {\n\t\t\t\tlet pageNumber = new Text({\n\t\t\t\t\tparent: artboard,\n\t\t\t\t\ttext: '0',\n\t\t\t\t\tname: 'pageNumber',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tborders: [],\n\t\t\t\t\t\tfontFamily: 'PingFang SC',\n\t\t\t\t\t\tfontSize: 88,\n\t\t\t\t\t\tfontWeight: 4,\n\t\t\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\t\t\talignment: 'right',\n\t\t\t\t\t\tverticalAlignment: 'center',\n\t\t\t\t\t},\n\t\t\t\t\tframe: {\n\t\t\t\t\t\tx: 6747,\n\t\t\t\t\t\ty: 88,\n\t\t\t\t\t\twidth: 53,\n\t\t\t\t\t\theight: 123,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tpageNumber.text = (ArtboardIndex + 1).toString();\n\t\t\t\tSettings.setLayerSettingForKey(pageNumber, 'textType', 'pageNumber');\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (ArtboardIndex === Artboards.length - 1) {\n\t\tBrowserWindow.close();\n\t\tSketch.UI.message('Successfully! 🙌');\n\t} else {\n\t\t++ArtboardIndex;\n\t\tsetTimeout(handleArtboard.bind(null, Artboards[ArtboardIndex]), 20);\n\t}\n}\n\nfunction removePageNumber() {\n\tSketch.find('Text', SelectedDocument.selectedPage).forEach(text => {\n\t\tif (Settings.layerSettingForKey(text, 'textType') === 'pageNumber') {\n\t\t\ttext.remove();\n\t\t}\n  });\n  \n\tArtboards = getArtboardsSorted(SelectedDocument.selectedPage, ArtboardSort);\n\tif (Artboards.length > 0) {\n\t\tArtboardIndex = 0;\n\t\tsetTimeout(handleArtboard.bind(null, Artboards[0]), 20);\n\t}\n}\n\nfunction clearOldPageNumber() {\n\tSketch.find('Text, [name=\"{page}\"]').forEach(layer => {\n\t\tlayer.remove();\n\t});\n\n\tsetTimeout(removePageNumber.bind(null), 20);\n}\n\nexport function addPageNumber(artboardSort, contents, win) {\n\tBrowserWindow = win;\n  WebContents = contents;\n  ArtboardSort = artboardSort;\n\n\tsetTimeout(clearOldPageNumber.bind(null), 20);\n}\n","export const TocPageName = \"Table of Contents\"\n\nexport const ArtboardSortEnum = {\n  Top2BottomByLayerList: 1,\n  Bottom2TopByLayerList: 2,\n  Left2RightByArtboard: 3,\n  Right2LeftByArtboard: 4,\n  Top2BottomByArtboard: 5,\n}\nexport const ArtbaordLayersSortEnum = {\n  Top2BottomByLayerList: 1,\n  Top2BottomByLayerList: 2,\n}\n","let Sketch = require('sketch');\nlet Artboard = require('sketch/dom').Artboard;\nlet Settings = require('sketch/settings');\nlet Group = require('sketch/dom').Group;\nlet Text = require('sketch/dom').Text;\nlet ShapePath = require('sketch/dom').ShapePath;\nlet UI = require('sketch/ui');\n\nimport { getArtboardsSorted } from './Utilities';\n\nlet SelectedDocument = require('sketch/dom').getSelectedDocument();\n\nlet BrowserWindow = null;\nlet WebContents = null;\n\nlet NoParentHeadingArtboard;\nlet InvalidHeadingOverride;\n\n// 目录参数\nlet ContentWidth = 7000;\nlet ContentHeight = 4949;\nlet GroupSpacing = 700;\nlet GroupTopMargin = 500;\nlet GroupLeftAndRightMargin = 200;\nlet GroupCounts = 3;\nlet GroupWidth = (ContentWidth - GroupLeftAndRightMargin * 2 - GroupSpacing * 2) / GroupCounts;\n\n// 全局变量，用于异步处理耗时操作\nlet Artboards = [];\nlet ArtboardIndex = 0;\nlet HeadingsMap = new Map();\nlet PageTitleMaster;\nlet BottomBannerMaster;\nlet LastHeadingSerial = '';\n\nfunction addPgaeNumber(artboard, value) {\n\tlet pageNumber = new Text({\n\t\tparent: artboard,\n\t\ttext: '0',\n\t\tname: 'pageNumber',\n\t\tstyle: {\n\t\t\tborders: [],\n\t\t\tfontFamily: 'PingFang SC',\n\t\t\tfontSize: 88,\n\t\t\tfontWeight: 4,\n\t\t\ttextColor: '#FFFFFF',\n\t\t\talignment: 'right',\n\t\t\tverticalAlignment: 'center',\n\t\t},\n\t\tframe: {\n\t\t\tx: 6747,\n\t\t\ty: 88,\n\t\t\twidth: 53,\n\t\t\theight: 123,\n\t\t},\n\t});\n\tpageNumber.text = value;\n\tpageNumber.name = 'pageNumber';\n\tSettings.setLayerSettingForKey(pageNumber, 'textType', 'pageNumber');\n}\n\nfunction addPageNumbers(contentsArtboards) {\n\tSketch.find('Text, [name=\"{page}\"]').forEach(layer => {\n\t\tlayer.remove();\n\t});\n\n\tSketch.find('Text', SelectedDocument.selectedPage).forEach(text => {\n\t\tif (Settings.layerSettingForKey(text, 'textType') === 'pageNumber') {\n\t\t\ttext.remove();\n\t\t}\n\t});\n\n\tArtboards.forEach(artboard => {\n\t\tlet instances = Sketch.find('SymbolInstance', artboard);\n\t\tfor (let index = 0; index < instances.length; index++) {\n\t\t\tconst instance = instances[index];\n\t\t\tif (instance.master.name === 'Title') {\n\t\t\t\tlet titleOverride = instance.overrides[0];\n\t\t\t\tif (titleOverride) {\n\t\t\t\t\tlet value = HeadingsMap.get(titleOverride.value);\n\t\t\t\t\tif (value > 2) {\n\t\t\t\t\t\tvalue += contentsArtboards.length;\n\t\t\t\t\t}\n\t\t\t\t\taddPgaeNumber(artboard, value.toString());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tlet index = 3;\n\tcontentsArtboards.forEach(artboard => {\n\t\taddPgaeNumber(artboard, index.toString());\n\t\t++index;\n\t});\n\n\tif (contentsArtboards.length > 0) {\n\t\tSelectedDocument.selectedLayers.forEach(layer => {\n\t\t\tlayer.selected = false;\n\t\t});\n\t\tcontentsArtboards[0].selected = true;\n\t\tSelectedDocument.centerOnLayer(contentsArtboards[0]);\n\t}\n\n\tBrowserWindow.close();\n\tSketch.UI.message('Successfully! 🙌');\n}\n\nfunction createHeading(artboard, originalX, originalY, headingLevel, headingText, pageNumber) {\n\tlet groupHeight;\n\n\t// 序号及标题\n\tlet serialAndContentX;\n\tlet serialAndContentHeight;\n\tlet serialAndContentFontSize;\n\tlet serialAndContentFontWeight;\n\tlet serialAndContentFontColor;\n\tif (headingLevel === 1) {\n\t\tserialAndContentX = 0;\n\t\tserialAndContentHeight = 90;\n\t\tserialAndContentFontSize = 64;\n\t\tserialAndContentFontWeight = 6; // Medium\n\t\tserialAndContentFontColor = '#333333';\n\t\tgroupHeight = serialAndContentHeight;\n\t} else if (headingLevel === 2) {\n\t\tserialAndContentX = 80;\n\t\tserialAndContentHeight = 78;\n\t\tserialAndContentFontSize = 56;\n\t\tserialAndContentFontWeight = 4; // Regular\n\t\tserialAndContentFontColor = '#333333';\n\t\tgroupHeight = serialAndContentHeight;\n\t} else {\n\t\tserialAndContentX = 160;\n\t\tserialAndContentHeight = 67;\n\t\tserialAndContentFontSize = 48;\n\t\tserialAndContentFontWeight = 4; // Regular\n\t\tserialAndContentFontColor = '#666666';\n\t\tgroupHeight = serialAndContentHeight;\n\t}\n\tlet serialAndContent = new Text({\n\t\ttext: headingText.trim(), // NOTE: list text first! text maybe change the name\n\t\tname: 'serialAndContent',\n\t\tstyle: {\n\t\t\tborders: [],\n\t\t\tfontFamily: 'PingFang SC',\n\t\t\tfontSize: serialAndContentFontSize,\n\t\t\tfontWeight: serialAndContentFontWeight,\n\t\t\ttextColor: serialAndContentFontColor,\n\t\t\talignment: 'left',\n\t\t\tverticalAlignment: 'center',\n\t\t},\n\t\tframe: {\n\t\t\tx: serialAndContentX,\n\t\t\ty: (groupHeight - serialAndContentHeight) / 2, // 无法固定高度，用此方法代替\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\t// 连接线\n\tlet separator = new ShapePath({\n\t\tname: 'separator',\n\t\tshapeType: ShapePath.ShapeType.Custom,\n\t\tstyle: {\n\t\t\tborders: [\n\t\t\t\t{\n\t\t\t\t\tthickness: 3,\n\t\t\t\t},\n\t\t\t],\n\t\t\tborderOptions: {\n\t\t\t\tdashPattern: [20, 5, 20, 5],\n\t\t\t},\n\t\t},\n\t\tframe: {\n\t\t\tx: serialAndContent.frame.x + serialAndContent.frame.width + 100,\n\t\t\ty: 0,\n\t\t\twidth: GroupWidth - (serialAndContent.frame.x + serialAndContent.frame.width + 100) - 100,\n\t\t\theight: groupHeight,\n\t\t},\n\t\tpoints: [\n\t\t\t{\n\t\t\t\tpoint: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0.5,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tpoint: {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: 0.5,\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t});\n\n\t// 页码\n\tlet pageNumberFontSize;\n\tif (headingLevel === 1) {\n\t\tpageNumberFontSize = 56;\n\t} else if (headingLevel === 2) {\n\t\tpageNumberFontSize = 56;\n\t} else if (headingLevel === 3) {\n\t\tpageNumberFontSize = 56;\n\t}\n\tlet page = new Text({\n\t\ttext: pageNumber.toString(),\n\t\tname: 'pageNumber',\n\t\tstyle: {\n\t\t\tborders: [],\n\t\t\tfontFamily: 'PingFang SC',\n\t\t\tfontSize: pageNumberFontSize,\n\t\t\tfontWeight: 4, // Regular\n\t\t\ttextColor: '#333333',\n\t\t\talignment: 'right',\n\t\t\tverticalAlignment: 'center',\n\t\t},\n\t\tframe: {\n\t\t\tx: GroupWidth - 100,\n\t\t\ty: (groupHeight - 78) / 2,\n\t\t\twidth: 100,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\t// 占位，用于设定 Group 的高度\n\tlet placeholder = new ShapePath({\n\t\tname: 'placeholder',\n\t\tshapeType: ShapePath.ShapeType.Custom,\n\t\tframe: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\n\tlet group = new Group({\n\t\tparent: artboard,\n\t\tname: headingText,\n\t\tframe: {\n\t\t\tx: originalX,\n\t\t\ty: originalY,\n\t\t\twidth: GroupWidth,\n\t\t\theight: groupHeight,\n\t\t},\n\t});\n\tgroup.adjustToFit();\n\tgroup.layers = [placeholder, serialAndContent, separator, page];\n\n\treturn group;\n}\n\nfunction checkHeadingSerial(lastSerial, currentSerial) {\n\tlet hasError = false;\n\tif (lastSerial.length === 0) {\n\t\tif (currentSerial !== '1.') {\n\t\t\thasError = true;\n\t\t}\n\t} else if (lastSerial.endsWith('.')) {\n\t\tlet tempLastSerial = lastSerial;\n\t\tif (lastSerial.split('.')[0] === '1' && currentSerial.split('.')[0] === '3') {\n\t\t\ttempLastSerial = '2.';\n\t\t}\n\t\tif (currentSerial !== tempLastSerial + '1' && currentSerial !== parseInt(tempLastSerial) + 1 + '.') {\n\t\t\thasError = true;\n\t\t}\n\t} else {\n\t\tlet array = lastSerial.split('.');\n\n\t\tlet newArray = array;\n\t\tlet secondLastNumber;\n\t\tlet serialLength = array.length;\n\t\tif (serialLength > 2) {\n\t\t\tsecondLastNumber = newArray[newArray.length - 2];\n\t\t\tnewArray.splice(newArray.length - 1, 2);\n\t\t}\n\t\tlet firstNumber = array[0];\n\t\tlet lastNumber = array[array.length - 1];\n\t\tarray.splice(array.length - 1, 1);\n\n\t\tif (serialLength === 2) {\n\t\t\tif (\n\t\t\t\tcurrentSerial !== lastSerial + '.1' &&\n\t\t\t\tcurrentSerial !== firstNumber + '.' + (parseInt(lastNumber) + 1) &&\n\t\t\t\tcurrentSerial !== parseInt(firstNumber) + 1 + '.'\n\t\t\t) {\n\t\t\t\thasError = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (\n\t\t\t\tcurrentSerial !== lastSerial + '.1' &&\n\t\t\t\tcurrentSerial !== array.join('.') + (parseInt(lastNumber) + 1) &&\n\t\t\t\tcurrentSerial !== newArray.join('.') + (parseInt(secondLastNumber) + 1)\n\t\t\t) {\n\t\t\t\thasError = true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn !hasError;\n}\n\nfunction focusArtboard(artboard) {\n\tSelectedDocument.selectedLayers.forEach(layer => {\n\t\tlayer.selected = false;\n\t});\n\tartboard.parent.selected = true;\n\tartboard.selected = true;\n\tSelectedDocument.centerOnLayer(artboard);\n}\n\nfunction updateContentsPage(contentsArtboards, headingsMap) {\n\t// set contents page heading\n\tlet contentsTitles = [];\n\tfor (let index = 0; index < contentsArtboards.length; index++) {\n\t\tlet artboard = contentsArtboards[index];\n\t\tlet value;\n\t\tif (index === 0) {\n\t\t\tif (contentsArtboards.length === 1) {\n\t\t\t\tvalue = '2. 目录';\n\t\t\t} else {\n\t\t\t\tvalue = '2. 目录01';\n\t\t\t}\n\t\t} else {\n\t\t\tlet number;\n\t\t\tif (index < 10) {\n\t\t\t\tnumber = '0' + index;\n\t\t\t} else {\n\t\t\t\tnumber = index;\n\t\t\t}\n\t\t\tvalue = '2.' + index.toString() + ' 目录' + number;\n\t\t}\n\t\tartboard.layers[0].overrides[0].value = value;\n\t\tcontentsTitles.push(value);\n\t}\n\n\t// insert contents page in TOC\n\tlet newHeadingMap = new Map();\n\tlet frontContentsPages = 0;\n\tlet hasAddContents = false;\n\theadingsMap.forEach((pageNumber, headingText) => {\n\t\tif (!hasAddContents && parseInt(headingText.split('.')[0]) > 2) {\n\t\t\thasAddContents = true;\n\t\t\tfor (let index = 0; index < contentsTitles.length; index++) {\n\t\t\t\tconst title = contentsTitles[index];\n\t\t\t\tnewHeadingMap.set(title, frontContentsPages + index + 1);\n\t\t\t}\n\t\t}\n\n\t\tfrontContentsPages += pageNumber;\n\t\tnewHeadingMap.set(headingText, pageNumber);\n\t});\n\n\t// reset TOC page number\n\tnewHeadingMap.forEach((pageNumber, headingText) => {\n\t\tif (parseInt(headingText.split('.')[0]) > 2) {\n\t\t\tnewHeadingMap.set(headingText, pageNumber + contentsArtboards.length);\n\t\t}\n\t});\n\n\treturn newHeadingMap;\n}\n\nfunction addHeading(page, headingsMap) {\n\t// delete contents artboard\n\tpage.layers.forEach(artboard => {\n\t\tif (Settings.layerSettingForKey(artboard, 'layerType') === 'TOC') {\n\t\t\tartboard.remove();\n\t\t}\n\t});\n\n\tlet artboard;\n\tlet contentsArtboards = [];\n\tlet contentsPageIndex = 0;\n\tlet lastLevel = 1;\n\tlet column = 0;\n\tlet originalY = GroupTopMargin;\n\tlet needAddNewArtboard = true;\n\tfor (let [headingText, pageNumber] of headingsMap) {\n\t\t// create artboard\n\t\tif (needAddNewArtboard) {\n\t\t\tartboard = new Artboard({\n\t\t\t\tparent: page,\n\t\t\t\tname: 'Contents ' + (contentsPageIndex + 1).toString(),\n\t\t\t\tframe: {\n\t\t\t\t\tx: 0 + (ContentWidth + 50) * contentsPageIndex,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: ContentWidth,\n\t\t\t\t\theight: ContentHeight,\n\t\t\t\t},\n\t\t\t\tbackground: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tcolor: '#FBFBFB',\n\t\t\t\t},\n\t\t\t});\n\t\t\tSettings.setLayerSettingForKey(artboard, 'layerType', 'TOC');\n\t\t\tcontentsArtboards.push(artboard);\n\n\t\t\tlet topBanner = PageTitleMaster.createNewInstance();\n\t\t\tlet bottomBanner = BottomBannerMaster[0].createNewInstance();\n\t\t\tbottomBanner.frame.y = ContentHeight - bottomBanner.frame.height;\n\t\t\ttopBanner.parent = artboard;\n\t\t\tbottomBanner.parent = artboard;\n\n\t\t\tcontentsPageIndex += 1;\n\t\t}\n\n\t\t// check level\n\t\tlet currentLevel;\n\t\tlet serialText = headingText.split(' ')[0];\n\t\tif (serialText.endsWith('.')) {\n\t\t\tcurrentLevel = 1;\n\t\t} else {\n\t\t\tcurrentLevel = serialText.split('.').length;\n\t\t}\n\n\t\t// create headings\n\t\tlet originalX = GroupLeftAndRightMargin + GroupWidth * column + GroupSpacing * column;\n\t\tif (!needAddNewArtboard) {\n\t\t\tif (currentLevel === 1) {\n\t\t\t\toriginalY += 100;\n\t\t\t} else {\n\t\t\t\toriginalY += 46;\n\t\t\t}\n\t\t}\n\t\tlastLevel = currentLevel;\n\t\tlet group = createHeading(artboard, originalX, originalY, currentLevel, headingText, pageNumber);\n\n\t\tif (group.frame.y > 4000) {\n\t\t\tcolumn += 1;\n\t\t\toriginalY = GroupTopMargin;\n\t\t} else {\n\t\t\toriginalY += group.frame.height;\n\t\t}\n\n\t\tif (column > 2) {\n\t\t\tneedAddNewArtboard = true;\n\t\t\tcolumn = 0;\n\t\t} else {\n\t\t\tneedAddNewArtboard = false;\n\t\t}\n\t}\n\n\treturn contentsArtboards;\n}\n\nfunction checkHeading(artboard) {\n\t// 过滤掉目录页\n\tlet type = Settings.layerSettingForKey(artboard, 'layerType');\n\t// 遍历画板所有层，找出标题层\n\tlet layers = artboard.layers;\n\tfor (let index = 0; index < layers.length; index++) {\n\t\tconst layer = layers[index];\n\n\t\tif (layer.type !== 'SymbolInstance') continue;\n\n\t\tif (layer.master.name === 'Title') {\n\t\t\tlet override = layer.overrides[0];\n\t\t\tif (override) {\n\t\t\t\tPageTitleMaster = layer.master;\n\n\t\t\t\t// 优化空格\n\t\t\t\tlet value = override.value;\n\t\t\t\tvalue = value.trim();\n\t\t\t\tvalue = value.replace(/ {1,}/, ' ');\n\t\t\t\toverride.value = value;\n\n\t\t\t\t// 检查是否有重复\n\t\t\t\toverride = layer.overrides[0]; // Fix: ?\n\t\t\t\tif (HeadingsMap.has(override.value)) {\n\t\t\t\t\t// 标题有重复，提示用户修正\n\t\t\t\t\tconsole.log('same heading:', override.value);\n\t\t\t\t\tfocusArtboard(artboard);\n\t\t\t\t\tInvalidHeadingOverride = override;\n\t\t\t\t\tWebContents.executeJavaScript(`showCreateTocHint('标题有重复', ${JSON.stringify(override.value)})`);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// 匹配六级标题：（1.）（1.1）（1.1.1）...\n\t\t\t\tlet pattern = /(^[1-9][0-9]{0,}\\. )|(^[1-9][0-9]{0,}((\\.[1-9][0-9]{0,}){1,5}) )/;\n\t\t\t\tlet regex = new RegExp(pattern);\n\t\t\t\tif (override.value.length && !regex.test(override.value)) {\n\t\t\t\t\t// 标题格式不正确，提示用户修正\n\t\t\t\t\tconsole.log('invalid format heading:', override.value);\n\t\t\t\t\tfocusArtboard(artboard);\n\t\t\t\t\tInvalidHeadingOverride = override;\n\t\t\t\t\tWebContents.executeJavaScript(\n\t\t\t\t\t\t`showCreateTocHint('无效的标题，正确格式示例:【1. XXX】 或者 【1.1 XXX】', ${JSON.stringify(\n\t\t\t\t\t\t\toverride.value\n\t\t\t\t\t\t)})`\n\t\t\t\t\t);\n\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\t// 标题格式正确，判断是否需要提示指定父级标题\n\t\t\t\t\tlet currentSerial = override.value.split(' ')[0];\n\t\t\t\t\tif (currentSerial.endsWith('1') && !currentSerial.startsWith(LastHeadingSerial)) {\n\t\t\t\t\t\tlet parentHeading = Settings.layerSettingForKey(artboard, 'parentHeading');\n\t\t\t\t\t\tif (!parentHeading) {\n\t\t\t\t\t\t\tconsole.log('should add parent heading:', artboard.name);\n\t\t\t\t\t\t\tfocusArtboard(artboard);\n\t\t\t\t\t\t\tNoParentHeadingArtboard = artboard;\n\t\t\t\t\t\t\tWebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t`showCreateTocHint('需要添加当前标题的父标题，当前标题为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\t\toverride.value\n\t\t\t\t\t\t\t\t)})`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if (!parentHeading.startsWith(currentSerial.slice(0, -2))) {\n\t\t\t\t\t\t\tlet serial = parentHeading.split(' ')[0];\n\t\t\t\t\t\t\tif (!checkHeadingSerial(LastHeadingSerial, serial) || currentSerial !== serial + '.1') {\n\t\t\t\t\t\t\t\tconsole.log('invalid sort parent heading:', artboard.name);\n\t\t\t\t\t\t\t\tfocusArtboard(artboard);\n\t\t\t\t\t\t\t\tNoParentHeadingArtboard = artboard;\n\t\t\t\t\t\t\t\tWebContents.executeJavaScript(\n\t\t\t\t\t\t\t\t\t`showCreateTocHint('父级标题序号不正确，请更正。上一标题序号为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\t\t\tLastHeadingSerial\n\t\t\t\t\t\t\t\t\t)}, ${JSON.stringify(parentHeading)})`\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLastHeadingSerial = parentHeading.split(' ')[0];\n\t\t\t\t\t\t\tHeadingsMap.set(parentHeading, ArtboardIndex + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 检查标题序号\n\t\t\t\t\tif (!checkHeadingSerial(LastHeadingSerial, currentSerial)) {\n\t\t\t\t\t\tconsole.log('invalid sort heading:', override.value);\n\t\t\t\t\t\tfocusArtboard(artboard);\n\t\t\t\t\t\tInvalidHeadingOverride = override;\n\t\t\t\t\t\tWebContents.executeJavaScript(\n\t\t\t\t\t\t\t`showCreateTocHint('当前标题序号不正确，请更正。上一标题序号为:' + ${JSON.stringify(\n\t\t\t\t\t\t\t\tLastHeadingSerial\n\t\t\t\t\t\t\t)}, ${JSON.stringify(override.value)})`\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tHeadingsMap.set(override.value, ArtboardIndex + 1);\n\t\t\t\t\tLastHeadingSerial = currentSerial;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t// 判断最后一个\n\tif (ArtboardIndex < Artboards.length - 1) {\n\t\t++ArtboardIndex;\n\t\tsetTimeout(checkHeading.bind(null, Artboards[ArtboardIndex]), 5);\n\t} else {\n\t\tif (HeadingsMap.size === 0) {\n\t\t\tconsole.log('no headings');\n\t\t\tUI.alert('Error', '找不到目录页，请检查标题设置是否正确');\n\t\t\tWebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\t\treturn;\n\t\t}\n\n\t\t// add headings\n\t\tlet contentsArtboards = addHeading(SelectedDocument.selectedPage, HeadingsMap);\n\t\tlet newHeadingsMap = updateContentsPage(contentsArtboards, HeadingsMap);\n\n\t\t// add headings again\n\t\tlet newContentsArtboards = addHeading(SelectedDocument.selectedPage, newHeadingsMap);\n\t\tnewHeadingsMap = updateContentsPage(newContentsArtboards, newHeadingsMap);\n\n\t\tif (contentsArtboards.length !== newContentsArtboards.length) {\n\t\t\tconsole.log(\"new content artboards'size greater than the old one.\");\n\t\t\tnewContentsArtboards = addHeading(SelectedDocument.selectedPage, newHeadingsMap);\n\t\t\tnewHeadingsMap = updateContentsPage(newContentsArtboards, newHeadingsMap);\n\t\t}\n\n\t\t// 添加页码\n\t\tsetTimeout(addPageNumbers.bind(null, newContentsArtboards), 5);\n\t}\n}\n\nfunction checkMasters() {\n\tBottomBannerMaster = Sketch.find('SymbolMaster, [name=\"页尾\"]');\n\tif (!BottomBannerMaster.length) {\n\t\tconsole.log('can not found the banner');\n\t\tUI.alert('Error', '请添加生成目录所需要组件:页尾');\n\t\tWebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nfunction checkSelectedPage() {\n\tlet page = SelectedDocument.selectedPage;\n\tif (!page) {\n\t\tUI.alert('Error', '请选中“文档页”');\n\t\treturn false;\n\t} else if (page.isSymbolsPage()) {\n\t\tUI.alert('Error', '请选中“文档页”，当前选中的是“组件页”');\n\t\treturn false;\n\t} else if (Settings.layerSettingForKey(page, 'layerType') === 'TOC') {\n\t\tUI.alert('Error', '请选中“文档页”，当前选中的是“目录页”');\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function createTableOfContents(artboardSort, contents, win, isContinue = false) {\n\tif (!isContinue) {\n\t\tBrowserWindow = win;\n\t\tWebContents = contents;\n\n\t\tif (!checkSelectedPage()) {\n\t\t\tWebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!checkMasters()) {\n\t\t\tWebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\t\treturn;\n\t\t}\n\n\t\t// 得到排序后的画板\n\t\tArtboards = getArtboardsSorted(SelectedDocument.selectedPage, artboardSort);\n\n\t\tif (Artboards.length === 0) {\n\t\t\tconsole.log('no artboards');\n\t\t\tUI.alert('Error', '当前文档为空，无需要生成目录');\n\t\t\tWebContents.executeJavaScript(`showCreateTocCreate()`);\n\t\t\treturn;\n\t\t}\n\n\t\t// 过滤掉 TOC\n\t\tfor (let index = 0; index < Artboards.length; index++) {\n\t\t\tlet type = Settings.layerSettingForKey(Artboards[index], 'layerType');\n\t\t\tif (type === 'TOC') {\n\t\t\t\tArtboards.splice(index, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// 从画板中检测出标题\n\t\tHeadingsMap.clear();\n\t\tArtboardIndex = 0;\n\t\tLastHeadingSerial = '';\n\t\tsetTimeout(checkHeading.bind(null, Artboards[0]), 5);\n\t} else {\n\t\tsetTimeout(checkHeading.bind(null, Artboards[ArtboardIndex]), 5);\n\t}\n}\n\nexport function setParentHeadingOrOverrideValue(value) {\n\tif (InvalidHeadingOverride) {\n\t\tInvalidHeadingOverride.value = value;\n\t\tInvalidHeadingOverride = undefined;\n\t}\n\tif (NoParentHeadingArtboard) {\n\t\tSettings.setLayerSettingForKey(NoParentHeadingArtboard, 'parentHeading', value);\n\t\tNoParentHeadingArtboard = undefined;\n\t}\n}\n","const Sketch = require('sketch');\nconst fs = require('@skpm/fs');\nconst { exec } = require('@skpm/child_process');\n// const TheUI = require('./TheUI');\n\nlet document = require('sketch/dom').getSelectedDocument();\n\nlet exportDir = '';\nlet browserWindow = null;\nlet webContents = null;\n\nlet needParsePages = [];\nlet needParsePagesIndex = 0;\nlet needParseCount = 0;\nlet hasParseCount = 0;\nlet resultJsons = [];\n\nconst exportLayerJsonOptions = { formats: 'json', output: false };\n\nlet needCancel = false;\nlet needParseLayers = [\n\t'',\n\t'artboard',\n\t'text',\n\t'bitmap',\n\t'group',\n\t'shapeGroup',\n\t'symbolInstance',\n\t'rectangle',\n\t'oval',\n\t'shapePath',\n\t'triangle',\n\t'star',\n\t'polygon',\n\t'slice',\n\t'MSImmutableHotspotLayer',\n];\n\nfunction parsePage(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: 'page',\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseArtboard(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseText(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tcontent: json.attributedString.string,\n\t\tfontFamily: json.style.textStyle.encodedAttributes.MSAttributedStringFontAttribute.attributes.name,\n\t\tfontSize: json.style.textStyle.encodedAttributes.MSAttributedStringFontAttribute.attributes.size,\n\t\tfontColor: {\n\t\t\tr: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.red,\n\t\t\tg: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.green,\n\t\t\tb: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.blue,\n\t\t\ta: json.style.textStyle.encodedAttributes.MSAttributedStringColorAttribute.alpha,\n\t\t},\n\t};\n}\n\nfunction parseImage(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t};\n}\n\nfunction parseGroup(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\tlayers: json.layers,\n\t};\n}\n\nfunction parseSymbol(json) {\n\tlet overrideValues = json.overrideValues;\n\tlet overrideValuesModify = [];\n\toverrideValues.forEach(overrideValue => {\n\t\tlet type;\n\t\tlet json = JSON.parse(JSON.stringify(overrideValue), function(key, value) {\n\t\t\tif (key === '_class') {\n\t\t\t\treturn undefined;\n\t\t\t} else if (key === 'overrideName') {\n\t\t\t\tlet values = value.split('_');\n\t\t\t\tlet last = values.pop();\n\t\t\t\ttype = last;\n\t\t\t\treturn values.join();\n\t\t\t} else if (key === 'value') {\n\t\t\t\tif (typeof value === 'object') {\n\t\t\t\t\treturn value._ref;\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tif (type === 'image') {\n\t\t\t// if (!fs.existsSync(dir + '/' + json.value))\n\t\t\t// \tfs.renameSync(dir + '/unzip/' + json.value, dir + '/' + json.value);\n\t\t} else if (type === 'symbolID') {\n\t\t\t// TODO: how to handle ?\n\t\t\t// letlayer = document.getLayerWithID(json.value)\n\t\t\t// if (layer) {\n\t\t\t// \tconsole.log(layer.name)\n\t\t\t// }\n\t\t\t// letsymbolMaster = document.getSymbolMasterWithID(json.value)\n\t\t\t// console.log(json.value)\n\t\t\t// if (symbolMaster) {\n\t\t\t// \tconsole.log(symbolMaster.name)\n\t\t\t// }\n\t\t}\n\n\t\toverrideValuesModify.push({\n\t\t\ttype: type,\n\t\t\tname: json.overrideName,\n\t\t\tvalue: json.value,\n\t\t});\n\t});\n\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\tsymbolID: json.symbolID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t\toverrideValues: overrideValuesModify,\n\t};\n}\n\nfunction parseCommon(json) {\n\treturn {\n\t\tobjectID: json.do_objectID,\n\t\ttype: json._class,\n\t\tname: json.name,\n\t\trect: {\n\t\t\tx: json.frame.x,\n\t\t\ty: json.frame.y,\n\t\t\twidth: json.frame.width,\n\t\t\theight: json.frame.height,\n\t\t},\n\t\trotation: json.rotation,\n\t\texport: 'images/' + json.do_objectID.toLowerCase() + '.png',\n\t};\n}\n\nfunction exportLayer(layer) {\n\tconst options = {\n\t\tscales: '1',\n\t\tformats: 'png',\n\t\toutput: exportDir + '/images',\n\t\t'use-id-for-name': true,\n\t\toverwriting: true,\n\t};\n\tSketch.export(layer, options);\n\tfs.renameSync(exportDir + '/images/' + layer.id + '.png', exportDir + '/images/' + layer.id.toLowerCase() + '.png');\n}\n\nexport function cancelTask() {\n\tneedCancel = true;\n}\n\nexport function getTargetLayers() {\n\tlet pages = document.pages;\n\tlet nodes = [];\n\tpages.forEach(page => {\n\t\tlet children = [];\n\t\tconst sketchJSON = Sketch.export(page, exportLayerJsonOptions);\n\t\tJSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\t\tif (value._class === 'artboard') {\n\t\t\t\tchildren.push({ value: value.do_objectID, label: value.name });\n\t\t\t}\n\t\t\treturn value;\n\t\t});\n\t\tnodes.push({ value: page.id, label: page.name, children: children });\n\t});\n\tconsole.log(nodes);\n\treturn nodes;\n}\n\nfunction closeWindow() {\n\tbrowserWindow.setClosable(true);\n\tbrowserWindow.close();\n}\n\nfunction calcNeedParseCount(page) {\n\tif (needCancel) {\n\t\tcloseWindow();\n\t\treturn;\n\t}\n\n\tconst sketchJSON = Sketch.export(page, exportLayerJsonOptions);\n\tJSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\tif (needParseLayers.includes(value._class)) needParseCount += 1;\n\t\treturn value;\n\t});\n\n\tneedParsePagesIndex += 1;\n\tif (needParsePagesIndex < needParsePages.length) {\n\t\tsetTimeout(calcNeedParseCount.bind(null, needParsePages[needParsePagesIndex]), 5);\n\t} else {\n\t\tneedParsePagesIndex = 0;\n\t\twebContents.executeJavaScript(`exportProgress(0)`);\n\t\twebContents.executeJavaScript(`exportMessage('Exporting ${needParsePages[0].name}')`);\n\t\tconst sketchJSON = Sketch.export(needParsePages[0], exportLayerJsonOptions);\n\t\tsetTimeout(handleSketchJSON.bind(null, sketchJSON), 5);\n\t}\n}\n\nfunction handleSketchJSON(sketchJSON) {\n\tif (needCancel) {\n\t\tcloseWindow();\n\t\treturn;\n\t}\n\n\t// parse\n\tlet hasParse = false;\n\tlet hasAllParse = false;\n\tlet json = JSON.parse(JSON.stringify(sketchJSON), function(key, value) {\n\t\tif (!hasParse) {\n\t\t\t// empty key means page layer, number key means layers, handle this two parts only\n\t\t\tif (key === '') {\n\t\t\t\thasParse = true;\n\t\t\t\thasAllParse = true;\n\t\t\t\treturn parsePage(value);\n\t\t\t} else if (!isNaN(key)) {\n\t\t\t\tif (value._class === 'artboard') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseArtboard(value);\n\t\t\t\t} else if (value._class === 'text') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseText(value);\n\t\t\t\t} else if (value._class === 'bitmap') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseImage(value);\n\t\t\t\t} else if (value._class === 'group' || value._class === 'shapeGroup') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\treturn parseGroup(value);\n\t\t\t\t} else if (value._class === 'symbolInstance') {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseSymbol(value);\n\t\t\t\t} else if (\n\t\t\t\t\tvalue._class === 'rectangle' ||\n\t\t\t\t\tvalue._class === 'oval' ||\n\t\t\t\t\tvalue._class === 'shapePath' ||\n\t\t\t\t\tvalue._class === 'triangle' ||\n\t\t\t\t\tvalue._class === 'star' ||\n\t\t\t\t\tvalue._class === 'polygon' ||\n\t\t\t\t\tvalue._class === 'slice' ||\n\t\t\t\t\tvalue._class === 'MSImmutableHotspotLayer'\n\t\t\t\t) {\n\t\t\t\t\thasParse = true;\n\t\t\t\t\texportLayer(document.getLayerWithID(value.do_objectID));\n\t\t\t\t\treturn parseCommon(value);\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t} else {\n\t\t\treturn value;\n\t\t}\n\t});\n\n\tif (hasAllParse) {\n\t\tresultJsons.push(json);\n\n\t\tneedParsePagesIndex += 1;\n\t\tif (needParsePagesIndex < needParsePages.length) {\n\t\t\twebContents.executeJavaScript(`exportMessage('Exporting ${needParsePages[needParsePagesIndex].name}')`);\n\t\t\tconst sketchJSON = Sketch.export(needParsePages[needParsePagesIndex], exportLayerJsonOptions);\n\t\t\thandleSketchJSON(sketchJSON);\n\t\t} else {\n\t\t\t// output metadata file\n\t\t\twebContents.executeJavaScript(`exportMessage('Creating metadata file)`);\n\t\t\tfs.writeFileSync(\n\t\t\t\texportDir + '/metadata.json',\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tpages: resultJsons,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\t// clear unzip\n\t\t\tlet unzipPath = exportDir + '/unzip';\n\t\t\tif (fs.existsSync(unzipPath)) {\n\t\t\t\tfs.rmdirSync(unzipPath, { recursive: true });\n\t\t\t}\n\n\t\t\tSketch.UI.message('Export Successfully! 🙌');\n\t\t\tcloseWindow();\n\t\t}\n\t} else {\n\t\thasParseCount += 1;\n\t\twebContents.executeJavaScript(`exportProgress(${JSON.stringify((hasParseCount * 100) / needParseCount)})`);\n\t\tsetTimeout(handleSketchJSON.bind(null, json), 5);\n\t}\n}\n\nexport function exportMetadata(exportPath, contents, win) {\n\texportDir = exportPath;\n\tbrowserWindow = win;\n\twebContents = contents;\n\n\t// clear output first\n\tif (fs.existsSync(exportDir)) {\n\t\twebContents.executeJavaScript(`exportMessage('Clearing output')`);\n\t\tfs.rmdirSync(exportDir, { recursive: true });\n\t}\n\n\t// handle export dir\n\tif (!fs.existsSync(exportDir)) {\n\t\twebContents.executeJavaScript(`exportMessage('Creating output directory')`);\n\t\tfs.mkdirSync(exportDir);\n\t}\n\n\t// unzip sketch file\n\tlet cmd = '/usr/bin/unzip -o \"' + document.path.replace(/%20/g, ' ') + '\" -d \"' + exportDir + '/unzip\"';\n\twebContents.executeJavaScript(`exportMessage('Unzip sketch file...')`);\n\texec(cmd, () => {\n\t\tlet pages = document.pages;\n\t\tpages.forEach(page => {\n\t\t\tif (page.name !== 'Symbols') {\n\t\t\t\tneedParsePages.push(page);\n\t\t\t}\n\t\t});\n\n\t\tif (needParsePages.length > 0) {\n\t\t\twebContents.executeJavaScript(`exportMessage('Counting target layers')`);\n\t\t\tcalcNeedParseCount(needParsePages[0]);\n\t\t}\n\t});\n}\n","let Sketch = require('sketch');\nlet Settings = require('sketch/settings');\n\nlet SelectedDocument = require('sketch/dom').getSelectedDocument();\n\nlet BrowserWindow = null;\nlet WebContents = null;\n\nexport function resetParentHeading(heading, contents, win) {\n\tBrowserWindow = win;\n\tWebContents = contents;\n\n\tlet selection = SelectedDocument.selectedLayers;\n\tlet selectionLayers = selection.layers;\n\tif (selectionLayers.length === 1 && selectionLayers[0].type === 'Artboard') {\n\t\tlet artboard = selectionLayers[0];\n\t\tSettings.setLayerSettingForKey(artboard, 'parentHeading', heading);\n\t}\n}\n","import BrowserWindow from 'sketch-module-web-view';\nimport { createTableOfContents, setParentHeadingOrOverrideValue } from '../lib/CreateTableOfContents';\nimport { resetParentHeading } from '../lib/ResetParentHeading';\nimport { addPageNumber } from '../lib/AddPageNumber';\nimport { exportMetadata, cancelTask, getTargetLayers } from '../lib/ExportMetadata';\nimport getTheme from '../../resources/views/theme/index';\nimport { getDefaultExportDir, getExportDir } from './Utilities';\nimport dialog from '@skpm/dialog';\n\nlet handingTask = false;\n\nconst theUI = options => {\n\tconst themeColor = typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark() ? 'dark' : 'light';\n\tconst theme = getTheme(themeColor);\n\n\tconst winOptions = {\n\t\tidentifier: options.identifier,\n\t\ttitle: options.title,\n\t\twidth: options.width,\n\t\theight: options.height,\n\t\tminimizable: false,\n\t\tmaximizable: false,\n\t\tresizable: false,\n\t\tfullscreenable: false,\n\t\tbackgroundColor: theme.bg,\n\t\talwaysOnTop: true,\n\t\tshow: false,\n\t};\n\n\tlet artboardSort = '';\n\n\tlet win = new BrowserWindow(winOptions);\n\tconst contents = win.webContents;\n\n\twin.once('ready-to-show', () => {\n\t\twin.show();\n\t});\n\n\t// Sending a message to the plugin from the WebView\n\twin.on('closed', e => {\n\t\twin = null;\n\t});\n\n\tcontents.on('cancel', (needShowAlert = true) => {\n\t\tif (needShowAlert) {\n\t\t\tcontents.executeJavaScript(`showExportAlert()`);\n\t\t} else {\n\t\t\tif (handingTask) {\n\t\t\t\tcancelTask();\n\t\t\t} else {\n\t\t\t\twin.setClosable(true);\n\t\t\t\twin.close();\n\t\t\t}\n\t\t}\n\t});\n\n\twin.loadURL(require('../../resources/webview.html'));\n\n\tcontents.on('createTableOfContent', () => {\n\t\tcreateTableOfContents(artboardSort, contents, win);\n\t});\n\n\tcontents.on('createContinue', value => {\n\t\tsetParentHeadingOrOverrideValue(value);\n\t\tcreateTableOfContents(artboardSort, contents, win, true);\n\t});\n\n\tcontents.on('resetParentHeadingApply', function(heading) {\n\t\tresetParentHeading(heading, contents, win);\n\t});\n\n\tcontents.on('resetParentHeadingOK', heading => {\n\t\tresetParentHeading(heading, contents, win);\n\t\twin.close();\n\t});\n\n\tcontents.on('addPageNumber', () => {\n\t\taddPageNumber(artboardSort, contents, win);\n\t});\n\n\tcontents.on('exportMetadata', path => {\n\t\thandingTask = true;\n\t\twin.setClosable(false);\n\t\texportMetadata(path + '/' + getExportDir(), contents, win);\n\t\t// handingTask = false;\n\t});\n\n\tcontents.on('openFolder', () => {\n\t\tlet array = dialog.showOpenDialogSync({\n\t\t\tproperties: ['openDirectory'],\n\t\t});\n\t\tif (array && array.length) {\n\t\t\tlet result = array[0];\n\t\t\tcontents.executeJavaScript(`setExportDir(${JSON.stringify(result)})`);\n\t\t}\n\t});\n\n\tcontents.on('artboardSort', function(s) {\n\t\tartboardSort = s;\n\t});\n\n\tcontents.on('artboardInnerLayersSort', function(s) {\n\t\tartboardInnerLayersSort = s;\n\t});\n\n\tcontents.on('nativeLog', function(s) {\n\t\tconsole.log('nativeLog: ', s);\n\t});\n\n\tconst getData = () => {\n\t\t// Sending a message to the WebView from your plugin command\n\t\tcontents.executeJavaScript(`setTheme(${JSON.stringify(themeColor)})`);\n\t\tcontents.executeJavaScript(`setRedirectTo(${JSON.stringify(options.redirectTo)})`);\n\n\t\tif (options.redirectTo === '/export_metadata') {\n\t\t\tcontents.executeJavaScript(`setExportDir(${JSON.stringify(getDefaultExportDir())})`);\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tcontents.executeJavaScript(`setExportNodes(${JSON.stringify(getTargetLayers())})`);\n\t\t\t}, 1000);\n\t\t}\n\t};\n\tcontents.on('did-start-loading', () => getData());\n\tcontents.on('getData', () => getData());\n};\n\nexport default theUI;\n","import { ArtboardSortEnum, ArtbaordLayersSortEnum } from './Constants';\nconst os = require('os');\n\nlet document = require('sketch/dom').getSelectedDocument();\n\nfunction hasLayers(layer) {\n\treturn typeof layer.layers !== 'undefined' && layer.layers.length !== 0;\n}\n\nfunction checkArtboardSort(artboardSort) {\n\tif (artboardSort === 'Top to Bottom') {\n\t\treturn ArtboardSortEnum.Top2BottomByLayerList;\n\t} else if (artboardSort === 'Bottom to Top') {\n\t\treturn ArtboardSortEnum.Bottom2TopByLayerList;\n\t} else if (artboardSort === 'Left to Right') {\n\t\treturn ArtboardSortEnum.Left2RightByArtboard;\n\t} else if (artboardSort === 'Right to Left') {\n\t\treturn ArtboardSortEnum.Right2LeftByArtboard;\n\t} else if (artboardSort === 'Top to Bottom 1') {\n\t\treturn ArtboardSortEnum.Top2BottomByArtboard;\n\t}\n}\n\nexport function getArtboardsSorted(page, artboardSort) {\n\tlet sort = checkArtboardSort(artboardSort);\n\tlet artboards = [];\n\tpage.layers.slice().forEach(layer => {\n\t\tif (layer.type === 'Artboard') artboards.push(layer);\n\t});\n\n\tif (sort === ArtboardSortEnum.Top2BottomByLayerList) {\n\t\treturn artboards.reverse();\n\t} else if (sort === ArtboardSortEnum.Bottom2TopByLayerList) {\n\t\treturn artboards;\n\t} else if (sort === ArtboardSortEnum.Left2RightByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.y > b.frame.y + b.frame.height / 2) {\n\t\t\t\treturn a.frame.y - b.frame.y + b.frame.height / 2;\n\t\t\t}\n\n\t\t\treturn a.frame.x - b.frame.x;\n\t\t});\n\t} else if (sort === ArtboardSortEnum.Right2LeftByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.y > b.frame.y + b.frame.height / 2) {\n\t\t\t\treturn a.frame.y - b.frame.y + b.frame.height / 2;\n\t\t\t}\n\n\t\t\treturn b.frame.x - a.frame.x;\n\t\t});\n\t} else if (sort === ArtboardSortEnum.Top2BottomByArtboard) {\n\t\treturn artboards.sort(function(a, b) {\n\t\t\tif (a.frame.x > b.frame.x + b.frame.width / 2) {\n\t\t\t\treturn a.frame.x - b.frame.x + b.frame.width / 2;\n\t\t\t}\n\n\t\t\treturn a.frame.y - b.frame.y;\n\t\t});\n\t} else {\n\t\treturn undefined;\n\t}\n}\n\nfunction tailGetLayerPosterities(layer, posterities) {\n\t// sort from top to bottom by left layer list\n\tif (!hasLayers(layer)) {\n\t\treturn posterities;\n\t}\n\n\tlet reverse = layer.layers.slice().reverse();\n\tfor (let layer of reverse) {\n\t\tposterities.push(layer);\n\t\ttailGetLayerPosterities(layer, posterities);\n\t}\n}\n\nexport function getPagePosterities(\n\tpage,\n\tartboardSort = ArtboardSortEnum.Left2RightByArtboard,\n\tartboardLayersSort = ArtbaordLayersSortEnum.Bottom2TopByLayerList\n) {\n\tlet posterities = [];\n\n\t// get artboards\n\tlet artboards = getArtboardsSorted(page, artboardSort);\n\n\t// get artboards's layers\n\tfor (let artboard of artboards) {\n\t\tposterities.push(artboard);\n\t\tlet list = [];\n\t\ttailGetLayerPosterities(artboard, list);\n\t\tif (artboardLayersSort === ArtbaordLayersSortEnum.Top2BottomByLayerList) {\n\t\t\tposterities = posterities.concat(list);\n\t\t} else if (artboardLayersSort === ArtbaordLayersSortEnum.Bottom2TopByLayerList) {\n\t\t\tposterities = posterities.concat(list.reverse());\n\t\t}\n\t}\n\n\treturn posterities;\n}\n\nexport function getDefaultExportDir() {\n\tlet dir = os.homedir() + '/Desktop';\n\treturn dir;\n}\n\nexport function getExportDir() {\n\tlet documentName = document.path\n\t\t.replace(/^.*[\\\\\\/]/, '')\n\t\t.replace('.sketch', '')\n\t\t.replace(/%20/g, ' ');\n\treturn documentName + '_output';\n}\n","module.exports = require(\"buffer\");","module.exports = require(\"events\");","module.exports = require(\"os\");","module.exports = require(\"sketch\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");","module.exports = require(\"stream\");"],"sourceRoot":""}